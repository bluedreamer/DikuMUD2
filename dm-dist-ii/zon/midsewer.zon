/*
filename    midsewer
password    winner97
changedby   Skay
EmailAdd     Morgan Schafer <saor@maestro.com>
request     compile
version     1
END HEADER*/

#include <composed.h>

#define M_SEWERS                                \
flags {UNIT_FL_NO_WEATHER,UNIT_FL_INDOORS}      \
movement SECT_SWAMP                             \
IN_ALWAYS_DARK                                  \
dilcopy drip@midsewers();       \
extra {"$leave_s","n s e w"}    \
"You slosh off to the $3t."     \
extra {"$leave_o","n s e w"}            \
"$1n sloshes off to the $3t."           \
extra {"$arrive_o","n s e w"}           \
"$1n wades in from the $3t, dragging $1s water-filled boots."   \
extra {"sewage"}                \
"The dirty water is thick like some disgusting kind of soup. It sloshes \
in your boots and clings to your clothes in an extremely foul manner. The \
stench is making you dizzy."

#define RACE_BEHOLDER 5040

#define BASE_SLIME(MLVL) \
   race RACE_SLIME \
   sex SEX_NEUTRAL \
   level MLVL \
   alignment 0 \
   height MLVL \
   weight MLVL \
   NATURAL_DEF(WPN_CRUSH, ARM_HLEATHER) \
   MSET_ABILITY(20,25,20,25,5,0,5,0) \
   MSET_WEAPON(10,10,10,10,10,10) \
   MSET_SPELL(0,0,0,5,5,5,5,5,5,5,5) \
   special SFUN_AGGRESSIVE time 100 bits SFB_RANTIME    \
   dilcopy move@midsewers("oozes",70);

%zone midsewers
title "Midgaard Sewers"
lifespan 20
reset RESET_ANYHOW
creators {"skay","skray"}

notes
"Midgaard Sewers, now opened to the visitors thanks to a forgotten
entrance. Created by Sk(r)ay, with ideas of Zandar.&l
Sk(r)ay Email &c+wotap@dorit.ihi.ku.dk&cw

- Balluston's Quest removed until I get the vat working right.
- Leprosy has to wait until I have time to perfect it.
"

help
"&l

                Welcome to the Midgaard Underground.
        May your demise be swift and your death throes painless.

                                Enjoy

                             - Sk(r)ay -
"

%dil

#define GIMME_BOOK "Searching for an Alchemical Tome"
#define HAVE_BOOK "Retrieved Balluston's Tome"
#define BOOK_DONE "Solved the Secret of Balluston's Vat"
#define BROTHER_ON "Aiding Branneth"
#define BROTHER_DONE "Aided Branneth in his Search"

dilbegin rapier_rest (min_abi:integer);
var
        amount  : integer;
code
{
act("With a sigh, you drop your $2N.",
A_ALWAYS,self.outside,self,null,TO_CHAR);
act ("$1n drops $1s $2N with a sigh.",
A_SOMEONE,self.outside,self,null,TO_REST);
amount:=min_abi-activator.weapons[WPN_RAPIER];
act ("Your fencing skills are too low! You need $2t% more rapier skill "+
"to use this item!",A_ALWAYS,self.outside,itoa (amount),self,TO_CHAR);
return;
}
dilend

dilbegin badsword();
code
{
act("You realize that this is a weapon of evil and decline to use it.",
A_ALWAYS,self.outside,self,null,TO_CHAR);
act("$1n drops $2n with a look of disgust on $1s face.",
A_SOMEONE,self.outside,self,null,TO_REST);
return;
}
dilend

dilbegin slipfall(sted:string);
var
        pc      : unitptr;
        room    : unitptr;
code
{
   :init:
   heartbeat := PULSE_SEC*3;

   :start:
   wait(SFB_TICK,TRUE);
   pc := (self.inside);
   secure(pc,gone);

   if ((pc.abilities[ABIL_DEX]+pc.skills[SKI_CLIMB])<(rnd(0,80)))
   {
      act("You can feel your grip slipping...",A_ALWAYS,pc,null,null,TO_CHAR);
      act("$1n's hands slowly slip on the iron rings..."
            ,A_HIDEINV,pc,null,null,TO_REST);pause;
      act("You lose your handhold and plunge down into the darkness, screaming!"
             ,A_ALWAYS,pc,null,null,TO_CHAR);
      act("$1n loses $1s handhold and plunges down into the darkness, screaming!"
             ,A_SOMEONE,pc,null,null,TO_REST);
      if (pc.level < 200)
      {
         pc.hp := pc.hp-(rnd(3,10));
         position_update(pc);
      }
      room:=findroom(sted);
      link(pc,room);
      act("(&c+wcOuch!!! You hit the stones hard!&cw",
                A_ALWAYS,pc,null,null,TO_CHAR);
      act("$1n falls from above and smashes into the stones!"
               ,A_SOMEONE,pc,null,null,TO_REST);
      exec("look",pc);
      unsecure(pc);
      goto start;
  }

  :gone:
  unsecure(pc);
  goto start;
}
dilend

/* Self.exitto[NORTH] will be null if exit don't exist
        how     : type of movement (slithers, squishes etc)
        time    : frequency of movement (seconds)
        This movement is ONLY horizontal. */

dilbegin move(how:string,time:integer);
var
        flux : integer;
code
{
on_activation(self.position==POSITION_FIGHTING,skip);
        :init:
heartbeat := PULSE_SEC*time/2;

        :start:
wait(SFB_TICK,TRUE);wait(SFB_TICK,TRUE);
        :random:
flux := rnd(1,4);
if (flux ==1)
{
if (self.outside.exit_to[NORTH])
{
exec("emote "+how+" north.",self);
exec("north",self);
exec("emote "+how+" in from the south.",self);
}
else goto random;
}

if (flux ==2)
{
if (self.outside.exit_to[SOUTH])
{
exec("emote "+how+" south.",self);
exec("south",self);
exec("emote "+how+" in from the north.",self);
}
else goto random;
}
if (flux ==3)
{
if (self.outside.exit_to[EAST])
{
exec("emote "+how+" east.",self);
exec("east",self);
exec("emote "+how+" in from the west.",self);
}
else goto random;
}

if (flux==4)
{
if (self.outside.exit_to[WEST])
{
exec("emote "+how+" west.",self);
exec("west",self);
exec("emote "+how+" in from the east.",self);
}
else goto random;
}
}
dilend

/*   Traps for caskets and doors
     spell   : SPL_XXXX for the trap to cast on luckless adventurer
     diff    : difficulty (dice to roll for dex+picklock/2 (max 100) check)
     vari    : variation (openroll parameter) */

dilbegin locktrap(spell:integer,diff:integer,vari:integer);
var
        pc :    unitptr;
        n :     integer;
code
{
        :start:
wait(SFB_DONE,(command(CMD_PICK)and(target == self)));
pc := activator;
secure(pc,gone);
if((openroll(diff,vari)) > ((pc.abilities[ABIL_DEX]+pc.skills[SKI_PICK_LOCK])/2))
{
act("As you are busy with the lock, a tiny needle shoots out, piercing "+
"your finger!",A_ALWAYS,pc,self,null,TO_CHAR);
act("$1n hisses with pain as a tiny needle shoots out from the lock, "+
"piercing $1s finger!",A_SOMEONE,pc,self,null,TO_REST);
n:=cast_spell(spell,self,self,pc,"");
goto gone;
}
else if (rnd(1,10) > 5)
{
act("As you are busy with the lock, a tiny needle shoots out, but you "+
"move your hand away in time!",A_ALWAYS,pc,self,null,TO_CHAR);
act("A tiny needle shoots out of the lock, but alert as always, $1n "+
"removes $1s hand in time!",A_SOMEONE,pc,self,null,TO_REST);
}
        :gone:
unsecure(pc);
goto start;
}
dilend

dilbegin rnd_fight();
var
        flux    : integer;
        pc      : unitptr;
code
{
on_activation(self.position!=POSITION_FIGHTING,skip);
heartbeat:=PULSE_VIOLENCE;
        :start:
wait(SFB_COM,self.position==POSITION_FIGHTING);
pc:=self.fighting;
secure(pc,start);
        :loop:
flux:=rnd(1,5);

if (flux==1)
{
exec("kick "+pc.name,self);
exec("kick "+pc.name,self);
}
if (flux==2)
{
exec("trip "+pc.name,self);
exec("trip "+pc.name,self);
exec("trip "+pc.name,self);
}
if ((flux==3)and(equipment(self,WEAR_SHIELD)))
{
exec("bash "+pc.name,self);
}
if ((flux==4)and(pc.abilities[ABIL_CON]<openroll(30,5)))
{
act("The $3N headbutts you, you are stunned!",A_ALWAYS,pc,null,self,TO_CHAR);
act("The $3N headbutts $1n, $1e is stunned!",A_SOMEONE,pc,null,self,TO_REST);
pc.hp:=pc.hp-rnd(3,8);
position_update(pc);
change_speed(pc,6);
}
if ((flux==5)and(pc.abilities[ABIL_STR]<openroll(50,5)))
{
act("The $3N slams $3s body into you, sending you to the ground!",
A_ALWAYS,pc,null,self,TO_CHAR);
act("The $3N slams $3s body into $1n, sending $1m sprawling to the ground!",
A_SOMEONE,pc,null,self,TO_REST);
}
wait(SFB_TICK,TRUE);
wait(SFB_TICK,TRUE);
goto loop;
}
dilend

dilbegin orc_interact();
var
        u : unitptr;
        i : integer;
code
{
        heartbeat := PULSE_SEC*20;
        on_activation(self.position==POSITION_FIGHTING,skip);

        :start:
	wait(SFB_DONE,self.position==POSITION_STANDING);

        :loop:
	u:=findrndunit(self,FIND_UNIT_SURRO,UNIT_ST_NPC);

	if (u==self) goto waitawhile;
	if (not("orc" in u.names)) goto waitawhile;
	if (not(u)) goto waitawhile;

i:=rnd(1,5);

on i goto i1, i2, i3, i4, i5;

        :i1:
exec("nod "+u.name,self);
goto waitawhile;

        :i2:
exec("nudge "+u.name,self);
goto waitawhile;

        :i3:
exec("whisper "+u.name+" How do you like the gray orc body, immortal "+
"one?",self); exec("eyebrow",self);
goto waitawhile;

        :i4:
exec("emote barks something in orcish to "+u.title+".",self);
goto waitawhile;

        :i5:
exec("emote pats "+u.title+" on the shoulder.",self);
goto waitawhile;

        :waitawhile:
pause;
goto start;
}
dilend

dilbegin rabies();
var
        enemy : unitptr;
        vict : unitptr;
        n : integer;
        flux : integer;
code
{
   :init:
   heartbeat := PULSE_SEC * 7;
   on_activation(self.position != POSITION_FIGHTING,skip);
 
   :start:
enemy := self.fighting;
vict := enemy;
flux := rnd(20,100);
if (flux > (((enemy.abilities[ABIL_CON])+(enemy.weapons[WPN_KICK]))/2))
{
act("&c+r$1n buries $1s teeth in your leg!&cw"
,A_SOMEONE,self,null,enemy, TO_VICT); 
act("&c+y$1n buries $1s teeth in $3n's leg!&cw"
,A_SOMEONE,self,null,enemy, TO_NOTVICT);
n:=cast_spell(SPL_DISEASE_2,self,self,enemy,"");
enemy.hp := enemy.hp-(rnd(1,5));
pause;
goto start;
}
act("&c+wYou kick $1n away as $1e tries to bite you!&cw",
A_SOMEONE,self,null,enemy, TO_VICT);
act("&c+w$3n kicks $1n away as $1e tries to bite $3m!&cw",
A_SOMEONE,self,null,enemy, TO_NOTVICT);
pause;
goto start;
}
dilend

dilbegin pincerslow();
var
        enemy : unitptr;
        vict : unitptr;
        n : integer;
        flux : integer;
code
{
   :init:
   heartbeat := PULSE_SEC * 7;
   on_activation(self.position != POSITION_FIGHTING,skip);

   :start:
enemy := self.fighting;
vict := enemy;
flux := rnd(20,100);
if (flux > (((enemy.abilities[ABIL_CON])+(enemy.spells[SPL_INTERNAL]))/2))
{
act("&c+r$1n's pincers cut a deep rift in your leg!&cw"
, A_SOMEONE,self,null,enemy, TO_VICT);
act("&c+y$1n's pincers cut a deep rift in $3n's leg!&cw",
A_SOMEONE,self,null,enemy, TO_NOTVICT);
n:=cast_spell(SPL_DROWSE,self,self,enemy,"");
enemy.hp := enemy.hp-(rnd(0,3));
pause;
goto start;
}
act("$1n's pincers scratch at your armour without any effect.",
A_SOMEONE,self,null,enemy, TO_VICT);
act("$1n's pincers scratch at $3n's armour without any effect.",
A_SOMEONE,self,null,enemy, TO_NOTVICT);
pause;
goto start;
}
dilend

dilbegin drip();
var
     i : integer;
     pc : unitptr;
code
{
        :init:
heartbeat := PULSE_SEC*7;
        :start:
wait(SFB_DONE,(activator.type == UNIT_ST_PC));
pc := activator;
secure(pc,init);
i := rnd (1,15);
pause;
if (i == 1)
{
act("A sound of dripping water comes from somewhere near.",
A_ALWAYS,pc, null, null, TO_ALL);
}
if (i == 2)
{
act("A turd floats by, turning in the sewage.",
A_ALWAYS,pc, null, null, TO_ALL);
}
if (i == 3)
{
act("&c+wA strangled scream can be heard in the distance.&cw",
A_ALWAYS,pc, null, null, TO_ALL);
}
if (i == 4)
{
act("&c+wStream of sewage shoots out of an opening, soaking your "+
"clothes!&cw", A_ALWAYS,pc, null, null, TO_ALL);
}
if (i == 5)
{
act("A stream of urine trickles from an opening and down the wall.",
A_ALWAYS,pc, null, null, TO_ALL);
}
if (i == 6)
{
act("&c+wSqueaks of rats fighting over some tasty morsel fill the "+
"tunnel.&cw", A_ALWAYS,pc, null, null, TO_ALL);
}
if (i == 7)
{
act("The echoes carry someones death cry through the tunnels.",
A_ALWAYS,pc, null, null, TO_ALL);
}
if (i == 8)
{
act("&c+wSurely you see no one here..?&cw",
A_ALWAYS,pc, null, null, TO_ALL);
}
if (i == 9)
{
act("&c+wThe foul stench of sewage makes you cough.&cw",
A_ALWAYS, activator, null, null, TO_ALL);
}
if (i==10)
{
act("&c+wYou spot a pair of red eyes regarding you from the shadows!&cw",
A_ALWAYS,pc, null, null, TO_ALL);
pause;
act("The eyes close and whatever it was, disappears.",A_ALWAYS,pc, null,
null, TO_ALL); }
pause;pause;pause;pause;pause;pause;pause;
goto start;
}
dilend

dilbegin slimedeath();
var
        item    : unitptr;
code
{
wait(SFB_DEAD,(command(CMD_AUTO_DEATH)and(activator==self)));
if (self.nameidx=="slime_green") item:=load("green_blob@midsewers");
if (self.nameidx=="slime_red") item:=load("red_blob@midsewers");
if (self.nameidx=="slime_black") item:=load("black_blob@midsewers");
if (self.nameidx=="slime_purple") item:=load("purple_blob@midsewers");
link(item,self.outside);
destroy(self);
quit;
}
dilend

/* txt1    : string to disarmer
   txt2    : string to rest
   txt3    : exec action before killing */

dilbegin nodisarm(txt1:string,txt2:string,txt3:string);
var
        pc      : unitptr;
code
{
        :start:
wait(SFB_CMD,command(CMD_DISARM)and(activator!=self));
block;
pc := activator;
act(""+txt1,A_ALWAYS,pc,null,self,TO_CHAR);
act(""+txt2,A_SOMEONE,pc,null,self,TO_REST);
exec(""+txt3,self);
exec("kill "+pc.name,self);
goto start;
}
dilend

/* Leprosy Disease! */

dilbegin aware recall leprosy(pwr : integer);
external
   integer skillresist@basis(aa : integer, ad : integer,
                             sa : integer, sd : integer);
var
  state : integer;
  i     : integer;
  j     : integer;
  u     : unitptr;
  parse : stringlist;
code
{
   interrupt(SFB_MSG, TRUE, check);
   interrupt(SFB_DEAD, activator == self, stop);

   i:=(20+self.abilities[ABIL_CON]);
   if (i<30) i:=30;
   if (i>100) i:=100;
   heartbeat := PULSE_SEC * i;

   :loop:
   if (state >= 24)
     goto the_end;
   wait(SFB_TICK, TRUE);

   state := state + 1;
   i := state + 5;
   if (i > 10) i := 10;

   on rnd(1, i) goto
     case1, case2, case3, case4, case5,
     case6, case7, case8, case9, case10;

   :case1:
act("Your body itches like crazy, you scratch yourself madly."
,A_ALWAYS,self,null,null,TO_CHAR);
act("$1n scratches $1mself madly.",A_HIDEINV,self,null,null,TO_REST);
self.hp := self.hp - rnd(1,3);
self.endurance := self.endurance - rnd(1,5);
position_update(self);
goto loop;

   :case2:
act("You suddenly notice blood flowing from underneath your finger-nails!"
,A_ALWAYS,self,null,null,TO_CHAR);
act("$1n drips blood from $1s hands.",A_HIDEINV,self,null,null,TO_REST);
self.hp := self.hp - rnd(0,2);
self.endurance := self.endurance - rnd(1,5);
position_update(self);
goto loop;

   :case3:
act("Blood starts pouring from your gums... you can feel a tooth loose."
,A_ALWAYS,self,null,null,TO_CHAR);
act("Blood starts pouring from $1n's mouth, $1e spits out a tooth.",
A_HIDEINV,self,null,null,TO_REST);
self.hp := self.hp - rnd(1,4);
self.endurance := self.endurance - rnd(3,8);
position_update(self);
goto loop;

   :case4:
act("You scratch an annoying itch on your arm, leaving a bloody track."
,A_ALWAYS,self,null,null,TO_CHAR);
act("$1n scratches $1s arm, leaving a bloody track."
,A_HIDEINV,self,null,null,TO_REST);
self.hp := self.hp - rnd(2,4);
self.endurance := self.endurance - rnd(2,6);
position_update(self);
goto loop;

   :case5:
act("Blood starts to flow freely from your nose and mouth!"
,A_ALWAYS,self,null,null,TO_CHAR);
act("Blood bursts from $1n's nose and mouth!",
A_HIDEINV,self,null,null,TO_CHAR);
self.hp := self.hp - rnd(2,8);
self.endurance := self.endurance - rnd(5,10);
position_update(self);
goto loop;

   :case6:
act("You scratch an annoying itch on you arm and pull away a piece of "+
"flesh!",A_ALWAYS,self,null,null,TO_CHAR);
act("$1n scratches $1s arm, you gasp as $1e pulls away a piece of "+
"bleeding flesh!",A_HIDEINV,self,null,null,TO_REST);
self.hp := self.hp - rnd(3,10);
self.endurance := self.endurance - rnd(2,6);
position_update(self);
goto loop;

   :case7:
act("You notice that one of your finger-nails is falling off, leaving "+
"raw, bleeding flesh behind!",A_ALWAYS,self,null,null,TO_CHAR);
act("A bloody finger-nail falls off $1n's finger, leaving raw, bleeding "+
"flesh behind!",A_HIDEINV,self,null,null,TO_REST);
self.hp := self.hp - rnd(3,6);
self.endurance := self.endurance - rnd(2,6);
position_update(self);
goto loop;

   :case8:
act("Cramps send you down as you vomit blood and stinking slime!"
,A_ALWAYS,self,null,null,TO_CHAR);
act("$1n collapses in cramps, vomiting blood and stinking slime!"
,A_SOMEONE,self,null,null,TO_REST);
self.hp := self.hp - rnd(5,12);
self.endurance := self.endurance - rnd(20,50);
self.position := POSITION_SITTING;
position_update(self);
goto loop;

   :case9:
act("A foul stench accompanies the sick squelch of one of your fingers "+
"falling off!",A_ALWAYS,self,null,null,TO_CHAR);
act("A foul stench accompanies the sick squelch of one of $1n's fingers "+
"falling off!",A_SOMEONE,self,null,null,TO_REST);
self.hp := self.hp - rnd(5,15);
self.endurance := self.endurance - rnd(10,20);
position_update(self);
goto loop;

   :case10:
act("A large piece of flesh falls off your body, leaving a bleeding, raw "+
"sore behind!",A_ALWAYS,self,null,null,TO_CHAR);
act("A rotting piece of flesh parts from $1n's body, leaving a bleeding, "+
"raw sore behind!",A_SOMEONE,self,null,null,TO_REST);
exec("scream",self);
self.hp := self.hp - rnd(5,20);
self.endurance := self.endurance - rnd(10,20);
position_update(self);
goto loop;

   :check:
   parse := getwords(argument);
   if ((parse.[0] == "spl_rem_disease") or (parse.[0] == "spl_dispel"))
   {
      if (atoi(parse.[1]) >= pwr)
        goto the_end;
   }
   goto loop;

   :the_end:
   act("You feel the decay of your body stop."
   ,A_ALWAYS, self, null, null, TO_CHAR);
   :stop:
   i:=dildestroy("leprocy_spread@midsewers",self);
   i:=dildestroy("leprosy@midsewers",self);
   quit;
}
dilend

dilbegin leprocy_spread();
var
        meat    : unitptr;
        i       : integer;
code
{
        :start:
wait(SFB_DONE,TRUE);
if (not(target)) goto start; /* If no target */

if ((activator==self)and(target==self)) goto start;
if ((activator!=self)and(target==self)) meat:=activator;
if ((activator==self)and(target!=self)) meat:=target;
if ((activator!=self)and(target!=self)) goto start;

/* - - - - If no close contact - - - - */
if (command(CMD_CAST)or command(CMD_LOOK) or command(CMD_CONSIDER)
or command(CMD_DIAGNOSE) or command(CMD_TELL)) goto start;

/* - - if race not humanoid, target not a mob/player or if immortal - - */

if ((meat.type!=UNIT_ST_PC)and(meat.type!=UNIT_ST_NPC)) goto start;
if (meat.race > 999) goto start;
if (meat.level>200) goto start;

/* - - - - if already sick of leprosy - - - - */
i:=dilfind("leprosy@midsewers",meat);
if (i) goto start;

/* - - - - If NPC, level counts to resist - - - - */
if (meat.type == UNIT_ST_NPC)
{
 if ((rnd(1,meat.level+20) < self.level)and(rnd(0,1)>0)and(not(i)))
 {
 act("$1n coughs briefly.",A_SOMEONE,meat,null,self,TO_ALL);
 i:=(100-meat.abilities[ABIL_CON]);
 if (i<10) i:=10;
 if (i>80) i:=80;
 dilcopy ("leprosy@midsewers(i)",meat);
 dilcopy ("leprocy_spread@midsewers",meat);
 goto start;
 }
goto start;
}

/* - - - - If PC, Con + Poison Resistance counts - - - - */
if (meat.type == UNIT_ST_PC)
{
 if ((meat.abilities[ABIL_CON]+meat.spells[SPL_INTERNAL])/2
    < openroll(100,10))
 {
 act("You feel quite dizzy and sick.&n",A_SOMEONE,meat,null,self,TO_CHAR);
 act("$1n looks rather dizzy and sick.",A_HIDEINV,meat,null,self,TO_REST);
 if (meat.position>POSITION_SITTING)
  {
  act("You sink to your knees.",A_SOMEONE,meat,null,self,TO_CHAR);
  act("$1n sinks to $1s knees.",A_SOMEONE,meat,null,self,TO_REST);
  self.position:=POSITION_SITTING;
  }
i:=(100-self.abilities[ABIL_CON]);
if (i<10) i:=10;
if (i>80) i:=80;
 dilcopy ("leprosy@midsewers(i)",meat);
 dilcopy ("leprocy_spread@midsewers",meat);
 meat.hp:=meat.hp-rnd(1,5);
 meat.endurance:=meat.endurance-rnd(1,5);
 position_update(meat);
 }
goto start;
}
goto start;
}
dilend

dilbegin slime_burn(color:string,does:string,min:integer,max:integer);
code
{
        :init:
wait(SFB_COM,self.position==POSITION_FIGHTING);
heartbeat:= PULSE_VIOLENCE*3;

        :start:
pause;
if (self.fighting.abilities[ABIL_DEX]<openroll(100,5))
{
act("A splash of the "+color+" slime hits you...&n"+
"&c+rThe slime "+does+" your skin!&cw",
A_ALWAYS,self.fighting,null,self,TO_CHAR);
act("A splash of the "+color+" slime hits $1n's face.&n"+
"$1n screams as the slime "+does+" $1s skin!",
A_ALWAYS,self.fighting,null,self,TO_REST);
self.fighting.hp := self.fighting.hp-(rnd(min,max));
position_update(self.fighting);
goto start;
}
else
{
act("You dodge a splash of the "+color+" slime!"
,A_ALWAYS,self.fighting,null,self,TO_CHAR);
act("$1n dodges a splash of the "+color+" slime!"
,A_SOMEONE,self.fighting,null,self,TO_REST);
goto start;
}
}
dilend

%rooms

sewerexit
names {"well","entrance","exit"}
title "A Narrow Well"
descr
"The rusty iron rings in this narrow well lead upwards toward the city
lights above and down into the darkness. The only light here is the small
amount falling through the opening above. The smell of sewage hangs in the
air.&nA rusty iron plaque is embedded in the wall next to you."
extra {"rusty iron plaque","plaque","sign"}
"You squint and with great difficulty read the rusty plaque:&l
  ____________________________________________________________________
 |                                                                    |
 | o                            Warning!                            o |
 |                                                                    |
 | Due to severe infestation with vermin of all sorts, the sewer area |
 | is deemed highly unsafe and dangerous. Further progress is on own  |
 | responsibility only!                                               |
 |                                                                    |
 | o   Midgaard Guild of Bedpan Cleaners && Privy Builders          o |
 |____________________________________________________________________|
"
extra {"iron rings","rings"}
"The iron rings are rusty but feel strong and secure. They better be.
You are hanging on to them."
movement SECT_INSIDE
flags {UNIT_FL_NO_WEATHER,UNIT_FL_NO_MOB}
up to wall_rd11@midgaard descr "Fresh surface air awaits there!" keyword
{"cover","manhole"} open {EX_OPEN_CLOSE,EX_CLOSED};
down to sew1 descr "Gloomy darkness hides hideous monsters down there.";
end

sewerexit2
names {"well","entrance","exit"}
title "A Narrow Well"
descr
"The iron rings of this stone well lead upwards toward the city lights
above and downwards into the darkness. The only light here is the small
amount falling through the opening high above. The smell of sewage hangs
in the air.&nA rusty iron plaque is embedded in the wall next to you."
extra {"rusty iron plaque","plaque","sign"}
"You squint and with great difficulty read the rusty plaque:&l
  ____________________________________________________________________
 |                                                                    |
 | o                            Warning!                            o |
 |                                                                    |
 | Due to severe infestation with vermin of all sorts, the sewer area |
 | is deemed highly unsafe and dangerous. Further progress is on own  |
 | responsibility only!                                               |
 |                                                                    |
 | o   Midgaard Guild of Bedpan Cleaners && Privy Builders          o |
 |____________________________________________________________________|
"
extra {"iron rings","rings"}
"The iron rings are rusty but feel strong and secure. They better be.
You are hanging on to them."
movement SECT_INSIDE
flags {UNIT_FL_NO_WEATHER,UNIT_FL_NO_MOB}
up to wall_rd2@midgaard descr "Fresh surface air awaits there!" keyword
{"cover","manhole"} open {EX_OPEN_CLOSE,EX_CLOSED};
down to sth14 descr "Gloomy darkness hides hideous monsters down there.";
end

sew1
names {"sewer"}
title "Near a Stone Well"
descr
"A stone well leads upwards from here, iron rings in the wall providing
hand- and footholds easy to climb. The sewage flows freely in the tunnel,
the horrible smell making you gag. The dark tunnels lead away into darkness
to the south and to the west."
extra {"stone well","well"}
"The stone well is narrow. It leads upwards toward a small point of light."
extra {"light above","light","point"}
"The light above you seems to be daylight of the surface world (the less
smelly one, remember?)." 
extra {"iron rings","rings"}
"The iron rings appear to be rusty, yet a shake convinces you of their
solidity."
M_SEWERS
south to sew12 descr "A dark tunnel opens in front of you.";
up to sewerexit descr "A bit of light can be seen at the top of the well.";
west to sew2 descr "A dark tunnel opens in front of you.";
end

sew2
names {"sewers"}
title "A Sewer Tunnel"
descr
"The smell of sewage permeates the air here. The tunnel continues both to
the east and west and a narrow sewer tunnel opens to the south.&nA bloated
corpse floats in the sewer water."
extra {"corpse in the water","corpse"}
"The corpse seem like it has been dead for quite some time. It stinks and
you can count every rib in its body."
extra {"$get","corpse"}
"You can't mean that... what would you do with that?"
M_SEWERS
south to sew13 descr "A small tunnel opens to the south.";
east to sew1 descr "Darkness hides the tunnel ahead.";
west to sew3 descr "Darkness hides the tunnel ahead.";
end

sew3
names {"sewers"}
title "Sewers - Below the Northern Gate of Midgaard"
descr
"A broad sewer tunnel opens ahead with a grate high above you. The voices
coming from the surface seem muffled and far away, but lots of noises
can be heard - the chat of the cityguards, complaining of the peasants,
cries of the children - all in all a perfectly normal day at the city
gates. The tunnel continues to east and west."
extra {"grate above you","grate"}
"The grate lets a tiny bit of light into the gloomy sewer. However, it is
far too high for any climbing attempts."
M_SEWERS
east to sew2 descr "The tunnel stretches away into the darkness.";
west to sew4 descr "The tunnel stretches away into the darkness.";
end

sew4
names {"sewers"}
title "A Broad Sewer Tunnel"
descr
"Walking a broad sewer tunnel, you calculate your position to be roughly
somewhere beneath the northern wall road. A narrow tunnel leads away to
the south from here, while the broad tunnel continues in to the east and
west.&nRemains of a broken jug litter the tunnel here."
extra {"remains of the jug","jug","remains"}
"The broken jug seems to litter the floor of the tunnel, peeking out of
the muck."
extra {"$get","jug","remains"}
"You decide to leave the broken jug where it is. It is sharp and you
could cut yourself, and you know that you faint at the sight of blood."
M_SEWERS
south to sew14 descr "A narrow tunnel stretches away into darkness.";
east to sew3 descr "Darkness hides the perils of the sewers.";
west to sew5 descr "Darkness hides the dangers ahead.";
end

sew5
names {"sewers"}
title "A Turn in the Broad Sewer Tunnel"
descr
"The broad sewer tunnel comes to a turn and continues in both east and
south directions. Oppressive darkness covers the corridors and the intensive
stench of the sewage steals away your air. Several small openings send
dirty water into the tunnel."
extra {"openings in the walls","openings","opening"}
"The openings are small and seem to collect wastes from the minor streets
and houses and send it into the tunnel and, incidentally, all over your
boots."
M_SEWERS
south to sew6 descr "The broad tunnel turns southwards.";
east to sew4 descr "The broad tunnel turns eastwards.";
end

sew6
names {"sewers"}
title "A Broad Sewer Tunnel"
descr
"The broad sewer tunnel is half-filled with dirty water, its smell
clinging to hair and skin. The tunnel continues to the south and north.
A small opening in the wall sends dirty water into the sewer."
extra {"opening in the wall","opening"}
"As you examine the opening closer, a stream of excrement-enriched water
hits you in your face. Yuck!"
M_SEWERS
north to sew5 descr "Darkness cover the tunnels ahead.";
south to sew7 descr "Darkness cover the tunnels ahead.";
end

sew7
names {"sewer"}
title "Sewers - Beneath the West Gate of Midgaard"
descr
"Three tunnels form a small room here at the junction of the
sewers. High above a grate lets a tiny beam of light into the gloomy
surroundings - voices can be heard through the opening. A tunnel leads
away to north, another to the south and yet another eastwards."
extra {"grate above you","grate","opening"}
"The grate leads to the outside world, yet is way too high for you to
enter."
M_SEWERS
north to sew6 descr "Darkness covers the tunnel.";
south to sew23 descr "Darkness covers the tunnel.";
east to sew8 descr "Darkness covers the tunnel.";
end

sew8
names {"sewers"}
title "A Broad Tunnel in the Sewers"
descr
"The corridor is filled with dirty water, filling your boots and sloshing
in your pockets. The terrible smell fills the air, making it hard to
breathe. The tunnel continues to the east and to the west, while a narrow
corridor leads away to the north."
M_SEWERS
north to sew14 descr "A narrow tunnel leads away into the darkness.";
east to sew9 descr "A dark tunnel opens before you.";
west to sew7 descr "The tunnel continues into the gloomy darkness.";
end

sew9
names {"sewers"}
title "Sewers - Below the Market Square"
descr
"Tunnels lead away in every direction from this room. High above, a tiny
beam of light shoots through a grate into the sewers - the busy noises of
the market come from above. The severe stench of the tunnels is slightly
lessened here because of the minute draft of fresh air from the grate."
extra {"grate high above","grate"}
"The grate high above you could provide means of escaping from this place
but unfortunately it is way too high for you to climb."
extra {"beam of light","light","beam"}
"The beam of light offers some comfort from the oppressive darkness of the
sewers."
M_SEWERS
north to blind descr "A tunnel opens to the north.";
south to sew15 descr "A broad tunnel opens to the south.";
east to sew10 descr "A tunnel disappears into the darkness.";
west to sew8 descr "A tunnel disappears into the darkness.";
end

blind
names {"sewers"}
title "A Dead-End"
descr
"A dead-end in the sewer tunnel - the corridor ends sharply at a wall of
solid concrete. The only exit from this place seems to be to the south."
M_SEWERS
south to sew9 descr "A junction of tunnels offers multiple choices there.";
end

sew10
names {"sewers"}
title "A Broad Tunnel in the Sewers"
descr
"Foul vapours rise from the streams of sewage. The smelly darkness
impairs sight and your light source does little to banish it. The tunnel
stretches away to the east and west, while a narrow tunnel joins it from
the north."
M_SEWERS
north to sew13 descr "Darkness covers the tunnel.";
east to sew11 descr "Darkness covers the tunnel.";
west to sew9 descr "Darkness covers the tunnel.";
end

sew11
names {"sewers"}
title "Sewers - Beneath the East Gate of Midgaard"
descr
"A junction of the sewer tunnels with a grate high above illuminating the
room with a tiny beam of weak light. A weak breeze of fresh air does its
best to disperse the foul stench yet attains but a momentary relief. The
tunnels stretch away into north, south and west."
extra {"beam of light","beam","light"}
"A tiny beam of light falls in from above."
extra {"grate above your head","grate"}
"The grate seems too high above to be of any use as an escape route. You
can hear voices of the guards above you."
M_SEWERS
north to sew12 descr "A tunnel leads away into darkness.";
south to sew29 descr "A tunnel leads away into darkness.";
west to sew10 descr "A tunnel leads away into darkness.";
end

sew12
names {"sewers"}
title "A Broad Sewer Tunnel"
descr
"The broad sewer tunnel leads north and south. Small openings in the walls
send smelly water into the sewage covering your boots and clothes. The
oppressive darkness is only slightly disrupted by the weak beam of light
seen to the south of here."
extra {"weak beam of light","beam","light"}
"The beam of light farther south seems to come from above."
extra {"openings in the wall","openings","opening"}
"The openings lead waste away from houses and small streets into the
sewer."
M_SEWERS
north to sew1 descr "A dark tunnel opens before you.";
south to sew11 descr "A dark tunnel opens before you.";
end

sew13
names {"sewers"}
title "A Narrow Tunnel in the Sewers"
descr
"The darkness in this narrow tunnel is extreme, your light being the only
one source of illumination here. The tunnel continues to the south and
north. Many openings in the wall lead dirty water down into the sewage in
which you travel."
extra {"openings in the wall","openings","opening"}
"The openings lead wastes away from houses and streets above you."
M_SEWERS
north to sew2 descr "The tunnel enters a larger tunnel to the north.";
south to sew13a descr "The tunnel continues to the south.";
end

sew13a
names {"sewers"}
title "A Narrow Tunnel in the Sewers"
descr
"You stand in a narrow tunnel in the Midgaard sewers. Many openings in the
wall lead dirty water down into the sewage. A small yet solid door is
visible in the west wall, sensibly placed above water level. The tunnel
continues to the south and north."
extra {"openings in the wall","openings","opening"}
"The openings lead wastes away from houses and streets above you."
M_SEWERS
west to goblin1 keyword {"small door","door"} open {EX_OPEN_CLOSE,EX_CLOSED}
descr "The small door seems quite sturdy.";
north to sew13 descr "The tunnel continues to the north.";
south to sew10 descr "The tunnel enters a larger tunnel to the south.";
end

goblin1
names {"goblin room"}
title "A Small Room in the Sewers"
descr
"This small room in the sewers is, surprisingly enough, free of the muck
and sewage, but the all-penetrating smell seems worse, if anything. Two
low tunnels lead away to the north and west and a small door is visible in
the east wall.&nJunk and garbage covers the floor of this small room,
making it seem even more cramped.&nA dirty lantern on the floor sends
light into the room."
extra {"lantern on the floor","lantern"}
"The lantern is dirty, the glass is smashed and it seems to leak smelly
oil."
extra {"$get","lantern"}
"You reach for the lantern and examine it - it is leaky, the glass is
dirty and smashed. You drop it again in disgust."
extra {"junk on the floor","junk","garbage","piles"}
"The piles of junk are smelly and seem, at the first glance, to hide nothing
more exciting than rotten rags and broken bottles... but who knows? Perhaps
you could &c+wsearch&cw it for valuables!"
extra {"$get","junk","garbage"}
"Get it..? Naah, too much stuff... perhaps you could find something worth
carrying if you cared to &c+wsearch&cw it."
movement SECT_INSIDE
ALWAYS_LIGHT
flags {UNIT_FL_NO_WEATHER,UNIT_FL_INDOORS}
east to sew13a keyword {"small door","door"} open {EX_OPEN_CLOSE,EX_CLOSED}
descr "The small door seems quite sturdy.";
north to goblin2 descr "A short tunnel leads to another room to the north.";
west to goblin3 descr "A short tunnel leads to another room to the west.";

dilbegin junksearch();
var
        pc : unitptr;
        flux : integer;
        random : integer;
        item : unitptr;
        evne : integer;
code
{
        :init:
heartbeat := PULSE_SEC*1;

        :start:
wait(SFB_CMD,(command(CMD_SEARCH))and(("junk" in argument)or("garbage" in
argument)or("pile" in argument)));

        pc := activator;
        flux := rnd(1,110);
        random := rnd(1,8);
        evne := (pc.skills[SKI_SEARCH]+pc.abilities[ABIL_BRA]);
        secure(pc,gone);
block;
act("You rummage in the pile of junk...",A_ALWAYS,pc,null,null,TO_CHAR);
act("$1n rummages in the pile of junk...",A_HIDEINV,pc,null,null,TO_REST);
pause;

if (flux > (evne*2))
{
if (random < 6)
{
act("You manage to get dirt all over yourself but your searches remain "+
"fruitless." ,A_ALWAYS,pc,null,null,TO_CHAR);
act("$1n's searches uncover absolutely nothing of value."
,A_HIDEINV,pc,null,null,TO_REST);
goto gone;
}
else
{
item := load("rat@midsewers");
pc.hp := pc.hp-(rnd(1,2));
act("You yelp, as a rat's sharp teeth close on your searching fingers!"
,A_ALWAYS,pc,null,null,TO_CHAR);
act("$1n yelps and withdraws $1s hand from a rat's teeth!"
,A_HIDEINV,pc,null,null,TO_REST);
exec("kill "+pc.name, item);
goto gone;
}
}
if (flux > evne)
{
if (random < 7)
{
act("Your search uncovers nothing.",A_ALWAYS,pc,null,null,TO_CHAR);
act("$1s efforts are obviously in vain, though."
,A_HIDEINV,pc,null,null,TO_REST);
goto gone;
}
else
{
item := load("rat@midsewers");
pc.hp := pc.hp-(rnd(1,2));
act("You yelp, as a rat's sharp teeth close on your searching fingers!"
,A_ALWAYS,pc,null,null,TO_CHAR);
act("$1n yelps and withdraws $1s hand from a rat's teeth!"
,A_HIDEINV,pc,null,null,TO_REST);
exec("kill "+pc.name, item);
goto gone;
}
}
if (flux < evne)
{
if (random == 1)
{
item := load("ratskull@midsewers");
link(item,pc);
act("With a triumphant look on your face, you pull an old rat skull forth "+
"from the garbage!" ,A_ALWAYS,pc,null,null,TO_CHAR);
act("With a triumphant look on $1s face, $1n pulls and old rat skull forth "+
"from the garbage!",A_HIDEINV,pc,null,null,TO_REST);
goto gone;
}
if (random == 2)
{
item := load("brbottle@midsewers");
link(item,pc);
pc.hp := (pc.hp-1);
act("You yelp in pain as you cut your fingers on a broken bottle!"
,A_ALWAYS,pc,null,null,TO_CHAR);
act("$1n yelps in pain as $1e cuts $1s fingers on a broken bottle!"
,A_SOMEONE,pc,null,null,TO_REST);
goto gone;
}
if (random == 3)
{
item := load("deadrat@midsewers");
link(item,pc);
act("Yes! You feel something soft and squishy in the pile and pull "+
"forth... a dead rat!" ,A_ALWAYS,pc,null,null,TO_CHAR);
act("$1n pulls a dead rat from the garbage with a glare of superiority in "+
"your direction.",A_HIDEINV,pc,null,null,TO_REST);
goto gone;
}
if (random == 4)
{
item := load("mouldbread@midsewers");
link(item,pc);
act("Aha! You uncover a piece of moulded bread!"
,A_ALWAYS,pc,null,null,TO_CHAR);
act("$1n grins as he uncovers a piece of moulded bread!"
,A_HIDEINV,pc,null,null,TO_REST);
goto gone;
}
if (random == 5)
{
item := load("rotsack@midsewers");
link(item,pc);
act("All right! An old rotting sack! Just what you needed!"
,A_ALWAYS,pc,null,null,TO_CHAR);
act("$1n dances a little gleeful dance as $1e pulls a rotting sack from "+
"the garbage.",A_HIDEINV,pc,null,null,TO_REST);
goto gone;
}
if (random == 6)
{
item := load("kettle@midsewers");
link(item,pc);
act("Ooooh! What do you know, an old and rusted kettle!"
,A_ALWAYS,pc,null,null,TO_CHAR);
act("$1n discovers a rusted kettle among the junk! You wish you were $1m."
,A_HIDEINV,pc,null,null,TO_REST);
goto gone;
}
if (random == 7)
{
item := load("rat@midsewers");
pc.hp := pc.hp-(rnd(1,2));
act("You yelp, as a rat's sharp teeth close on your searching fingers!"
,A_ALWAYS,pc,null,null,TO_CHAR);
act("$1n yelps and withdraws $1s hand from a rat's teeth!"
,A_HIDEINV,pc,null,null,TO_REST);
exec("kill "+pc.name, item);
goto gone;
}
}
        :gone:
unsecure(pc);
goto start;
}
dilend
end

goblin2
names {"goblin room"}
title "A Small Room in the Sewers"
descr
"This small room seems free of the muck and sewage, but surprisingly it
smells even worse than the sewers outside. A short low tunnel lead away
to the south.&nA couple of dirty beddings of rotten sacks cover the floor
here.&nA small, smelly fire illuminates the room."
extra {"small, smelly fire","fire"}
"Woowoo, old rags burning. Explains the smell."
extra {"$get","fire"}
"Ouch! Hot! How did you plan on getting that?"
extra {"dirty beddings","beddings", "rotten sacks", "sacks", "sack"}
"The dirty beddings seem awfully smelly and uncomfortable."
extra {"$get","beddings"}
"No, you'd rather not. Someone might want to sleep on them, but that
someone is definitely not you."
movement SECT_INSIDE
ALWAYS_LIGHT
flags {UNIT_FL_NO_WEATHER,UNIT_FL_INDOORS}
south to goblin1 descr "A short tunnel leads to another room to the north.";
end
            
goblin3
names {"goblin room"}
title "A Small Room in the Sewers"
descr
"This tiny, stinking room is utterly filled with smelly garbage and litter.
Insects infest this disgusting place, crunching under your soles. A single,
low tunnel to the easts offers a possibility to escape from here.&nA
smouldering torch on the wall provides a bit of light to the room."
extra {"garbage on the floor","floor","garbage","litter"}
"Yuck! Moulding and rotten stuff, moving with crawling insects."
extra {"insects"}
"Enough to start a zoological garden right here and now."
extra {"torch on the wall","torch"}
"An excellent torch, smouldering, crackling, smelling and generally doing
a rather wide range of unpleasant things."
extra {"$get","torch"}
"Yes, I bet you'd get anything that's not nailed down. Unfortunately for
you, they've met your kind before - the torch IS nailed down."
movement SECT_INSIDE
ALWAYS_LIGHT
flags {UNIT_FL_NO_WEATHER,UNIT_FL_INDOORS}
east to goblin1 descr "A short tunnel leads to another room to the east.";
end

sew14
names {"sewers"}
title "A Narrow Tunnel in the Sewers"
descr
"This narrow tunnel continues to the south and north in almost-complete
darkness. Dirty water sloshes in your boots and the stench is slowly
suffocating you. Many openings in the wall lead the dirty water splashing
down into the sewage."
extra {"openings in the wall","openings","opening"}
"The openings lead wastes away from houses and streets above you."
M_SEWERS
north to sew4 descr "The tunnel enters a larger tunnel to the north.";
south to sew8 descr "The tunnel enters a larger tunnel to the south.";
end

sew15
names {"sewers"}
title "A Broad Tunnel in the Sewers"
descr
"The tunnel heads north and south into the near-complete darkness. To
the north you spot a large room slightly illuminated by a thin ray of
light falling in from above. To the south, darkness hides the tunnel."
M_SEWERS
north to sew9 descr "The tunnel enters a large open space there.";
south to sew16 descr "The tunnel continues south.";
end

sew16
names {"sewers"}
title "A Junction in the Sewer Tunnel"
descr
"Tunnels continue in all directions from this place. A weak light
illuminates the south-bound tunnel - there is a grating farther ahead.
The east, west and north directions are all hidden in darkness, made even
thicker by the slight light from the south."
extra {"grating in the south tunnel","grating"}
"A grating farther ahead seems to indicate the end of sewers."
M_SEWERS
north to sew15 descr "The dark tunnel continues north.";
south to sew17 descr "The tunnel continues for a short while and ends in a
grating.";
west to sew18 descr "A smaller tunnel stretches away into the darkness.";
east to sew24 descr "A smaller tunnel stretches away into the darkness.";
end

sew17
names {"sewers"}
title "At a Large Grating in the Sewers"
descr
"You stand at a large, rusty grating in the sewers, the raw sewage swiftly
making its way around your ankles and out into the river on the other
side. Outside light falls into the sewers - it seems that you are straight
under the Royal Bridge in Midgaard."
extra {"rusty grating","grating","grate"}
"The rusty grate blocking your way seems old but very solid. A large
chain with ancient lock keeps it in place, probably rusted solid."
flags {UNIT_FL_NO_WEATHER,UNIT_FL_NO_MOB}
movement SECT_SWAMP
north to sew16 descr "The tunnel continues to the north.";
south to underbridge descr "The sewage joins the water of the river outside
the sewer." open {EX_OPEN_CLOSE,EX_CLOSED,EX_LOCKED} key bumkey keyword
{"grating","rusty grating","grate"};
end

sew18
names {"sewers"}
title "A Tunnel in the Sewers"
descr
"The tunnel continues into east and west directions. Both are dark. Both
are smelly. Both are disgusting. It's a sewer. What would any sensible
person be doing here?"
M_SEWERS
west to sew19 descr "The tunnel continues into the darkness.";
east to sew16 descr "The tunnel enters a large room there.";
end

sew19
names {"sewers"}
title "A Tunnel in the Sewers"
descr
"You are traversing a sewer tunnel, treading and sloshing in the stinking
sewage. The tunnel continues into east and west directions, the stench of
the dirty water raising and invading every pore of your skin like a fungus."
M_SEWERS
west to sew20 descr "The tunnel turns north farther to the west.";
east to sew18 descr "The tunnel continues east.";
end

sew20
names {"sewers"}
title "A Junction in the Sewers"
descr
"An east-bound tunnel joins a larger north-south bound one at this
t-junction. A whiff of fresh air comes from the south - a weak light
illuminates the tunnel there. To the north nothing but darkness can be
seen."
M_SEWERS
north to sew22 descr "The tunnel continues into the darkness.";
south to sew21 descr "You can spot light in the distance!";
east to sew19 descr "The smaller tunnel continues east.";
end

sew21
names {"sewers","grate"}
title "Near a Grate"
descr
"A grate blocks the way south from here. The sewage finds its way through
it, joining the murky waters of the Midgaard river below. Unfortunately,
though old and rusty, the grate also seems to be rusted solid and cannot be
budged no matter how much you might try. The only way out from here seems
to be back north."
extra {"rusty grate","grate"}
"Old, solid and covered with rust."
extra {"Midgaard river","river"}
"The river flows slowly outside, the fresh air tempting, freedom so close
and yet so far!"
M_SEWERS
north to sew20 descr "The tunnel continues to the north.";
end

underbridge
names {"under the bridge","bridge"}
title "Underneath the Royal Bridge"
descr
"The massive stone structure of the Royal Bridge spans above you,
stretching over the Midgaard river. A grating-covered opening to the north
sends a steady stream of sewage into the waters of the river. A series of
iron rings lead up to the bridge itself."
extra {"iron rings","rings"}
"The iron rings are fastened to the stone and ascend the Royal Bridge."
extra {"grating in the opening","grating","opening"}
"A grating covers the sewer opening, blocking entrance to the sewers."
movement SECT_INSIDE
up to royal_bridge@midgaard descr "The Royal Bridge spans overhead.";
north to sew17 descr "The dark tunnel of the sewers opens there."
open {EX_OPEN_CLOSE,EX_CLOSED} keyword {"rusty grating","grating","grate"};
/* south to river1@midgaard descr "The river flows steadily to the 
south."; */
end

sew22
names {"sewers"}
title "A Tunnel in the Sewers"
descr
"Step after step in the swampy, murk sewage, progress is made forth in the
sewer tunnel. To the south a junction of corridors can be seen, while
to the north the tunnel continues into the darkness. A small side tunnel
leads east, underneath what must be the warehouse area of Midgaard above."
M_SEWERS
north to sew23 descr "The tunnel continues into the darkness.";
east to sew30 descr "A small side-tunnel heads off into darkness.";
south to sew20 descr "Another tunnel joins this one to the south of here.";
end

sew23
names {"sewers"}
title "A Tunnel in the Sewers"
descr
"The evil stench of the sewer rises over the equally foul sewage, making
the darkness here feel confining and debilitating. To the north of here the
tunnel seems to be entering a large room, while to the south it disappears
into darkness."
M_SEWERS
north to sew7 descr "The tunnel enters a large room there.";
south to sew22 descr "The tunnel continues into the darkness.";
end

sew24
names {"sewers"}
title "A Tunnel in the Sewers"
descr
"A sewer tunnel, much like any other sewer tunnel, complete with all the
required ingredients - stench, sewage, darkness, rats - as well as some
optional extras, like urine streaming down from openings and insects
scrambling on the walls."
extra {"urine on the walls","urine","openings"}
"Well, you think it is urine, but you don't want to conduct the experiment
to find out for sure."
extra {"insects","insect"}
"A splendid cross-selection of many insect species."
M_SEWERS
east to sew25 descr "The tunnel continues into the darkness.";
west to sew16 descr "The tunnel enters a large room there.";
end

sew25
names {"sewers"}
title "A Tunnel in the Sewers"
descr
"You are traversing a sewer tunnel, treading and sloshing in the stinking
sewage, cold water trickling into your boots and clammy liquid dripping
from above. The tunnel continues into east and west directions. A smaller
tunnel heads north from here, while this one continues to east and west."
M_SEWERS
west to sew24 descr "The tunnel continues into the darkness.";
east to sew26 descr "The tunnel continues into the darkness.";
north to sew25a descr "A smaller tunnel heads north from here.";
end

sew25a
names {"sewers"}
title "A Small Tunnel"
descr
"The small tunnel turns sharply south-east here, both directions are
equally dark, smelly and unpleasant. There is no other choice than
following the tunnel, or perhaps turning back again."
M_SEWERS
south to sew25 descr "The tunnel continues into the darkness.";
east to sew28 descr "The tunnel continues into the darkness.";
end

sew26
names {"sewers"}
title "A Junction in the Tunnels"
descr
"A junction in the sewers with a tunnel heading west and another one in
the north-southern directions. A weak breeze can be felt from the south
- perhaps it is a way out. Several small holes in the walls send sewage
into the tunnel."
extra {"holes in the walls","holes","hole","walls"}
"Small holes transport sewage into the sewers from above. You refuse to
come any closer to investigate."
M_SEWERS
west to sew25 descr "The tunnel continues into the darkness.";
south to sew27 descr "The tunnel continues south toward a grate.";
north to sew28 descr "The tunnel continues north.";
end

sew27
names {"sewers","grate"}
title "Near a Grate"
descr
"A grate is blocking the southern end of this tunnel. The sewage finds its
way through the grate and joins the murky waters of the Midgaard river
below. Unfortunately, this old grate is rusted solid, and cannot be budged
no matter how much you might try. The only way out from here seems to be
back north."
extra {"rusty grate","grate"}
"Old, solid and covered with rust."
extra {"Midgaard river","river"}
"The river flows slowly outside, the fresh air tempting, freedom so close
and yet so far!"
M_SEWERS
north to sew26 descr "The tunnel continues north.";
end

sew28
names {"sewers"}
title "A Tunnel in the Sewers"
descr
"The broad sewer tunnel is joined here by another, smaller one from the
west. The broad tunnel continues north and south. Darkness covers all
directions like a thick, smelly carpet."
M_SEWERS
west to sew25a descr "A smaller tunnel heads west.";
south to sew26 descr "The tunnel continues into the darkness.";
north to sew29 descr "The tunnel continues into the darkness.";
end

sew29
names {"sewers"}
title "A Tunnel in the Sewers"
descr
"You are traversing a sewer tunnel, treading and sloshing in the stinking
sewage. A hole in the wall sends a trickle of stinking water into the
tunnel from the streets high above. To the north, a large room can be seen."
extra {"hole in the wall","hole","wall","trickle","water"}
"The dirty water is revealed to be urine upon closer investigation."
M_SEWERS
north to sew11 descr "The tunnel continues into a large room ahead.";
south to sew28 descr "Darkness covers the tunnel.";
end

sew30
names {"sewers"}
title "A Small Side Tunnel"
descr
"The small tunnel is low and several holes send dirty water down the
walls into the stinking sewage below. To the west the tunnel joins a
larger sewer tunnel, while to the east it continues into the darkness."
extra {"holes in the wall","holes","wall","water"}
"The dirty water is revealed to be urine upon closer investigation."
M_SEWERS
west to sew23 descr "The tunnel joins a larger tunnel to the west.";
east to sew31 descr "Darkness covers the tunnel.";
end
 
sew31
names {"sewers"}
title "End of the Small Tunnel"
descr
"The sewer tunnel stretches away into the darkness in the western direction
and comes to a concrete wall to the east. A stone well extends over the
sewage level, a rusty iron cover put over the hole."
extra {"stone well","well"}
"The stone well is large enough for you to enter and climb down."
extra {"rusty well cover","cover","hole"}
"The rusty cover closes the hole, but you spot no lock on it."
extra {"iron rings","rings","ring"}
"The rusty stone rings feel quite solid but rather slippery."
M_SEWERS
west to sew30 descr "The tunnel stretches away into the darkness.";
down to below1 descr "Rusty iron rings provide handholds for you to climb
into the cold, clammy darkness below." open {EX_OPEN_CLOSE,EX_CLOSED}
keyword {"rusty cover","cover"};
end

below1
names {"well"}
title "A Narrow Stone Well"
descr
"This narrow well awakens the feelings of helplessness and claustrophobia. A
long series of iron rings lead downwards into the darkness below you. Cold
air engulfs your feet. From above, a strong smell of sewage assaults your
nostrils."
extra {"iron rings","rings","ring"}
"The rusty iron rings feel reassuringly solid but are wet and quite
slippery."
movement SECT_HILLS
dilcopy slipfall@midsewers("below3@midsewers");
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_MOB}
up to sew31 descr "Strong smell of sewage comes from above." open
{EX_OPEN_CLOSE,EX_CLOSED} keyword {"rusty cover","cover"};
down to below2 descr "Cold air hits you from below.";
end

below2
names {"well"}
title "A Narrow Stone Well"
descr
"Bumping your shoulders against the cold stone walls, you are slowly
climbing the rusty iron rings in the stone well. Cold air engulfs you in
the intense darkness. A vague smell of sewage comes from high above you."
extra {"iron rings","rings","ring"}
"The rusty iron rings feel reassuringly solid but are wet and quite
slippery."
movement SECT_HILLS
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_MOB}
dilcopy slipfall@midsewers("below3@midsewers");
up to below1 descr "Smell of sewage comes from above.";
down to below3 descr "Cold air hits you from below.";
end

below3
names {"well"}
title "Bottom of a Stone Well"
descr
"This small room is the bottom of a narrow stone well. Rusty iron rings
provide hand- and footholds, allowing to climb up the well. A smell of
sewage comes from above, while the air down here is cold and humid. A
stone arch opens a low corridor to the east, a small plaque placed above
the entrance."
extra {"iron rings","rings","ring"}
"The rusty iron rings feel reassuringly solid but quite slippery."
extra {"stone arch","arch","corridor"}
"The stone arch forms a doorway leading east."
extra {"brass plaque","plaque"}
"The plaque says:&l
   __________________________________________________________
  [ o                                                      o ]
  [           Service Tunnel, Southern Bank Sewers.          ]
  [               Authorised Personnel Only!                 ]
  [                                                          ]
  [ o  Midgaard Guild of Bedpan Cleaners && Privy Builders o ]
  [__________________________________________________________]
"
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_MOB}
up to below2 descr "Smell of sewage comes from above.";
east to below4 descr "The low corridor continues east toward a junction.";
end

below4
names {"corridor"}
title "A Low Stone Corridor"
descr
"A low stone corridor, the air here feels very cold and humid. Water drips
down the walls and ceiling and condensates on your weapons and armour. West
of here the corridor concludes in a narrow round room, while to the east a
junction of corridors can be seen."
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
west to below3 descr "A narrow, round room can be seen there... bottom of
a well?";
east to below5 descr "A junction of three corridors is to the east.";
end

below5
names {"corridor","junction"}
title "A Junction"
descr
"A south-bound corridor joins the east-west corridor here. The tunnels
are all low and made of stone bricks. You notice water trickling down the
walls. Your breath is clearly visible in a small cloud of steam... it is
cold."
extra {"water on the walls","water","walls"}
"The water forms a tiny stream on the floor of the corridor."
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
west to below4 descr "The low tunnel continues west.";
south to below6 descr "The low tunnel continues south into the darkness.";
east to below13 descr "The tunnel continues toward a small, wooden door.";
end

below6
names {"corridor"}
title "A Low Stone Corridor"
descr
"The air here feels very cold, the warm steam cloud of your breath
condensing on your armour. Water trickles down the stone bricks - you
think you can hear the sound of a river above you. The corridor continues
south and north."
extra {"water on the wall","water","bricks"}
"Water trickles down the stone walls and forms a tiny stream on the floor
of the corridor."
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
north to below5 descr "The corridor leads north to a junction.";
south to below7 descr "The corridor leads south into the darkness.";
end

below7
names {"corridor"}
title "A Low Stone Corridor"
descr
"The air here feels very cold, the warm steam cloud of your breath
condensing on your armour. Water trickles down the stone bricks - you
think you can hear the sound of a river above you. The corridor continues
south and north into the darkness."
extra {"water on the wall","water","bricks"}
"Water trickles down the stone walls and forms a tiny stream on the floor
of the corridor."
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
north to below6 descr "The corridor leads north into the cold darkness.";
south to below8 descr "The corridor leads south into the darkness.";
end

below8
names {"corridor"}
title "A Low Stone Corridor"
descr
"The air here feels very cold, the warm steam cloud of your breath
condensing on your armour. Water trickles down the stone bricks - the
sounds of a river can be weakly heard through the stones over your head.
The corridor continues south and north."
extra {"water on the wall","water","bricks"}
"Water trickles down the stone walls and forms a tiny stream on the floor
of the corridor."
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
north to below7 descr "The corridor leads north into the darkness.";
south to below9 descr "The corridor leads south into the darkness.";
end

below9
names {"corridor"}
title "A Low Stone Corridor"
descr
"The stone corridor here seems to ascend slightly in the southern
direction. The humid, cold air makes you shiver and your footsteps fall
hollowly in the darkness. To the south you can see a small, round room,
much like the bottom of a well, while to the north the corridor stretches
away into the darkness."
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
north to below8 descr "The corridor leads north into the darkness.";
south to below10 descr "The corridor leads south into a small, round room.";
end

below10
names {"well"}
title "Bottom of a Stone Well"
descr
"You stand at the bottom of a narrow stone well. Rusty iron rings provide
hand- and footholds, allowing to climb up the well. A smell of sewage
comes from above, while the air down here is cold and humid. A stone arch
opens a low corridor to the north, a small plaque placed above the entrance."
extra {"iron rings","rings","ring"}
"The rusty iron rings feel reassuringly solid but quite slippery."
extra {"stone arch","arch","corridor"}
"The stone arch forms a doorway leading north."
extra {"brass plaque","plaque"}
"The plaque says:&l
   __________________________________________________________
  [ o                                                      o ]
  [             Service Tunnel, Northern Bank Sewers.        ]
  [                 Authorised Personnel Only!               ]
  [                                                          ]
  [ o  Midgaard Guild of Bedpan Cleaners && Privy Builders o ]
  [__________________________________________________________]
"
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_MOB}
up to below11 descr "Smell of sewage comes from above.";
north to below9 descr "The low corridor continues north.";
end

below11
names {"well"}
title "A Narrow Stone Well"
descr
"Cold stone walls enclose this narrow well in total darkness, providing
barely enough space to climb the iron rings set into the walls. The
darkness below is complete and cold air engulfs your feet. A strong smell
of sewage comes from above."
extra {"iron rings","rings","ring"}
"The rusty iron rings feel reassuringly solid but are wet and quite
slippery."
movement SECT_HILLS
dilcopy slipfall@midsewers("below10@midsewers");
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_MOB}
up to below12 descr "Strong smell of sewage comes from above.";
down to below10 descr "Cold air hits you from below.";
end

below12
names {"well"}
title "A Narrow Stone Well"
descr
"Bumping your shoulders against the cold stone walls, you are slowly
climbing the rusty iron rings in the stone well. The darkness below you
is complete and cold air engulfs your feet. Strong smell of sewage hangs
in the air."
extra {"iron rings","rings","ring"}
"The rusty iron rings feel reassuringly solid but are wet and quite
slippery."
movement SECT_HILLS
dilcopy slipfall@midsewers("below10@midsewers");
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_MOB}
up to sth12 descr "Strong smell of sewage comes from above.";
down to below11 descr "Cold air hits you from below.";
end

below13
names {"corridor"}
title "A Low Stone Corridor"
descr
"The low stone corridor approaches a small wooden door to the east, while
a junction of tunnels can be seen to the west. Water is dripping down the
walls and the air is cold and humid. You notice a sign on the door."
extra {"water on the walls","water","walls"}
"The water forms small pools on the ground."
extra {"small wooden door","door"}
"It is a small but solid wooden door. Someone nailed a wooden plaque on
it, quite recently it seems."
extra {"sign on the door","sign","plaque"}
"Carved in the wood is following:&l

                         O
                       OOO                OO
                    OOOOO                OOOOOO
                   OOOOOOOO        O      OOOOOO
                   OOOOOO    OO   OOO O   OOOOOO
                  OOOOOOOOO OOO    OOOO  OOOOOOOO
                  OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
                  OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
                  OOOOO    OOOOOOOOOOOOOO    OOOO
                  OOOO        OOOOOOOO        OOO
                   OOOO       OOO  OOO       OOO
                   OOOOO     OOOO  OOOO     OOOO
                     OOOOO   OOO OO OOO   OOOO
                       OOOOOOOO  OO  OOOOOOOO
                          OOOOOOO  OOOOOOO
                          O OOOOOOOOOOO O
                          O OO OOOOO OO O
                          O OO OO OO OO O
                             O OO OO O


            bEat it, hoOmaN!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
        ________________________________________________________
"
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_MOB}
west to below5 descr "The corridor leads to a small junction.";
east to orc1 descr "A small room opens before you."
open {EX_OPEN_CLOSE,EX_CLOSED} keyword {"wooden door","door"};
end

orc1
names {"room"}
title "A Small Room"
descr
"The small room here was probably meant as a space for the sewer's
maintenance squads, some remains of old tool-boxes are still here and an old
spade rusts quietly in the corner. Two exits to the south and east seem to
have been made after the creation of the sewers and seem much more crude
than the rest of the stonework."
extra {"old spade","spade"}
"The old spade is almost totally rusted. You are afraid it would fall
apart in your hands if you touched it."
extra {"$get","spade"}
"You get the spade and it falls apart in your hands, just as you thought
it would. You assemble it gingerly on the ground and hope that no-one
noticed."
extra {"old remains","tool-boxes","remains", "boxes"}
"Those old tool-boxes one most probably held picks and spades but now they
are smashed and their contents looted. Just as well, as you probably
would loot it if they still were here."
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
south to orc5 descr "An irregular corridor leads towards another room.";
east to orc2 descr "An irregular corridor leads into the towards another
room.";
west to below13 descr "A small stone corridor leads out of this place."
open {EX_OPEN_CLOSE,EX_CLOSED} keyword {"wooden door","door"};
end

orc2
names {"corridor"}
title "An Irregular Corridor"
descr
"The irregular corridor is carved in the strata of the soft limestone
below Midgaard and reinforced with old wooden beams. To the west it
enters a small room and it continues farther to the east, finally
terminating in a larger, dark room.&nA large torch on the wall provides
light and a rather large amount of smoke."
extra {"limestone"}
"An alluvial deposit of sedimentary rock, rather soft and excellent for all
sorts of stonework. Yup, it's limestone all right."
extra {"torch on the wall","torch"}
"A large, primitive torch of tar-soaked rags entwined around a large
wooden branch."
extra {"$get","torch"}
"You examine the torch on the wall but consider it way inferior to your
rather supreme light-source and thus leave it alone."
ALWAYS_LIGHT
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
west to orc1 descr "An irregular corridor leads towards a small room.";
east to orc3 descr "An irregular corridor leads into the towards another
room.";
end

orc3
names {"corridor"}
title "An Irregular Corridor"
descr
"The irregular corridor is carved in the layer of the soft limestone
below Midgaard and reinforced with old wooden beams. To the west it
continues toward a small room, and it enters a badly-lit room to the east.&n
A large torch on the wall provides light and a rather large amount of smoke."
extra {"torch on the wall","torch"}
"A large, primitive torch of tar-soaked rags entwined around a large
wooden branch."
extra {"$get","torch"}
"You examine the torch on the wall but consider it way inferior to your
rather supreme light-source and thus leave it alone."
ALWAYS_LIGHT
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
west to orc2 descr "An irregular corridor leads towards a small room.";
east to orc4 descr "A large, dark room is there.";
end

orc4
names {"room"}
title "A Large, Dark Room"
descr
"The large room is rather dark, light from the corridor casting your
long, flickering shadow into the darkness from the doorway. A lot of
stinking rags, seemingly assembled into primitive beddings, fill the
floor. The smell of old sweat and dried excrements hangs in the air. You
can leave this place by the means of two corridors, one heading west and
another south."
extra {"smelly beddings","beddings","floor","bedding","rags"}
"Some rather primitive beddings made of old, stinking rags, smelly grass
and god-knows-what-else."
extra {"$get","beddings","bedding","rags"}
"You reconsider. Not even YOU could fall asleep on one of those. You
shiver involuntarily."
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
west to orc3 descr "An irregular corridor leads towards a small room.";
south to orc10 descr "An irregular corridor leads into the towards another
room.";
end

orc5
names {"corridor"}
title "A Narrow, Irregular Corridor"
descr
"The narrow corridor is badly-lit and the only light here seems to be
coming from the room to the south and from your own light-source. The
irregular walls seem to have been carved in the soft limestone layer
below the city of Midgaard, by whom you can only guess at."
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
north to orc1 descr "The corridor enters a small room.";
south to orc6 descr "The corridor enters a room there.";
end

orc6
names {"room"}
title "A Littered Room"
descr
"You stand in a littered room with several exits leading off into south,
east and north. Lots of old bones, rubble and rags fill the floor of this
place and some strange drawings covers the ceiling.&nA small fire burns in
the middle of the room, providing heat and light."
extra {"small fire","fire"}
"A small fire, mainly created of old rags and garbage."
extra {"litter under your feet","litter","bones","rubble","rags","floor"}
"The rubbish around here seem to contain nothing of value. All bones and
old rags."
extra {"drawings on the ceiling","drawings","ceiling"}
"The odd drawings seem very tribal - how delightful, in the middle of the
sewers you have the opportunity to experience an example of genuine
ethnic art!"
ALWAYS_LIGHT
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
north to orc5 descr "An irregular corridor leads toward another room.";
south to orc11 descr "A short corridor connects this room with another.";
east to orc7 descr "A narrow corridor winds its way through the limestone.";
end

orc7
names {"corridor"}
title "A Narrow Corridor"
descr
"The narrow corridor is badly-lit and the only light here seems to be
coming from the room to the west and from your own light-source. The
irregular walls seem to have been carved in the soft limestone layer
below the city of Midgaard, by whom you can only guess at."
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
west to orc6 descr "The corridor enters a room there.";
east to orc8 descr "The corridor continues toward another room.";
end

orc8
names {"corridor"}
title "A Narrow Corridor"
descr
"The narrow corridor is badly-lit and the only light here seems to be
coming from the room to the east and from your own light-source. The
irregular walls seem to have been carved in the soft limestone layer
below the city of Midgaard, by whom you can only guess at."
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
west to orc7 descr "The corridor continues toward a small room.";
east to orc9 descr "A large, well-lit room can be seen there.";
end

orc9
names {"room"}
title "A Large Room"
descr
"This room is rather large and warm, the latter mostly due to a large
fire burning in the middle of it. Several torches lie in a heap on the
floor and a small rack with a few tail-hung dead rats stands in the corner.
There is a corridor leading north, one leading east and another yet leading
west."
extra {"large fire","fire"}
"Large fire of rags, old wood and whatever the firemaker could scavenge."
extra {"the heap of torches","torches","torch"}
"Several primitive torches lie on the floor in a large heap. You examine
them carefully and smirk at the measly craftsmanship."
extra {"$get","torches","torch","heap"}
"You snatch a torch from the heap but toss it back with disgust. Genuine
ethnic fire-sources are nothing compared to the solid, civilised light
you have."
extra {"rack of rats","rack","rats","rat"}
"The small wooden rack consists of a few sticks to which the rats have
been tied. The carcasses are starting to smell, you wonder if anyone here
is planning to eat this stuff."
extra {"$get","rats","rack","rat"}
"Yuck! Get the rats? What for?"
ALWAYS_LIGHT
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
north to orc10 descr "A short corridor leads toward a dark room.";
west to orc8 descr "The corridor leads toward a weak light.";
east to orc18 descr "You can see a junction of tunnels to the east of here.";
end

orc10
names {"corridor"}
title "A Narrow Corridor"
descr
"This narrow corridor is badly-lit and the only light here seems to be
coming from the room to the south and from your own source. Darkness covers
the northern room, but the southern room is quite well-lit."
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
north to orc4 descr "A small, dark room opens before you.";
south to orc9 descr "A large, well-lit room can be seen there.";
end

orc11
names {"corridor"}
title "A Corridor"
descr
"This narrow corridor is well-lit by a smouldering torch, securely fixed
on the wall of the corridor. It leads north and south into larger rooms.&n
A torch smoulders and smokes on the wall."
extra {"smouldering torch","torch"}
"The torch does its best to block out its own light by its smoke. You
observe it for a moment and grant the light the advantage of persistence,
but time is definitely on the side of smoke."
extra {"$get","torch"}
"You struggle with the torch for a second and manage a blackened face and
burned fingers. Blasted thing is fastened to the wall!"
ALWAYS_LIGHT
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
north to orc6 descr "A small room opens before you.";
south to orc12 descr "A large, well-lit room can be seen there.";
end

orc12
names {"room"}
title "A Large Room"
descr
"This rather large room is lit by an oil lamp, hung on a hook in the
middle of the ceiling. The bright light illuminates odd drawings on the
walls - odd scenes of orc battles, drawn by someone with less than no
talent. A large bedding is in the corner of the room and two archways
lead off into the north and east respectively. The dirty lamp sways
gently under the ceiling."
extra {"dirty oil lamp","lamp","oil lamp"}
"Gosh, a wonder this thing doesn't break and set fire to the place."
extra {"$get","lamp"}
"You don't want it. Trust me."
extra {"drawings on the walls","drawings","walls","scenes"}
"The rather bloody scenes are quite badly made. You are convinced that
you could make them better, provided you did not wear those heavy
gauntlets of yours, of course. Hmm, perhaps the artist did wear heavy
gauntlets...&nYou notice that the chalk and charcoal lines vaguely
outline a few cracks in the southern wall... strange!"
ALWAYS_LIGHT
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER}
SECRET_DOOR_DIFFICULTY(SOUTH,25)
north to orc11 descr "A tunnel leads off into another room.";
east to orc14 descr "A dark tunnel leads off.";
south to orc13 descr "There is something fishy about the drawings on the
south wall...&n" open {EX_OPEN_CLOSE,EX_CLOSED,EX_LOCKED,EX_HIDDEN}
keyword {"door","drawings","lines","cracks","crack"} key orckey@midsewers;
end

orc13
names {"hidden room"}
title "A Tiny, Hidden Room"
descr
"Aha! You have stumbled into a small, hidden room, nothing escapes your
attention! The room smells rather bad, making you wonder what it was used
for before it was put into the use as a treasure room, which it apparently
is now."
IN_ALWAYS_DARK
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_TELEPORT}
north to orc12 descr "A small door leads to a larger room."
open {EX_OPEN_CLOSE} keyword {"small door","door"} key orckey@midsewers;
end

orc14
names {"tunnel"}
title "A Tunnel"
descr
"This narrow tunnel seems oppressively black and depressing. Light can be
seen to the west, to the east the darkness is completed by the silence.
Even your light-source does little to illuminate the tunnel."
IN_ALWAYS_DARK
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_TELEPORT}
west to orc12 descr "A large room can be seen there.";
east to orc15 descr "The tunnel disappears into the darkness.";
end

orc15
names {"tunnel"}
title "A Tunnel Junction"
descr
"This narrow tunnel seems oppressively black and depressing. Light can be
seen far away to the west, to the east the darkness is completed by the
silence. An opening can be seen in the southern wall."
IN_ALWAYS_DARK
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_TELEPORT}
west to orc12 descr "A weak light can be seen in the distance.";
east to orc16 descr "The tunnel disappears into the darkness.";
south to orc25 descr "The tunnel leads off into the darkness.";
end

orc16
names {"tunnel"}
title "A Tunnel"
descr
"This narrow tunnel seems oppressively black and depressing. Light can be
seen to the east, to the west the darkness is completed by the silence.
Even your light-source does little to illuminate this place."
IN_ALWAYS_DARK
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_TELEPORT}
west to orc15 descr "Darkness abounds.";
east to orc17 descr "The tunnel disappears into the darkness.";
end

orc17
names {"room"}
title "A Painted Room"
descr
"You enter a large room, well lit by a fire burning in the middle of it,
the smoke disappearing through the cracks in the irregular walls. Series of
wall-paintings immediately capture your attention, most of the place is
covered in some sort of images. An opening in the west wall reveals
darkness beyond and another in the north wall looks no less inviting."
extra {"wall-paintings","paintings","walls","wall"}
"Upon closer examination, the paintings prove to be fairly crude images
of battle scenes and combats, several of them depict burning villages and
maimed people. Sets of what looks like orcish runes are scribbled around
the paintings. Very ethnic."
extra {"orcish runes","runes"}
"The runes are orcish and whatever they say, it is of no greater
importance to you."
extra {"fireplace","fire"}
"Hot and smoky."
ALWAYS_LIGHT
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_TELEPORT}
west to orc16 descr "Cool darkness awaits.";
north to orc18 descr "Cool darkness awaits.";
end

orc18
names {"tunnel","intersection"}
title "An Intersection in the Tunnels"
descr
"The narrow tunnels merge here, one leading west toward a well-lit room
and east off to the darkness and another one leading south into another
room. The intersection is weakly lit by the light falling in from both
rooms."
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_TELEPORT}
west to orc9 descr "A large room with a fireplace in the middle of it
can be seen there.";
south to orc17 descr "A large, weakly lit room can be seen there.";
east to orc19 descr "The tunnel disappears into the darkness.";
end

orc19
names {"tunnel"}
title "A Tunnel"
descr
"This narrow tunnel seems oppressively black and depressing. Light can be
seen far to the west, to the east the darkness is completed by the silence.
Even your light-source does little to illuminate this place."
IN_ALWAYS_DARK
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_TELEPORT}
east to orc20 descr "Darkness abounds.";
west to orc18 descr "The tunnel leads toward a small intersection.";
end

orc20
names {"tunnel"}
title "A Tunnel, Near a Small Door"
descr
"A small door blocks the eastern end of this tunnel. Into the west, the
tunnel disappears into the darkness. This narrow corridor gives you feels
oppressive - it is almost as if walls try to cave in on you from both sides."
IN_ALWAYS_DARK
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_TELEPORT}
west to orc19 descr "Darkness abounds.";
east to orc21 descr "A small room is visible to the east."
open {EX_OPEN_CLOSE,EX_CLOSED} keyword {"small door","door"};
end

orc21
names {"room"}
title "A Small Room"
descr
"This small room is quite well-lit. A quick glance introduces you to
various instruments of pain and torture spread in the room - whips, wicked
knives, strange blades and sticks and other items, the purpose of which
you can only guess. Several torches provide light and a bedding is in one
corner of the room. A thick door leads north and a small one west."
extra {"instruments of torture","instruments","whip","whips","knives",
"knife","blades","blade","sticks","items"}
"You shudder as you examine some of the items. What kind of sick mind
would create those?"
extra {"torches", "torch"}
"The smoky torches provide sufficient light to brighten this place."
ALWAYS_LIGHT
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_TELEPORT}
west to orc20 descr "A tunnel leads into darkness."
open {EX_OPEN_CLOSE,EX_CLOSED} keyword {"small door","door"};
north to orc22 descr "A small room is seen on the other side of the door."
open {EX_OPEN_CLOSE,EX_CLOSED,EX_LOCKED} keyword {"thick door","door"}
key jail_key@midsewers;
end

orc22
names {"orc jail room"}
title "An Orc Jail Room"
descr
"This room is very small, four square yards at best. The stone floor is
cold and wet and stench of blood and vomit fills the room. A solid door
leads south - it seems the only apparent exit from this place."
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_TELEPORT}
south to orc21 descr "A small room is visible to the east."
open {EX_OPEN_CLOSE,EX_CLOSED,EX_LOCKED} keyword {"thick door","door"}
key jail_key@midsewers;
end

orc25
names {"tunnel"}
title "A Dark Tunnel"
descr
"This dark, narrow tunnel leads off into the darkness south and north.
This place is distinctively damp, and you think you can hear the sounds
of running water to the south. The cold makes you shiver."
IN_ALWAYS_DARK
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_TELEPORT}
north to orc15 descr "Darkness abounds.";
south to orc26 descr "Darkness abounds.";
end

orc26
names {"tunnel","blind end"}
title "A Blind End in the Tunnel"
descr
"The tunnel ends abruptly here, the southern wall collapsed. Water can be
seen running from the cracks in the wall, disappearing among the breaks
and stones in the floor. This place feels very cold. The only apparent
way out of here is north."
IN_ALWAYS_DARK
movement SECT_INSIDE
flags {UNIT_FL_INDOORS,UNIT_FL_NO_WEATHER,UNIT_FL_NO_TELEPORT}
north to orc25 descr "Darkness abounds.";
end

sth1
names {"sewer"}
title "At a Grate"
descr
"The sewer tunnel ends abruptly at a large iron grate here. Outside, you
can see the gray waters of Midgaard River - fresh breeze cools your face
and allows you to take a deep breath. The only apparent exit from here
seems to be back south."
extra {"rusty grate","grate"}
"The iron grate is rusted permanently in place. Nothing short of a minor
earthquake would budge it now."
extra {"midgaard river","river","waters"}
"The waters of Midgaard River never looked so inviting than now, after a
good soak in the Midgaard Sewers."
M_SEWERS
south to sth4 descr "The sewers continue to the south.";
end

sth2
names {"sewer"}
title "At a Grate"
descr
"The sewer tunnel ends abruptly at a large iron grate here. Outside, you
can see the gray waters of Midgaard River and high above, the heavy
stones of the Royal Bridge. The only apparent exit from here seems to be
back south."
extra {"rusty grate","grate"}
"The iron grate is rusted permanently in place. Nothing short of a minor
earthquake would budge it now."
extra {"midgaard river","river","waters","bridge"}
"The waters of Midgaard River never looked so inviting than now, after a
good soak in the Midgaard Sewers. The Royal Bridge high above spans the
river over your head."
M_SEWERS
south to sth6 descr "The sewers continue to the south.";
end

sth3
names {"sewer"}
title "At a Grate"
descr
"The sewer tunnel ends abruptly at a large iron grate here. Outside, you
can see the gray waters of Midgaard River. The only apparent exit from
here seems to be back south."
extra {"rusty grate","grate"}
"The iron grate is rusted permanently in place. Nothing short of a minor
earthquake would budge it now."
extra {"midgaard river","river","waters","bridge"}
"The waters of Midgaard River never looked so inviting than now, after a
good soak in the Midgaard Sewers."
M_SEWERS
south to sth8 descr "The sewers continue to the south.";
end

sth4
names {"sewers"}
title "An Intersection of Sewer Tunnels"
descr
"Three tunnels collide here at this intersection, one leading north, one
leading south and one leading east. A slight breeze can be felt from the
north, while to the south and east only darkness can be seen."
extra {"breeze"}
"How can you look at a breeze?"
M_SEWERS
north to sth1 descr "You can see the tunnel ending at a large grating.";
south to sth9 descr "The tunnel disappears into the smelly darkness.";
east to sth5 descr "The tunnel disappears into the smelly darkness.";
end

sth5
names {"sewers"}
title "A Sewer Tunnel"
descr
"The tunnel here is filled with ankle-deep muck. Urine trickles down the
walls from many small openings in the walls. The dark tunnel continues
into the smelly darkness to the east and west. The southern wall looks
slightly odd - almost as if someone tried to cover up an old opening..."
extra {"openings in the walls","openings","urine","walls"}
"Those openings channel the waste from the streets right into your face."
extra {"muck under your feet","muck"}
"Ankle-deep, smelly and generally doing a great job of being as
disgusting as possible. I don't believe you need a description of the
muck."
M_SEWERS
SECRET_DOOR_DIFFICULTY(SOUTH,20)
west to sth4 descr "The tunnel continues west.";
south to sth10 descr "The tunnel disappears into the smelly darkness."
open {EX_HIDDEN,EX_OPEN_CLOSE,EX_CLOSED,EX_LOCKED}
keyword {"door","wall","opening"} key magekey;
east to sth6 descr "The tunnel disappears into the smelly darkness.";
end

sth6
names {"sewers"}
title "A Four-Way Sewer Intersection"
descr
"The muck-filled tunnels form a four-way intersection here, you are
surprised to catch a scent of fresh air coming from the north, where a
tiny point of light also promises some way of escaping this place. High
above you a grate would be an ideal way out, if it wasn't rusted into the
stone."
extra {"grate high above you","grate"}
"Too high above to offer a way out. You regard a passing turd thoughtfully
as you consider your options."
extra {"point of light","light"}
"Whoa! Light and fresh air! Let's go north (says your brain)."
M_SEWERS
north to sth2 descr "The tunnel continues toward a rusty grate.";
west to sth5 descr "The tunnel continues west.";
south to sth11 descr "The tunnel disappears into the smelly darkness.";
east to sth7 descr "The tunnel disappears into the smelly darkness.";
end

sth7
names {"sewers"}
title "A Sewer Tunnel"
descr
"The tunnel here is filled with ankle-deep muck. Urine trickles down the
walls from many small openings in the walls. The dark tunnel continues
into the smelly darkness to the east and west, while to the south you
notice an opening of a smaller, narrow tunnel."
extra {"openings in the walls","openings","urine","walls"}
"Those openings channel the waste from the streets right into your
face."
extra {"muck under/in your boots","muck"}
"Prime quality muck."
M_SEWERS
west to sth6 descr "The tunnel continues west.";
south to sth12 descr "The tunnel disappears into the smelly darkness.";
east to sth8 descr "The tunnel disappears into the smelly darkness.";
end

sth8
names {"sewers"}
title "A Sewer Tunnel Intersection"
descr
"The sewer water sloshes happily under/in your boots. The smell is making
you dizzy. The tunnel here leads north and south, while another one goes
off to the west. North from here a tiny point of light awakes your
expectations."
extra {"tiny point of light","light","point"}
"Looks like a dragon lighting a cigar."
M_SEWERS
west to sth7 descr "The tunnel continues west.";
south to sth13 descr "The tunnel disappears into the smelly darkness.";
north to sth3 descr "The tunnel leads toward a rusty grating.";
end

sth9
names {"sewers"}
title "A Sewer Tunnel"
descr
"The tunnel here is filled with ankle-deep muck. Urine trickles down the
walls from many small openings in the walls. The dark tunnel continues
into the smelly darkness to the north and south. Something about the
eastern wall seems strange..."
extra {"openings in the walls","openings","urine","walls"}
"Those openings channel the waste from the streets right into your
face."
extra {"wall"}
"The walls are all covered in muck, but you notice something that could
be the outline of a secret door in the eastern wall."
M_SEWERS
SECRET_DOOR_DIFFICULTY(EAST,20)
north to sth4 descr "The tunnel continues north.&n";
south to sth14 descr "The tunnel disappears into the smelly darkness.";
east to sth10 descr "The tunnel disappears into the smelly darkness."
open {EX_HIDDEN,EX_OPEN_CLOSE,EX_CLOSED,EX_LOCKED}
keyword {"door","opening","wall"} key magekey;
end

sth10
names {"room"}
title "A Small Room"
descr
"After a short walk through a very narrow tunnel, you arrive at a small,
very odd room. There is a noticable lack of much of any sort here and
the air also seems cleaner. The smell of urine and sewage seems to have
been traded for an odd, acidic smell. The walls of this small room are
covered in odd symbols. Two corridors lead away from this place, one to
the north and one to the south."
extra {"symbols on the walls","symbols","walls"}
"You examine the odd symbols... they seem to have some sort of magical
value, although the precise meaning is rather lost to you."
M_SEWERS
north to sth5 descr "A short tunnel leads toward a small door.";
west to sth9 descr "A short tunnel leads toward a small door."
open {EX_OPEN_CLOSE} keyword {"door"};
end

sth11
names {"sewers"}
title "A Sewer Tunnel"
descr
"The tunnel here is filled with ankle-deep muck. Urine trickles down the
walls from many small openings in the walls. Darkness covers the tunnel
to the south and north. A smaller tunnel leads away into east."
extra {"openings in the walls","openings","urine","walls"}
"Those openings channel the waste from the streets right into your
face."
M_SEWERS
north to sth6 descr "The tunnel continues north.";
south to sth16 descr "The tunnel disappears into the smelly darkness.";
east to sth12 descr "The tunnel disappears into the smelly darkness.";
end

sth12
names {"sewers"}
title "An Intersection in the Sewers"
descr
"The narrow sewer tunnel is filled with ankle-deep muck and stinking water.
This area is a nexus of two tunnels, leading north-south and east-west
respectively. In the middle of the intersection a stone well peeks above
the water level, a series of iron rings leading down into a lower level
of the sewers."
extra {"stone well","well","iron rings","rings"}
"The stone well is high enough to reach over the surface of the dirty
mud. Rusty but solid iron rings lead down into cold darkness."
M_SEWERS
north to sth7 descr "The tunnel continues north.";
south to sth17 descr "The tunnel disappears into the smelly darkness.";
east to sth13 descr "The tunnel disappears into the smelly darkness.";
west to sth11 descr "The tunnel disappears into the darkness.";
down to below12 descr "The well descends into darkness.";
end

sth13
names {"sewers"}
title "A Sewer Tunnel"
descr
"The tunnel here is filled with ankle-deep muck. Urine trickles down the
walls from many small openings in the walls. A smaller tunnel leads west
while the main sewer tunnel leads north and south."
extra {"openings in the walls","openings","urine","walls"}
"Those openings channel the waste from the streets right into your
face."
M_SEWERS
north to sth8 descr "The tunnel continues north.";
south to sth18 descr "The tunnel disappears into the smelly darkness.";
west to sth12 descr "The tunnel disappears into the smelly darkness.";
end

sth14
names {"sewers"}
title "A Sewer Tunnel"
descr
"The stench of the mud and dirty water chokes you, making you long for the
surface world again. A small shaft of light falls in from above, like a
tiny beacon in the smelly darkness, you notice iron rings set in the
wall, leading up. The tunnel continues north and south, while a smaller
tunnel leads off to the east."
extra {"shaft of light","light"}
"The thin shaft of light falls in from the surface world high above you."
M_SEWERS
north to sth9 descr "The tunnel continues north.";
south to sth19 descr "The tunnel disappears into the smelly darkness.";
east to sth15 descr "The tunnel disappears into the smelly darkness.";
up to sewerexit2 descr "The iron rings lead up toward the surface.";
end

sth15
names {"sewers"}
title "A Narrow Sewer Tunnel"
descr
"This narrow tunnel continues east and west. You keep banging your head
on the ceiling and the stinking muck sloshes in your boots. The smell
also does a great deal to keep you annoyed. The noises in the darkness
make you slightly uncomfortable to say the least."
extra {"ceiling"}
"Far too low to be comfortable."
extra {"darkness"}
"Dark, like the name implies. This means that you cannot see through it."
M_SEWERS
west to sth14 descr "The tunnel disappears into the smelly darkness.";
east to sth16 descr "The tunnel disappears into the smelly darkness.";
end

sth16
names {"sewers"}
title "A Cross of Tunnels"
descr
"The sewer tunnels cross here, a large tunnel leading north-south, while
a narrow one leads into the east-west directions. High above you a
grating lets in a tiny shaft of light - you guess that you are somewhere
underneath the Royal Avenue. Nothing royal about this place though."
extra {"grating high above","grating","light","shaft"}
"The grating is too high above for you to reach it. The light is too weak
to make any difference down here."
M_SEWERS
north to sth11 descr "The tunnel continues north.";
south to sth20 descr "The tunnel disappears into the smelly darkness.";
west to sth15 descr "The tunnel disappears into the smelly darkness.";
east to sth17 descr "The narrow tunnel disappears into the darkness.";
end

sth17
names {"sewers"}
title "A Narrow Sewer Tunnel"
descr
"This narrow tunnel is a bad place to be, especially for someone clad in
nice, clean armour. The muck sloshing in your boots and the stench
tickling your nostrils make a foul cocktail, courtesy of Midgaard above.
The tunnel continues east and west, and you can also see an opening to
the north not far from here."
extra {"muck"}
"It is sloshing in your boots."
M_SEWERS
north to sth12 descr "The tunnel continues north.";
east to sth18 descr "The tunnel disappears into the smelly darkness.";
west to sth16 descr "The tunnel disappears into the smelly darkness.";
end

sth18
names {"sewers"}
title "A T-Junction in the Sewers"
descr
"The tunnels of the sewers collide here in a T-junction, a broad tunnel
leading north and south and a smaller one disappearing into the darkness
to the west. Incredible stench rises from the muck you are standing in."
extra {"muck"}
"It is sloshing in your boots."
M_SEWERS
north to sth13 descr "The tunnel disappears into the smelly darkness.";
west to sth17 descr "The tunnel disappears into the smelly darkness.";
south to sth21 descr "The tunnel disappears into the smelly darkness.";
end

sth19
names {"sewers"}
title "A Turn in the Sewers"
descr
"You are standing at a turn in the sewer tunnels, it is possible to walk
north and east from here. To the south, a rusty grate sends dirty water
into the sewer. The muck is filling your boots with stinking squeamishness."
extra {"muck"}
"It is sloshing in your boots."
M_SEWERS
north to sth14 descr "The tunnel continues north.";
east to sth26 descr "The tunnel disappears into the smelly darkness.";
end

sth20
names {"sewers"}
title "At a Large Grating"
descr
"The sewer tunnel ends at a large grating to the south, leading waste
from what would be the palace of king Welmar. A great opportunity to see
for yourself that excrements of the nobles are just as smelly as those of
poor people. The tunnel leads north."
extra {"grating"}
"The grating is securely welded into the wall. It is impossible to enter
the palace this way."
extra {"muck"}
"It is sloshing in your boots."
M_SEWERS
north to sth16 descr "The tunnel continues north.";
end

sth21
names {"sewers"}
title "A Sewer Tunnel"
descr
"The sewer tunnel leads south and north here, small holes sending their
liquid cargo into the muck of the tunnels. The stench is unbearable. A hot
bath and a good beer are just a few of the happy thoughs that keep people
from going insane in this place."
extra {"muck"}
"It is sloshing in your boots."
M_SEWERS
north to sth18 descr "The tunnel continues north.";
south to sth22 descr "The tunnel disappears into the smelly darkness.";
end

sth22
names {"sewers"}
title "A Turn in the Tunnel"
descr
"The sewer tunnel turns ninety degrees here, leading north and west. You
ponder shortly your choices - both seem to include wading through muck
and dark sewer tunnels. Was coming down here such a good idea?"
extra {"muck"}
"It is sloshing in your boots."
M_SEWERS
north to sth21 descr "The tunnel continues north.";
west to sth23 descr "The tunnel disappears into the smelly darkness.";
end

sth23
names {"sewers"}
title "A Sewer Tunnel"
descr
"This sewer tunnel is filled with stinking muck and dirty water. It
continues east and west in depressive, smelly darkness. Small holes in
the walls send their dirty water into the sewer."
extra {"holes"}
"The holes send dirty water into the sewer from above."
extra {"muck"}
"It is sloshing in your boots."
M_SEWERS
east to sth22 descr "The tunnel disappears into the smelly darkness.";
west to sth24 descr "The tunnel disappears into the smelly darkness.";
end

sth24
names {"sewers"}
title "Below Southern Gate of Midgaard"
descr
"This sewer room is a bit larger than the tunnels and a narrow stream of
light illuminates it weakly from above. High above, the voices of gate
guards and passing travellers can be heard. North of here a solid,
large grating blocks the entrance to what should be sewers below King
Welmar's palace. Sewer tunnels lead east and west."
extra {"stream of light","light","stream"}
"Weak and narrow."
extra {"large grating","grating"}
"Too solid to move. You won't be getting into the palace this way."
M_SEWERS
east to sth23 descr "The tunnel disappears into the smelly darkness.";
west to sth25 descr "The tunnel disappears into the smelly darkness.";
end

sth25
names {"sewers"}
title "A Turn in the Tunnel"
descr
"The tunnel continues north and east from here, limiting the amount of
choices severely. Both directions seem to include any amount of sewage,
smell and oppressive darkness, as well as a splendid opportunity to come
face-to-face with the local fauna (rats) and flora (wall fungi)."
extra {"muck"}
"It is sloshing in your boots."
M_SEWERS
north to sth26 descr "The tunnel continues north.";
east to sth24 descr "The tunnel disappears into the smelly darkness.";
end

sth26
names {"sewers"}
title "A Turn in the Tunnel"
descr
"This narrow, stinking sewer tunnel turns sharply here, leading south and
west. To the north you can see a door placed above the muck level, a
small plaque placed on the curiously new-looking wood."
extra {"small door","door","plaque","sign"}
"&lThe plaque says:

           The Arena Pits have not opened yet.
               Come again in near future.

        - Skay, the Speaker for the Pitfighters -"
extra {"muck"}
"It is sloshing in your boots."
M_SEWERS
/*north to pitexit@arenapits descr "The small door leads north."
open {EX_OPEN_CLOSE,EX_CLOSED,EX_LOCKED};*/
south to sth25 descr "The tunnel disappears into the smelly darkness.";
west to sth19 descr "The tunnel disappears into the smelly darkness.";
end

%mobiles

/* Orcs! */

gobcook
names {"greasy goblin","goblin","cook"}
title "a greasy goblin"
descr "A scrawny, greasy goblin sits here, stirring in the cauldron."
extra {}
"A rather scrawny-looking goblin of darker complexion, his hairy arms and
body covered in grease and dirt. The few remaining hairs on his scalp are
hanging down over his pointy nose. He brandishes his huge wooden spoon with
pride."
race RACE_GOBLIN
sex SEX_MALE
level 18
money 2 IRON_PIECE
NATURAL_DEF(WPN_FIST,ARM_CLOTHES)
height 100
weight 70
exp 115
alignment -360
MSET_ABILITY(10,30,20,15,10,5,5,5)
MSET_WEAPON(10,15,20,13,10,10) /* Spoonman! */
MSET_SPELL(2,2,2,2,2,2,2,2,2,2,2)
special SFUN_TEAMWORK "gray orc"

dilbegin goblincook();
var
        flick   : integer;
        u       : unitptr;
code
{
        :base:
interrupt(SFB_COM,self.position==POSITION_FIGHTING,combat);
heartbeat:=PULSE_SEC*5;
        :start:
wait(SFB_DONE,TRUE);
flick:=rnd(1,5);
pause;
if (flick==1)
{
exec("emote stirs slowly in the cauldron.",self);
}
if (flick==2)
{
act("The cauldron boils and sprays hot fat all over the place.",
A_SOMEONE,self,null,null,TO_REST);
}
if (flick==3)
{
exec("sigh",self);pause;
exec("emote tastes the soup carefully.",self);
exec("puke",self);
}
if (flick==4)
{
exec("fart",self);
}
if (flick==5)
{
exec("burp",self);pause;
exec("curse",self);
}
pause;pause;
goto start;

        :combat:
heartbeat:=PULSE_VIOLENCE*2;
if (self.position!=POSITION_FIGHTING) goto base;
flick:=rnd(1,10);

if (flick==1)
{
act("$3n sends a spoonful of boiling fat flying in your direction!",
A_SOMEONE,self.fighting,null,self,TO_CHAR);
act("$3n sends a spoonful of boiling fat flying in $1n's direction!",
A_SOMEONE,self.fighting,null,self,TO_REST);
if (self.fighting.abilities[ABIL_DEX]<rnd(1,100))
{
act("&c+wThe hot fat hits you straight in the face!&cw&nAaaaaaargh!",
A_SOMEONE,self.fighting,null,self,TO_CHAR);
act("The hot fat hits $1n straight in the face!&n$1n screams in pain!",
A_SOMEONE,self.fighting,null,self,TO_REST);
self.fighting.hp:=self.fighting.hp-rnd(3,8);
position_update(self.fighting);
goto combat;
}
act("You skilfully dodge the hot blob!",
A_SOMEONE,self.fighting,null,self,TO_CHAR);
act("$1n skilfully dodges the hot blob!",
A_SOMEONE,self.fighting,null,self,TO_REST);
goto combat;
}
if (flick==2)
{
u:=findrndunit(self.outside,FIND_UNIT_SURRO,UNIT_ST_PC|UNIT_ST_NPC);
if (u.abilities[ABIL_DEX]<rnd(1,100))
{
act("You slip on the greasy floor and smash your head on the cauldron!",
A_SOMEONE,u,null,self,TO_CHAR);
act("$1n slips on the greasy floor and smashes $1s head on the hot cauldron!"
,A_SOMEONE,u,null,self,TO_REST);
u.hp:=u.hp-rnd(1,6);
position_update(u);
goto combat;
}
act("Your feet skid on the greasy floor, but you manage to keep your balance!"
,A_SOMEONE,u,null,self,TO_CHAR);
act("$1n's feet skid on the greasy floor but $1e manages to keep $1s balance!"
,A_SOMEONE,u,null,self,TO_REST);
goto combat;
}
else
{
pause;
}
goto combat;
}
dilend
end

orcguard1
names {"gray orc","orc","figure"}
title "a gray orc"
descr
"A large, dark-skinned figure sits here, carefully sharpening his weapon."
extra {}
"A large and broad-shouldered orc, his skin deeply gray. Thick beard
covers the face and the deep-set eyes glow with a soft, red light. His
greasy, black hair hang down in several braids."
race RACE_ORC
sex SEX_MALE
level 18
money 1 COPPER_PIECE
NATURAL_DEF(WPN_CLAW,ARM_LEATHER)
height 180
weight 170
exp 120
alignment -450
MSET_ABILITY(20,20,20,25,10,5,0,0)
MSET_WEAPON(15,15,15,13,10,10) /* Axe, Sword, Club */
MSET_SPELL(2,2,2,2,2,2,2,2,2,2,2)
romflags {CHAR_DETECT_INVISIBLE}
special SFUN_SCAVENGER
special SFUN_TEAMWORK"gray orc"
dilcopy rnd_fight@midsewers();
dilcopy orc_interact@midsewers();

dilbegin guardingone();
var
        pc      : unitptr;
code
{
on_activation(self.position==POSITION_FIGHTING,skip);
        :init:
heartbeat:=PULSE_SEC*3;

        :start:
wait(SFB_CMD,(command(CMD_EAST)or command(CMD_SOUTH))
and(activator.type == UNIT_ST_PC));
pc:= activator;
if ((visible(self,pc))and((pc.race!=5)or(pc.race!=6)or(pc.race!=10))
and(pc.level<40))
{
block;
act("The gray orc grabs your shoulder and pushes you roughly back."
,A_ALWAYS,pc,null,self,TO_CHAR);
act("The gray orc grabs $1n's shoulder as $1e tries to walk past him and"+
" pushes $1m roughly back.",A_SOMEONE,pc,null,self,TO_REST);
exec("say 'eez not da way ya' should be headin', ya sad git."
,self);pause;
exec("say Beat eet or 'ave eet beat'n fer ya.",self);
goto start;
}
if ((pc.race==5)or(pc.race==6))
{
exec("say 'ave fun out dere, "+pc.name+".",self);
exec("wink "+pc.name,self);
goto start;
}
if (pc.race==10)
{
exec("say One of yer kind, mmm?",self);
exec("say Pass, pass.",self);
goto start;
}
if (pc.level>IMMORTAL_LEVEL)
{
act("The orc's eyes open wide with horror as he senses your presence pass "+
"him.",A_ALWAYS,pc,null,self,TO_CHAR);
act("The orc's eyes open wide, terror blinding his brains. He whimpers softly."
,A_ALWAYS,pc,null,self,TO_REST);
goto start;
}
goto start;
}
dilend
end     

orcguard2
names {"gray orc","orc"}
title "a gray orc"
descr "A large, dark-skinned orc stands here, frowning at you."
extra {}
"A large and broad-shouldered orc, his skin dark gray, almost black.
Thick beard covers the face and the deep-set eyes glow with a soft, red
light. A large scar runs across his face, the lighter coloration of the
scar tissue clearly visible on the dark skin."
race RACE_ORC
sex SEX_MALE
level 18
money 1 IRON_PIECE, 1 COPPER_PIECE
NATURAL_DEF(WPN_CLAW,ARM_LEATHER)
height 184
weight 182
exp 120
alignment -500
MSET_ABILITY(22,20,20,23,10,5,0,0)
MSET_WEAPON(15,15,13,15,10,10) /* Axe, Sword, Pole/Chain */
MSET_SPELL(2,2,2,2,2,2,2,2,2,2,2)
romflags {CHAR_DETECT_INVISIBLE}
special SFUN_TEAMWORK"gray orc"
dilcopy rnd_fight@midsewers();
dilcopy orc_interact@midsewers();
end

orcsleeper
names {"gray orc","orc","figure"}
title "a gray orc"
descr "A large figure lies on one of the bunks, snoring soundly."
extra {}
"A large and broad-shouldered orc, his skin dark gray. Thick beard covers
the face. The eyes are very deep set and the hairy chest massive and
solid."
race RACE_ORC
sex SEX_MALE
level 18
money 7 IRON_PIECE
NATURAL_DEF(WPN_CLAW,ARM_LEATHER)
height 178
weight 168
exp 100
alignment -480
MSET_ABILITY(23,22,20,20,10,5,0,0)
MSET_WEAPON(15,15,15,13,10,10) /* Axe, Sword, Club */
MSET_SPELL(2,2,2,2,2,2,2,2,2,2,2)

dilbegin sleepdream();
var
        ddt:integer;
code
{
        :init:
on_activation(self.position==POSITION_FIGHTING,combat);
heartbeat := PULSE_SEC*(rnd(10,20));

        :start:
ddt:=(rnd(1,10));

if(ddt==1)
{
exec("snore",self);pause;
}
if(ddt==2)
{
exec("emote mumbles something incoherent in his sleep",self);pause;
}
if(ddt==3)
{
exec("emote scratches his butt and turns over.",self);pause;
}
if(ddt==4)
{
exec("emote whimpers softly in his sleep.",self);pause;
}
if(ddt==5)
{
act("A thin line of drool slowly makes its way from the orc's mouth to the "+
"blanket.",A_ALWAYS,self.outside,null,null,TO_ALL);pause;
}
if(ddt==6)
{
act("A sudden snore from the orc shakes the room!"
,A_ALWAYS,self.outside,null,null,TO_ALL);pause;
}
if(ddt==7)
{
act("A small blob of green snot extends slowly from the orc's nose."
,A_ALWAYS,self.outside,null,null,TO_ALL);
exec("emote snores loudly, pulling the snot back, and swallows.",self);
pause;
}
if(ddt==8)
{
act("Rolling over on his back, the orc smacks his mouth a few times, then "+
"starts snoring again.",A_ALWAYS,self.outside,null,null,TO_ALL);pause;
}
if(ddt==9)
{
act("The orc looks tense for a second, then farts loudly. A look of "+
"immense relief crosses his face."
,A_ALWAYS,self.outside,null,null,TO_ALL);pause;
}
if(ddt==10)
{
exec("emote hugs his blanket tightly and puts his thumb into his mouth."
,self);pause;
}
goto start;

        :combat:
exec("emote stares around wildly and grabs his club!",self);
exec("wield club",self);
quit;
}
dilend
end

sewingorc
names {"gray orc","orc","figure"}
title "a gray orc"
descr "A large, dark-skinned figure sits here, working on his armour."
extra {}
"A large and broad-shouldered orc, his skin a dark shade of gray.
Thick beard covers the face and the deep-set eyes glow with a soft, red
light. He bites his tongue as he carefully repairs his quilted armour.
A line of drool works its way down his chin, witnessing the extreme
concentration involved in this task."
race RACE_ORC
sex SEX_MALE
level 18
money 1 IRON_PIECE, 1 COPPER_PIECE
NATURAL_DEF(WPN_CLAW,ARM_LEATHER)
height 184
weight 173
exp 120
alignment -630
MSET_ABILITY(20,23,20,22,10,5,0,0)
MSET_WEAPON(15,15,15,13,10,10) /* Axe, Sword, Club */
MSET_SPELL(2,2,2,2,2,2,2,2,2,2,2)
romflags {CHAR_DETECT_INVISIBLE}
special SFUN_TEAMWORK "gray orc"
dilcopy rnd_fight@midsewers();
dilbegin orcsews();
var
        flick   : integer;
code
{
        :base:
heartbeat:=PULSE_SEC*6;

        :start:
wait(SFB_TICK,TRUE);
flick:=rnd(1,5);

if (flick==1)
{
exec("emote grumbles deeply 'Eez damn arm'r 'ere, goz 'nto picez asoon as "+
"'eez worn...'",self);pause;
}
if (flick==2)
{
exec("emote carefully guides the needle through the armour, drooling "+
"slightly.",self);pause;
}
if (flick==3)
{
exec("emote grumbles deeply 'Eef I ev'r catch deez damn arm'rer, heez 'onna "+ 
"die a bleedin', 'orrible death... bastur...'",self);pause;
}
if (flick==4)
{
act("The thread slips out of the eye of the needle."
,A_ALWAYS,self,null,null,TO_ALL);
exec("curse ",self);pause;
exec("emote starts carefully to thread the needle once again...",self);pause;
}
if (flick==5)
{
exec("grumbles deeply 'u better no d'sturbe me, 'ooman, or I'll beat da "+
"crap outta u...'",self);pause;
}
goto start;
}
dilend
end

orcboss
names {"gray orc boss","gray orc","orc","boss"}
title "a gray orc boss"
descr "An impressive gray orc paces back and forth here."
extra {}
"A large and broad-shouldered orc, with a dark-gray skin. Thick beard
covers the face and the deep-set eyes glow with a soft, red light. A large
scar forming the image of a dragon's head has been burned into his left
upper arm, the white scar tissue clearly showing on the dark skin."
race RACE_ORC
sex SEX_MALE
level 23
money 5 IRON_PIECE, 2 COPPER_PIECE
NATURAL_DEF(WPN_CLAW,ARM_LEATHER)
height 187
weight 190
exp 120
alignment -500
MSET_ABILITY(22,20,20,23,10,5,0,0)
MSET_WEAPON(15,15,15,13,10,10) /* Axe, Sword, Club */
MSET_SPELL(2,2,2,2,2,2,2,2,2,2,2)
romflags {CHAR_DETECT_INVISIBLE}
flags {UNIT_FL_NO_TELEPORT}
special SFUN_TEAMWORK "gray orc"

dilbegin orcbossguard();
var
        pc:unitptr;
code
{
on_activation(self.position==POSITION_FIGHTING,skip);
        :start:
wait(SFB_CMD,(command(CMD_SOUTH))and(activator.type == UNIT_ST_PC));
pc:=activator;
secure(pc,gone);
block;
act("$3n pushes you back, as you try to walk past $3m."
,A_ALWAYS,pc,null,self,TO_CHAR);
act("$3n pushes $1n back as $1e tries to walk past $3m."
,A_SOMEONE,pc,null,self,TO_REST);
act("&c+w$3n growls 'An' 'ere ya think, ya're goin'?'&cw"
,A_ALWAYS,pc,null,self,TO_ALL);
        :gone:
unsecure(pc);
goto start;
}
dilend

dilbegin bosschat();
var
        ddt     : integer;
        pc      : unitptr;
code
{
        :init:
interrupt(SFB_COM,self.position==POSITION_FIGHTING,combat);
heartbeat:=PULSE_SEC*10;

        :start:
ddt:=rnd(1,10);
pause;
if (ddt==1)
{
act("$1n fingers $1s armour with a dirty claw.",
A_SOMEONE,self,null,null,TO_ALL);
}
if (ddt==2)
{
exec("emote grunts, examining his blade.",self);
}
if (ddt==3)
{
act("A distant scream resounds through the tunnels.&n"+
"The orc boss grins wickedly, yellow fangs glimmering in the weak light.",
A_SOMEONE,self,null,null,TO_ALL);
}
if (ddt==4)
{
act("With a screeching noise, $1n starts to sharpen $1s weapon.",
A_SOMEONE,self,null,null,TO_ALL);
}
if (ddt==5)
{
exec("emote growls at you.",self);
}
if (ddt==6)
{
act("A sudden smell spreads in the room as $1n scratches $1s armpit.",
A_SOMEONE,self,null,null,TO_ALL);
}
else
{
pause;
}
pause;
        :combat:
heartbeat:=PULSE_VIOLENCE*2;
if (self.position!=POSITION_FIGHTING) goto init;
pc:=self.fighting;
secure(pc,start);
ddt:=rnd(1,5);
if (ddt==1)
{
exec("gut",self);pause;
goto combat;
}
if ((ddt==2)and(self.fighting.abilities[ABIL_DEX]<rnd(1,100)))
{
act("The orc boss smashes his helmeted head into your face!&n
You shake your head, trying desperately to recover!",
A_SOMEONE,pc,null,self,TO_CHAR);
act("The orc boss smashes his helmeted head into $1n's face!",
A_SOMEONE,pc,null,self,TO_REST);
pc.hp:=pc.hp-rnd(3,10);
change_speed(pc,12);
pause;pause;
goto combat;
}
if (ddt==3)
{
exec("trip "+pc.name,self);
exec("trip "+pc.name,self);
exec("trip "+pc.name,self);pause;pause;
goto combat;
}
if (ddt==4)
{
exec("kick "+pc.name,self);
exec("kick "+pc.name,self);
pause;goto combat;
}
pause;pause;
goto combat;
}
dilend
end

orcamazon
names {"gray orc","orc","amazon","female"}
title "a gray orc amazon"
descr "A female gray orc sits here, eating a piece of meat."
extra {}
"A large and broad-shouldered orc, her skin very dark gray in colour.
The lack of beard and slightly different build are the only tell-tale
signs of this orc being a female. Taking a quick look at her arms and armour,
you decide that she is definitely dangerous, perhaps even more so than the
males."
race RACE_ORC
sex SEX_FEMALE
level 20
money 2 IRON_PIECE, 1 COPPER_PIECE
NATURAL_DEF(WPN_CLAW,ARM_LEATHER)
height 178
weight 156
exp 120
alignment -720
MSET_ABILITY(20,25,15,20,15,5,0,0)
MSET_WEAPON(15,15,15,13,10,10) /* Axe, Sword, Club */
MSET_SPELL(2,2,2,2,2,2,2,2,2,2,2)
romflags {CHAR_DETECT_INVISIBLE}
special SFUN_TEAMWORK"gray orc"
dilcopy rnd_fight@midsewers();
end

wanderorc1
names {"gray orc","orc"}
title "a gray orc"
descr "A small, gray orc regards you uneasily."
extra {}
"A bit smaller than its cousins, this broad-shouldered orc is as
dark-skinned as the rest of his kin. Thick beard covers the face and the
deep-set eyes glow with a soft, red light in the murk."
race RACE_ORC
sex SEX_MALE
level 18
money 4 IRON_PIECE, 1 COPPER_PIECE
NATURAL_DEF(WPN_CLAW,ARM_LEATHER)
height 174
weight 162
exp 120
alignment -450
MSET_ABILITY(20,23,20,20,12,5,0,0)
MSET_WEAPON(15,15,15,13,10,10) /* Axe, Sword, Club */
MSET_SPELL(2,2,2,2,2,2,2,2,2,2,2)
romflags {CHAR_DETECT_INVISIBLE}
special SFUN_TEAMWORK "gray orc"
dilcopy rnd_fight@midsewers();
dilcopy orc_interact@midsewers();
end

wanderorc2
names {"gray orc","orc"}
title "a gray orc"
descr "A large, dark-skinned orc narrows his eyes, seeing you."
extra {}
"A large and broad-shouldered orc, his skin deeply gray with a lighter shade.
Thick beard covers the face and the deep-set eyes glow with a soft, red
light. His clothes are bloodied and ripped, it seems that he has been in
combat quite recently."
race RACE_ORC
sex SEX_MALE
level 20
money 7 IRON_PIECE
NATURAL_DEF(WPN_CLAW,ARM_LEATHER)
height 180
weight 170
exp 120
alignment -390
MSET_ABILITY(22,21,20,22,10,5,0,0)
MSET_WEAPON(15,15,15,13,10,10) /* Axe, Sword, Club */
MSET_SPELL(2,2,2,2,2,2,2,2,2,2,2)
romflags {CHAR_DETECT_INVISIBLE}
special SFUN_TEAMWORK"gray orc"
special SFUN_RANDOM_ZONE_MOVE time 180 bits SFB_RANTIME
dilcopy rnd_fight@midsewers();
dilcopy orc_interact@midsewers();
end

warlorc
names {"orc warlock","orc","warlock","gray orc"}
title "a gray orc warlock"
descr "A gray orc stands here in deep concentration, drawing on the wall."
extra {}
"A large and broad-shouldered orc, his gray skin scorched in many places.
Thick beard covers the face and a large tattoo of a reversed pentagram
glows through the facial hair. You can tell that he is concentrating
immensely on the task of painting due to his tongue hanging outside his
jaws."
race RACE_ORC
sex SEX_MALE
level 21
money 2 COPPER_PIECE
NATURAL_DEF(WPN_CLAW,ARM_LEATHER)
height 182
weight 162
exp 125
alignment -780
MSET_ABILITY(20,20,10,20,12,5,7,6)
MSET_WEAPON(15,15,15,13,10,10) /* Axe, Sword, Club */
MSET_SPELL(2,2,2,2,2,2,2,2,2,2,2)
romflags {CHAR_DETECT_INVISIBLE}
flags {UNIT_FL_NO_TELEPORT}
special SFUN_TEAMWORK"gray orc"
dilcopy combat_mag@function("fart","cure serious",30,2);

dilbegin orc_wardraw();
var
        i       : integer;
code
{
        on_activation(self.position==POSITION_FIGHTING,skip);

        :start:
wait(SFB_DONE,activator.type==UNIT_ST_PC);
heartbeat := PULSE_SEC*3;
pause;
i:=rnd(1,5);
on i goto i1, i2, i3, i4, i5;

        :i1:
exec("emote draws carefully a strange sign on the wall.",self);
goto rest;

        :i2:
exec("emote examines his work.",self);
goto rest;

        :i3:
exec("draw",self);
goto rest;

        :i4:
exec("emote corrects something in the drawings.",self);
goto rest;

        :i5:
exec("emote stops for inspiration.",self);
goto rest;

        :rest:
heartbeat:=PULSE_SEC*20;
pause;
goto start;
}
dilend
end

prisoner
names {"elven prisoner","prisoner","elf"}
title "an elven prisoner"
descr "An elven prisoner in a rather miserable shape sits here."
extra {}
"An elf, once so proud and fierce, now reduced to a pile of bones,
loosely held together by some skin and what might pass for muscle tissue.
His blond hair is matted by dried blood and his eyes, once green, now
yellow and blue and swollen beyond belief. He blinks rapidly as you shine
your light in his face - he looks like a torture victim."
race RACE_ELF
sex SEX_MALE
level 13
exp 0
NATURAL_DEF(WPN_FIST,ARM_CLOTHES)
height 167
weight 80
exp 80
alignment 250
MSET_ABILITY(10,20,10,10,15,20,5,10)
MSET_WEAPON(10,10,10,10,13,10) /* Axe, Sword, Club */
MSET_SPELL(2,2,2,2,2,2,5,5,5,5,5)
flags {UNIT_FL_NO_TELEPORT}
romflags {CHAR_DETECT_INVISIBLE}

dilbegin mercyscream();
code
{
on_activation(self.position!=POSITION_FIGHTING,skip);
heartbeat:=PULSE_VIOLENCE;
        :start:
wait(SFB_COM,self.position==POSITION_FIGHTING);
if (rnd(1,3)==1)
{
exec("emote begs weakly 'Mercy, stranger... mercy...'",self);
goto start;
}
if (rnd(1,2)==1)
{
exec("emote desperately begs for mercy.",self);
goto start;
}
exec("emote begs 'Please don't kill me, stranger, please...'",self);
goto start;
}
dilend
end

/* Goblinz! Snotlingz! */

droolsnot
names {"drooling snotling","snotling"}
title "a drooling snotling"
descr "A snotling sits here, drooling and picking his nose."
extra {}
"A tiny goblinoid, gaunt and dirty, his sparse hair sticky with some
unidentified liquid. His nose is dripping and he is drooling like a
madman. You also think he is mumbling something under his breath, but
that would assume intelligence, and that would be a contradiction in terms."
race RACE_GOBLIN
sex SEX_MALE
level 14
money 4 IRON_PIECE, 1 COPPER_PIECE
NATURAL_DEF(WPN_FIST,ARM_CLOTHES)
height 58
weight 50
alignment -250
MSET_ABILITY(5,30,20,10,5,0,15,15)
MSET_WEAPON(15,15,15,13,10,10)
MSET_SPELL(2,2,2,2,2,2,2,2,2,2,2)
flags {CHAR_WIMPY}
special SFUN_SCAVENGER
end

slegoblin
names {"sleazy goblin","goblin"}
title "a sleazy goblin"
descr "A goblin grins at you as you enter the room."
extra {}
"A hopelessly thin goblin, his black hair greased with some sort of oil
and glistening in the firelight. He smells terribly. Even worse, he seems
to wink at you and lick his lips as you enter the room. Uh-oh."
race RACE_GOBLIN
sex SEX_MALE
level 15
money 5 IRON_PIECE
NATURAL_DEF(WPN_FIST,ARM_CLOTHES)
height 110
weight 70
alignment -300
MSET_ABILITY(10,30,15,15,10,5,8,7)
MSET_WEAPON(15,15,15,13,10,10)
MSET_SPELL(2,2,2,2,2,2,2,2,2,2,2)
flags {CHAR_WIMPY}
special SFUN_SCAVENGER

dilbegin complain();
var
        pc      : unitptr;
        flux    : integer;
code
{
        :start:
wait(SFB_DONE,activator.type==UNIT_ST_PC);
pc:=activator;
secure(pc,start);
pause;
        :loop:
heartbeat:=PULSE_SEC*12;
flux:=rnd(1,5);
if (flux==1)
{
exec("pinch "+pc.name,self);
exec("wink "+pc.name,self);
}
if(flux==2)
{
exec("sigh",self);
exec("say Dat thevin' hooman!",self);pause;
exec("say Stole me treasure, me beatiful smooth paper!",self);pause;
exec("sigh",self);pause;
exec("say An' it wuz perf'ct fer da crapper!",self);
}
if(flux==3)
{
exec("nuzzle "+pc.name,self);
exec("wink "+pc.name,self);
}
if(flux==4)
{
exec("fondle "+pc.name,self);
exec("fondle self",self);
}
if(flux==5)
{
exec("lick "+pc.name,self);pause;
exec("say Hmm.... soapy taste...",self);pause;
exec("spit",self);
}
heartbeat:=PULSE_SEC*10;
pause;
goto loop;
}
dilend
end

snothunt
names {"snotling","basher","rat basher"}
title "a snotling rat basher"
descr "A snotling stalks the tunnel, keeping an eye on rats."
extra {}
"This charming greenish creature consists mainly of a large nose, with a
tiny goblinoid body under it. He seems wary and at attention... He must
be hunting."
race RACE_GOBLIN
sex SEX_MALE
level 13
NATURAL_DEF(WPN_FIST,ARM_CLOTHES)
height 63
weight 50
alignment -100
MSET_ABILITY(10,30,20,10,5,5,10,10)
MSET_WEAPON(10,13,15,20,10,10)
MSET_SPELL(2,2,2,2,2,2,2,2,2,2,2)
romflags {CHAR_WIMPY,CHAR_SNEAK}
special SFUN_RANDOM_ZONE_MOVE time PULSE_SEC*30
end

sicksnot
names {"sick snotling","snotling"}
title "a sick snotling"
descr "A snotling sits here, coughing and sneezing."
extra {}
"Even more disgusting than most of the goblinoids, this snotling is
virtually a large, dripping nose, with a tiny greenish body behind. It is
coughing badly - the sheer force of his smell makes you want to put him
out of his misery."
race RACE_GOBLIN
sex SEX_MALE
level 13
money 2 IRON_PIECE
NATURAL_DEF(WPN_FIST,ARM_CLOTHES)
height 65
weight 47
alignment 200
MSET_ABILITY(5,25,25,10,5,5,13,12)
MSET_WEAPON(15,15,15,13,10,10)
MSET_SPELL(2,2,2,2,2,2,2,2,2,2,2)
flags {CHAR_WIMPY}
special SFUN_SCAVENGER

dilbegin snot_drip();
var
        pc      : unitptr;
        flux    : integer;
code
{
        :start:
wait(SFB_DONE,activator.type==UNIT_ST_PC);
pc:=activator;
secure(pc,start);
pause;
        :loop:
heartbeat:=PULSE_SEC*12;
flux:=rnd(1,5);
if (flux==1) exec("sneeze "+pc.name,self);
if (flux==2) exec("cough ",self);
if (flux==3) exec("emote sniffs heavily, swallowing a huge blob of "+
"snot.",self);
pause;pause;
goto loop;
}
dilend
end

/* Battlerager */

/* Commented out as per Skay's request - Eirinn

battlerager
names {"battlerager","dwarf","rager","berzerker","berserker"}
title "a dwarf battlerager"
descr "A broad, iron-clad dwarf stands here, studying a piece of paper."
extra {}
"Broad-shouldered even by dwarven standards, his massive chest and arms are
covered with tattoos. His beard is braided into many short and greasy
braids, his face scarred and beaten and his eyes mad. He stares
obsessively into the darkness - perhaps he is looking for someone in
particular."
race RACE_DWARF
sex SEX_MALE
level 30
exp 140
money 3 COPPER_PIECE
NATURAL_DEF(WPN_FIST,ARM_HLEATHER)
height 134
weight 230
alignment 0
MSET_ABILITY(25,15,15,30,10,5,0,0)
MSET_WEAPON(14,12,20,12,10,10)
MSET_SPELL(2,2,2,2,2,2,2,2,2,2,2)
special SFUN_RANDOM_ZONE_MOVE time 200 bits SFB_RANTIME
flags {UNIT_FL_NO_TELEPORT}
dilcopy nodisarm@midsewers(
"You try to disarm $3n, but $3e blocks your attack!",
"As $1n tries to disarm $3n, $3e blocks $1s attack!",
"say Ye be a dead'un now, scum.");

dilbegin bashorcs();
var
        pc      : unitptr;
code
{
on_activation(self.position==POSITION_FIGHTING,skip);
heartbeat:=PULSE_SEC*6;
        :start:
wait(SFB_DONE,activator.type==UNIT_ST_PC);
pc:=activator;
if (pc.race==RACE_HALF_ORC)
{
secure(pc,gone);
act("$3n growls angrily at you!",A_SOMEONE,pc,null,self,TO_CHAR);
act("$3n growls angrily at $1n!",A_SOMEONE,pc,null,self,TO_REST);
pause;
if (isaff(pc,ID_SANCTUARY))
{
pause;
exec("growls 'Blasted goblinoid cobbler!'",self);
pause;
pause;
goto start;
}
else
{
exec("say Die, goblinoid scum!!",self);
exec("kill "+pc.name,self);
quit;
}
goto start;
}
if(rnd(1,3)<3)
{
pause;
exec("mumbles 'Where are them dark bast'rs at..?'",self);pause;
goto start;
}
if(rnd(1,3)<3)
{
pause;
exec("swings his OrcMasher a few times, peeking at you.",self);pause;
exec("say You feel like trashin' orc-heads too?",self);pause;
goto start;
}
if(rnd(1,2)<2)
{
pause;
exec("emote scrapes the sad remains of some orc of his weapon.",self);
pause;
exec("say Damn creeps pollute me club...",self);pause;
goto start;
}
else
{
pause;
exec("hums a dwarf battletune, 'Gold, gold, gold, gold...'",self);
pause;
exec("hums a dwarf battletune, '... and gold, gold, gold.'",self);
pause;
goto start;
}

        :gone:
unsecure(pc);
goto start;
}
dilend

dilbegin battlerage();
var
        vict : unitptr;
        flux : integer;
        resist : integer;
code
{
        :init:
on_activation(self.position != POSITION_FIGHTING, skip);
heartbeat:=PULSE_SEC*5;

wait(SFB_COM,self.position == POSITION_FIGHTING);
vict := self.fighting;
secure(vict,gone);
        :start:
resist := (vict.abilities[ABIL_STR]+vict.weapons[WPN_FIST]);
flux := rnd(1,10);
pause;

if (flux==1)
{
exec("emote cries a wild battle-cry and spins his weapon wildly!",self);
}
if (flux==2)
{
exec("emote howls madly, the muscles on his arms bulging!",self);
self.abilities[ABIL_STR] := (self.abilities[ABIL_STR])+(rnd(1,2));
self.hp := self.hp + rnd(1,2);
}
if (flux==3)
{
act("$1n screams something incoherent, smashing $1s helmeted head into "+
"your belly!&nOuch!",A_ALWAYS,self,null,vict,TO_VICT);
act("$1n screams something incoherent, smashing $1s helmeted head into "+
"$3n'1 belly!",A_SOMEONE,self,null,vict,TO_NOTVICT);
vict.hp := vict.hp - (rnd(1,5)/(resist/20));
position_update(vict);
}
if (flux==4)
{
exec("emote grits his teeth and fumes with rage!",self);
self.hp := self.hp + rnd(1,3);
position_update(self);
}
if (flux==5)
{
act("Foam and drool drips from the mouth of the maddened dwarf!",
A_ALWAYS,vict,null,self,TO_ALL);
}
if (flux==6)
{
act("$3n spins his weapon around and smashes into your legs, carried by "+
"his momentum!",A_ALWAYS,vict,null,self,TO_CHAR);
act("You lose your balance and fall!",A_ALWAYS,vict,null,self,TO_CHAR);
act("$1n spins his weapon around and smashes into $3n's legs, carried by "+
"his momentum!",A_SOMEONE,self,null,vict,TO_NOTVICT);
act("$3n loses $3s balance and falls!",A_SOMEONE,self,null,vict,TO_NOTVICT);
vict.hp := vict.hp-(rnd(1,20)/(resist/20));
vict.position := POSITION_SITTING;
position_update(vict);
}
goto start;
        :gone:
unsecure(vict);
goto init;
}
dilend
end

*/

/* Sewer Denizens */

bridge
names {"old bum","bum"}
title "an old bum"
descr "An old bum sits here, staring into the waters and drinking heavily."
extra {}
"Old and wrinkled, smelly and foul, this bum makes you miss the 
forefeeling outdoors life of cheerful, healthy people like him."
race RACE_HUMAN
sex SEX_MALE
level 13
money 1 IRON_PIECE
NATURAL_DEF(WPN_FIST,ARM_CLOTHES)
height 167
weight 102
alignment 250
MSET_ABILITY(15,15,15,15,15,5,10,10)
MSET_WEAPON(10,10,10,10,16,10)
MSET_SPELL(4,3,3,3,3,3,3,3,3,3,3)
flags {CHAR_WIMPY}
special SFUN_SCAVENGER
end

/* The leper (leprosy), temporarily removed -

leper
names {"leper","figure"}
title "a leper"
descr "A dirty figure covered in bandages wanders the tunnels."
extra {}
"A dirty leper, covered in bandages and rags. He is searching
the sewers for any stuff discarded by the denizens of the city to
help him survive."
race RACE_HUMAN
sex SEX_MALE
level 13
money 2 IRON_PIECE
NATURAL_DEF(WPN_FIST,ARM_CLOTHES)
height 167
weight 102
alignment 200
MSET_ABILITY(15,15,20,15,13,2,10,10)
MSET_WEAPON(10,10,10,16,10,10)
MSET_SPELL(5,2,2,2,2,2,2,5,5,5,2)
flags {CHAR_WIMPY}
special SFUN_SCAVENGER
special SFUN_RANDOM_ZONE_MOVE time 200 bits SFB_RANTIME
dilcopy leprosy@midsewers(10);
dilcopy leprocy_spread@midsewers();

dilbegin allopathies();
var
        i       : integer;
        pc      : unitptr;
code
{
heartbeat:=PULSE_SEC*6;
        :start:
wait(SFB_DONE,activator.type==UNIT_ST_PC);
pc:=activator;
secure(pc,start);
if (rnd(1,3)==1)
{
exec("emote coughs, spitting up some blood.",self);
goto spread;
}
if (rnd(1,2)==1)
{
exec("emote is brought down by a violent attack of spasms.",self);
goto spread;
}
exec("emote begs you for coins.",self);

        :spread:
if ((pc.abilities[ABIL_CON]+spells[SPL_INTERNAL])/2
   < openroll(100,10))
{
dilcopy("leprosy@midsewers(15)",pc);
dilcopy("leprocy_spread@midsewers",pc);
}
pause;
pause;
goto start;
}
dilend
end
*/

serpent
names {"serpent rat","rat"}
title "a serpent rat"
descr "A hideous, long naked rat hisses and scurries away."
extra {}
"A long and ugly rat, its appearance made twice as hideous by the lack of
fur. The front teeth are very large and drip with smelly saliva."
race RACE_RAT
sex SEX_NEUTRAL
level 15
exp 120
NATURAL_DEF(WPN_BITE,ARM_LEATHER)
height 15
weight 9
alignment -200
MSET_ABILITY(10,25,25,15,15,5,4,1)
MSET_WEAPON(10,10,10,10,10,10)
MSET_SPELL(7,2,2,2,2,2,2,7,7,5,2)
dilcopy rabies@midsewers();
dilcopy move@midsewers("scurries",20);
romflags {CHAR_SNEAK}
special SFUN_TEAMWORK "rat"
end

blackout
names {"black sewer rat","rat","black rat"}
title "a black sewer rat"
descr "A large black rat scurries away from beneath your feet."
extra {}
"A large black rat regards you with red, sharp eyes and sniffs the air
suspiciously. How it can smell anything at all down here is beyond your
comprehension but that's rats for you."
race RACE_RAT
sex SEX_NEUTRAL
level 13
exp 120
NATURAL_DEF(WPN_BITE,ARM_CLOTHES)
height 13
weight 5
alignment 0
MSET_ABILITY(10,25,25,15,15,5,4,1)
MSET_WEAPON(10,10,10,10,10,10)
MSET_SPELL(7,2,2,2,2,2,2,7,7,5,2)
dilcopy rabies@midsewers();
dilcopy move@midsewers("scurries",15);
romflags {CHAR_SNEAK,CHAR_WIMPY}
special SFUN_TEAMWORK "rat"
end

rat
names {"sewer rat","rat"}
title "a sewer rat"
descr "A large gray rat scurries away as you approach."
extra {}
"A large rat with gray fur, a typical denizen of the sewers. Apparently,
it takes a severe dislike to you intruding on its territory, but that's a
rat's life."
race RACE_RAT
sex SEX_NEUTRAL
level 13
exp 120
NATURAL_DEF(WPN_BITE,ARM_CLOTHES)
height 10
weight 4
alignment 0
MSET_ABILITY(10,25,25,15,15,5,4,1)
MSET_WEAPON(10,10,10,10,10,10)
MSET_SPELL(7,2,2,2,2,2,2,7,7,5,2)
dilcopy rabies@midsewers();
dilcopy move@midsewers("scurries",20);
romflags {CHAR_SNEAK,CHAR_WIMPY}
special SFUN_TEAMWORK "rat"
end

worm
names {"sewer worm","worm"}
title "a sewer worm"
descr "A large, glistening worm leaves a trail of slime across the tunnel."
extra {}
"A huge worm, at least 5 feet in length. As it writhes through the muck,
it leaves a track of clear, thick ooze. You notice sharp, jagged fangs
circling an opening at one end of the creature - this must be the mouth...
Well adapted for devouring practically ANYTHING that ends up in here."
race RACE_WORM
sex SEX_NEUTRAL
level 13
NATURAL_DEF(WPN_BITE,ARM_LEATHER)
height 164
weight 100
alignment -150
MSET_ABILITY(25,10,25,25,10,0,3,2)
MSET_WEAPON(10,10,10,10,10,10)
MSET_SPELL(2,2,2,2,2,2,3,3,3,15,4)
dilcopy move@midsewers("slithers",40);
dilcopy fido@function("$1n devours $2n.","$1n devours $2n.");
romflags {CHAR_DETECT_INVISIBLE,CHAR_SNEAK}
end

millipede
names {"millipede"}
title "a millipede"
descr "A large millipede slowly traverses the tunnel, feelers moving wildly."
extra {}
"A large and extremely disgusting insectoid, thousands of legs slowly
working the muck as it moves through the sewers. The twin feelers at its
head move around, searching for obstacles and food and the pincers at its
tail gleam sharply... you notice some sort of liquid dripping from the
points."
race RACE_OTHER_INSECT
sex SEX_NEUTRAL
level 15
exp 120
NATURAL_DEF(WPN_STING,ARM_CHAIN)
height 130
weight 50
alignment 0
MSET_ABILITY(20,15,25,25,5,0,10,0)
MSET_WEAPON(10,10,10,5,15,10)
MSET_SPELL(2,2,2,2,2,5,5,5,5,5,5)
dilcopy move@midsewers("slithers",30);
dilcopy pincerslow@midsewers();
romflags {CHAR_SNEAK}
end

/* South Sewer Mobs */

balluston
names {"balluston","sorcerer","mage","figure"}
title "Balluston"
descr "A wild-haired, wild-eyed figure stands near the vat, staring at you."
extra {}
"A strange figure, his hair wild and with that burned-away look you only
get by a prolonged exposure to various acids. The mad look in his eyes
suggests that he has been sniffing them fumes a bit too much. You recall
some gossip about a mage from Midgaard Sorcerers recently making his way
into Midgaard Sewers and causing a great deal of trouble there..."
race RACE_HUMAN
sex SEX_MALE
level 25
NATURAL_DEF(WPN_FIST,ARM_CLOTHES)
height 173
weight 148
alignment -100
MSET_ABILITY(10,10,15,15,20,15,14,1)
MSET_WEAPON(10,10,10,10,10,10)
MSET_SPELL(2,2,2,2,2,2,3,3,3,4,15)
flags {UNIT_FL_NO_TELEPORT}
dilcopy combat_mag@function("spray of acid","",0,3);

/* taken away until I understand the bloody vat

dilbegin getmebook();
var
        pc      : unitptr;
code
{
        :init:
heartbeat:=PULSE_SEC*5;

        :start:
wait(SFB_DONE,not(command(CMD_GIVE))and(activator.type & UNIT_ST_PC)
and(self.position!=POSITION_FIGHTING));

pc:=activator;
if ((GIMME_BOOK in pc.quests)or(HAVE_BOOK in pc.quests)or
(BOOK_DONE in pc.quests)) goto start;
secure(pc,gone);
if (pc.level>15)
{
if (rnd(1,2)<2)
 {
 exec("emote stares wildly at you.",self);pause;
 }
else
 {
 exec("emote screams in frustration!",self);pause;
 }
exec("say By the demon's horns! That bastard!",self);pause;
exec("say Snatched my book just like that, creep!",self);pause;
exec("say Hell to find him in those smelly tunnels.",self);pause;
if (rnd(1,2)<2)
 {
 exec("say Hey you, wanna make some fast cash?",self);pause;
 exec("point "+pc.name,self);pause;
 }
else
 {
 exec("peer "+pc.name,self);pause;
 exec("say Hmm... do you feel like earning some fast cash, "+pc.name+"?",
 self);pause;
 exec("say Don't ask me, how I know your name... I am a wizard...",self);
 exec("say ...we know such things.",self);pause;
 }
exec("say All you gotta do is to find that goblin barf who stole my book "+
"and bring it back to me.",self);pause;
if (pc.sex == SEX_FEMALE)
 {
 exec("say You up to it, me lass?",self);
 }
else
 {
 exec("say You up to it, me lad?",self);
 }
exec("say How about it?",self);

        :accept:
wait(SFB_DONE,(command(CMD_NOD)or command(CMD_SHAKE) or
(command(CMD_SAY)and (("no" in argument)or("yes" in argument))))
and(activator==pc));

        if (command(CMD_SHAKE)or(command(CMD_SAY)and("no" in argument)))
        {
        if (pc.sex == SEX_FEMALE)
         {
         exec("say Arrrghhh! You yellow-belly bitch!",self);pause;
         }
        else
         {
         exec("say Aaaarghh! You yellow-belly bastard!",self);pause;
         }
         exec("say You are no use to me! Die!",self);
         exec("cast toxicate "+pc.name,self);
         exec("cast acid drop "+pc.name,self);
         unsecure(pc);
         goto init;
        }

        if (command(CMD_NOD)or(command(CMD_SAY)and("yes" in argument)))
        {
        addextra(pc.quests,{GIMME_BOOK},"");
        exec("say Right! Get crackin', time's a waste!",self);
        exec("say This son-of-an-orc is around here somewhere!",self);pause;
        exec("say You can trust NO ONE those days.",self);
        }
goto gone;
}
        :gone:
unsecure(pc);
goto start;
}
dilend

dilbegin iwannatome();
var
        pc      : unitptr;
        item    : unitptr;
code
{
        :init:
heartbeat := PULSE_SEC*5;

        :start:
wait(SFB_DONE,(activator.type == UNIT_ST_PC)and
(GIMME_BOOK in activator.quests));
        pc := activator;
        secure(pc,gone);

if (command(CMD_GIVE)and("alchemical tome" in medium.name))
{
        subextra(pc.quests,GIMME_BOOK);
        addextra(pc.quests,{HAVE_BOOK},"");
        experience(300,pc);
exec("say Yes, that's it!",self);pause;
exec("say You got the creep!",self);pause;
exec("emote slams the tome open on the damp floor.",self);pause;
exec("emote pulls out a thick notebook and a frayed quill.",self);
if (rnd(1,2)<2)
 {
 exec("emote starts writing notes, comparing it with the book.",self);
 exec("emote cackles to himself.",self);pause;
 }
else
 {
 exec("emote flips hastily through the book, taking notes.",self);
 exec("mumbles 'Oooooh yes, Balluston you dog, you really done it "+
"this time.'",self);pause;
 }
exec("emote scratches hasty notes, mumbling under his breath.",self);
pause;
exec("emote flips the pages hastily.",self);pause;
exec("emote scratches more notes in his notebook.",self);
link(load("notebook@midsewers"),self);pause;
exec("emote puts away the quill and looks up with a distant expression in "+
"his eyes.",self);
exec("say Whattahell??? Whatcha doin' here STILL??",self);pause;
exec("say Beat it now or feel my wrath!",self);pause;pause;
exec("say You asked for it, pig-face.",self);
exec("cast toxicate "+pc.name,self);
exec("cast acid drop "+pc.name,self);
unsecure(pc);
goto start;
}
        :gone:
unsecure(pc);
goto start;
}
dilend
*/
end

branneth
names {"branneth","elf"}
title "Branneth"
descr "An elf sloshes through the sewers with a disgusted look at his face."
extra {}
"A rather noble figure of an elf, the posture and clothing implies a
high-born one, and his weapons indicate someone above the common level.
The only question is, what is he doing down here?"
race RACE_ELF
sex SEX_MALE
level 34
NATURAL_DEF(WPN_FIST,ARM_CLOTHES)
height 170
weight 135
alignment 490
MSET_ABILITY(15,30,10,15,15,10,0,5)
MSET_WEAPON(11,20,11,11,10,10)
MSET_SPELL(2,1,1,1,1,2,4,4,4,4,3)
flags {UNIT_FL_NO_TELEPORT}
dilcopy nodisarm@midsewers(
"As you try to disarm $3n, $3e parries your attack nimbly!",
"As $1n tries to disarm $3n, $3e parries $1s attack nimbly!",
"say Die, you pathetic peasant!");

dilbegin fencing();
var
        pc      : unitptr;
        flux    : integer;
        smack   : integer;
code
{
        :init:
heartbeat:= PULSE_SEC*6;
        :start:
wait(SFB_COM,self.position==POSITION_FIGHTING);
pc := self.fighting;
secure(pc,gone);
flux:= rnd(1,10);

if (pc.hp<0)
{
exec("shout "+pc.name+" shall bother me no more.",self);
exec("kill "+pc.name,self);
goto start;
}

if(flux==1)
{
act("$3n makes a sudden lunge at your exposed flank!",
A_SOMEONE,pc,null,self,TO_CHAR);
act("$3n makes a sudden lunge at $1n's exposed flank!",
A_SOMEONE,pc,null,self,TO_REST);
smack:=meleeattack(self,pc,rnd(10,20),200);
}
if(flux==2)
{
act("$3n ripostes your attack and responds with a furious slash!",
A_SOMEONE,pc,null,self,TO_CHAR);
act("$3n ripostes $1n's attack and responds with a furious slash!",
A_SOMEONE,pc,null,self,TO_REST);
smack:=meleeattack(self,pc,rnd(15,25),200);
}
if(flux==3)
{
exec("kick "+pc.name,self);
}
if(flux==4)
{
act("$3n jumps back and lunges forth with his blade!",
A_SOMEONE,pc,null,self,TO_ALL);
smack:=meleeattack(self,pc,rnd(10,25),200);
}
if(flux==5)
{
exec("trip "+pc.name,self);
exec("trip "+pc.name,self);
exec("trip "+pc.name,self);
}
goto start;
        :gone:
unsecure(pc);
goto start;
}
dilend

dilbegin brother_quest1();
var
        pc      : unitptr;
        item    : unitptr;
        pro     : string;
code
{
        :init:
on_activation(self.position == POSITION_FIGHTING,skip);
heartbeat := PULSE_SEC * 8;

        :start:
wait(SFB_DONE,(not(command(CMD_GIVE)))and(activator.type == UNIT_ST_PC));
pc := activator;
secure(pc,gone);

if((BROTHER_DONE in pc.quests)or(BROTHER_ON in pc.quests)or
((pc.race==RACE_HALF_ORC)and(pc.alignment<350)))
{
exec("emote greets you with a bow.",self);
pause;pause;pause;pause;
      unsecure(pc);
      goto start;
}

if (pc.sex==SEX_FEMALE) pro:="lady";
else pro:= "sir";

if (rnd(1,2)==1) exec("say Argh! Accursed place!",self);
else exec("say Ugh! I hate this place!",self);
pause;
exec("say How can Thou stand it?",self);
exec("sigh",self);pause;
exec("say Thou are doubtless wondering what I'm doing in a place like this, "
+"noble "+pro+".",self);pause;
exec("say Of course, I could ask the very same question of Thee.",self);
exec("chuckle",self);pause;
if (rnd(1,2)==1) exec("emote puts a handkerchief to his nose.",self);
else exec("smile "+pc.name,self);
exec("say The smell here is truly sickening, but I am here for a "+
"purpose.",self); pause;
exec("say The foolish brother of mine travelled down here a few weeks ago."
,self);
if (rnd(1,2)==1) exec("emote rolls his eyes.",self);
else exec("emote shakes his head sadly.",self);
pause;
exec("say ...prompted to undertake a foolish quest by a woman.",self);pause;
if (pc.sex==SEX_FEMALE) 
exec("say With Thee pardons, m'lady, he's a fool for deep blue eyes.",self);
else exec("say He's a fool for deep blue eyes, a slightly debilitating "+
"mental disorder of his.",self); pause;
exec("say I fear, he might fallen prey to the sewer-dwellers.",self);pause;
exec("say Have Thee met him somewhere, "+pro+"? Tall, blond hair, green "+
"eyes?",self);
act("$3N looks at you questioningly...",A_SOMEONE,pc,null,self,TO_CHAR);
act("$3N looks at $1n questioningly...",A_SOMEONE,pc,null,self,TO_REST);

        :nod:
      wait(SFB_CMD,(activator == pc));
      if(command(CMD_SHAKE)or(command(CMD_SAY)and("no" in argument)))
        {
         pause;
         exec("sigh",self);pause;
         exec("say Thank Thee nontheless, "+pro+", I will keep looking."
         ,self);
         unsecure(pc);
         goto start;
        }
      if(command(CMD_NOD)or(command(CMD_SAY)and("yes" in argument)))
        {
         pause;
         exec("say Thou saw him! Where is he, pray tell?!",self);
         goto whereishe;
        }
        else goto nod;

                :whereishe:
        wait(SFB_CMD,(activator == pc)and command(CMD_SAY));
        if(("dead" in argument)or("died" in argument))
        {
        pause;
        exec("emote pales as he hears the dreadful news.",self);
        exec("say That can't be true!",self);
        pause;
        exec("say He must still be alive somewhere!",self);
        pause;
        exec("say I'll find him, "+pro+", I know he is still alive!",self);
        exec("emote runs off into the tunnels.",self);
        destroy(self);
        }
        if (("jail room" in argument)or("jail" in argument)or
        ("imprisoned" in argument)or("prison" in argument))
        {
        pause;
        exec("say I knew it!",self);
        exec("say He did venture down to the orc-creatures!",self);pause;
        exec("spit",self);
        if(pc.race==RACE_HALF_ORC) exec("say Begging Thee pardon, "+pro+"."
        ,self);pause;
        exec("say I though as much, but I didn't dare to venture into the "+
        "orc's nest openly.",self);pause;
        if (rnd(1,2)==1) exec("sigh",self);
        else exec("emote ponders the problem.",self);
        pause;
        exec("say With an orcish disguise, I could bypass the orcs and "+
        "free my brother.",self);pause;
        exec("say I would need a full-face helmet to conceal my rugged, "+
        "yet handsome elven features.",self);pause;
        exec("emote thinks for a while.",self);
        exec("say A cloak to hide the slenderness of my body.",self);
        pause;
/* Commented out due to the unavailability of shitkickers - Eirinn 

        exec("say Some heavy boots! Yes, heavy boots to give my stride "+
        "the weight of a walking orc!",self);pause;
*/
        exec("emote thinks deeply.",self);pause;
        exec("say A sword of the orc-creatures to help me pass unnoticed."
        ,self);
        exec("say A simple cutlass, nothing too fancy though... Wouldn't "+
        "like to be the centre of attention...",self);pause;
        exec("say Ah...",self);pause;
        exec("say Something to make me smell like one... A "+
        "strong-smelling liquid...",self);
        exec("sigh",self);pause;
        exec("say The horrors we undergo for our family.",self);pause;
        exec("say Would care to help me with those, "+pro+"?",self);

                :nod2:
      wait(SFB_CMD,(activator == pc));
      if(command(CMD_SHAKE)or(command(CMD_SAY)and("no" in argument)))
        {
         pause;
         exec("sigh",self);pause;
         exec("say Thank you nontheless, "+pro+".",self);
         exec("emote wanders off into the tunnels.",self);
         destroy(self);
        }
      if(command(CMD_NOD)or(command(CMD_SAY)and("yes" in argument)))
        {
         pause;
         addextra(pc.quests,{BROTHER_ON},"");
         exec("say Splendid! I will await Thee return here!",self);pause;
         if (pc.sex==SEX_FEMALE)
          {
          act("$3n elegantly kisses your hand.",A_SOMEONE,pc,null,self,TO_CHAR);
          act("$3n elegantly kisses $1n's hand.",A_SOMEONE,pc,null,self,TO_REST);
          }
         else exec("hand "+pc.name,self);
         pause;
         exec("emote bids you goodbye with a bow.",self);
         pause;pause;pause;pause;
         goto gone;
        }
        else goto nod2;
        }

        :gone:
unsecure(pc);
goto start;
}
dilend

dilbegin brother_quest2();
var
        pc      : unitptr;
        item    : unitptr;
        inve    : extraptr;
        pro     : string;
code
{
        :init:
   heartbeat := PULSE_SEC* 6;

        :start:
wait(SFB_DONE,(activator.type == UNIT_ST_PC)and
    (BROTHER_ON in activator.quests));
   pc := activator;
   secure(pc,gone);

if (command(CMD_GIVE))
{
item := medium;
inve := BROTHER_ON in pc.quests;

if ((item.nameidx $= "plumhelm")and(item.zoneidx $= "midsewers"))
  {
        if ("helm" in inve.names)
        {goto already;}
        else
        {
        addstring(inve.names,"helm");
        exec("say Perfect! This will completely cover my face!",self);
        exec("emote stashes the helmet away into his bag.",self);
        destroy(item);
        goto allstuff;
        }
   }
/* Commented out due unavailability of shitkickers - Eirinn
 
   if ((item.nameidx $= "shitkickers")and(item.zoneidx $= "midsewers"))
  {
        if ("boots" in inve.names)
        {goto already;}
        else
        {
        addstring(inve.names,"boots");
        exec("emote almost retches at the terrible smell of the boots."
        ,self);
        exec("emote stashes the boots quickly into his bag.",self);
        exec("say Splendid, I thank Thee very much!",self);
        destroy(item);
        goto allstuff;
        }
   }
*/
if ((item.nameidx $= "gobcloak")and(item.zoneidx $= "midsewers"))
  {
        if ("cloak" in inve.names)
        {goto already;}
        else
        {
        addstring(inve.names,"cloak");
        exec("say Incredibly disgusting and smelly, perfect disguise!",self);
        exec("emote puts the cloak into his bag.",self);
        destroy(item);
        goto allstuff;
        }
   }
if ((item.nameidx $= "tankard")and(item.zoneidx $= "midsewers"))
  {
        if ("ale" in inve.names)
        {goto already;}
        else
        {
        addstring(inve.names,"ale");
        exec("emote coughs at the strong smell of the tankard.",self);
        exec("say Oh dear, foul stuff... Many thanks.",self);
        destroy(item);
        goto allstuff;
        }
   }
if ((item.nameidx $= "sercutlass")and(item.zoneidx $= "midsewers"))
  {
        if ("sword" in inve.names)
        {goto already;}
        else
        {
        addstring(inve.names,"sword");
        exec("say What a crude and primitive weapon!",self);
        exec("say It will do nicely.",self);
        exec("emote stashes the cutlass away into his bag.",self);
        destroy(item);
        goto allstuff;
        }
   }
else
   {
        exec("emote looks vaguely puzzled.",self);pause;
        exec("say I don't think I can use that... Please have it back.",self);
        exec("give "+item.name+" "+pc.name,self);
        unsecure (pc);
        goto start;
   }
}
goto allstuff;

        :already:
exec("emote smiles broadly.",self);pause;
exec("say I already received one of those from Thou!",self);
exec("give "+item.name+" "+pc.name,self);
unsecure(pc);
goto start;

        :allstuff:
/* Original 
if (("helm" in inve.names)and("boots" in inve.names)and
("cloak" in inve.names)and("ale" in inve.names))
*/

if (("helm" in inve.names) and ("cloak" in inve.names) 
and ("ale" in inve.names))
goto complete;

else
{
unsecure (pc);
goto start;
}

        :complete:
   subextra(pc.quests, BROTHER_ON);
   addextra(pc.quests,{BROTHER_DONE},"");
   experience(1500,pc);
if (pc.sex==SEX_FEMALE) pro:="lady";
else pro:= "sir";
pause;
exec("say Splendid, now I got all I need!",self);pause;
exec("say I don't know how to thank Thee, kind "+pro+"!",self);
exec("say Here, I humbly beg Thee to accept those as a small token of my "+
"gratitude.",self);
item:=findunit(self,"elven rapier",FIND_UNIT_IN_ME,null);
link(item,pc);
item:=findunit(self,"elven misericord",FIND_UNIT_IN_ME,null);
link(item,pc);
act("$3n hands you $3s weapons.",A_SOMEONE,pc,null,self,TO_CHAR);
act("$3n hands $1n $1s weapons.",A_SOMEONE,pc,null,self,TO_REST);
pause;
exec("say A sign of elven friendship, those weapons are Thee to command!"
,self);pause;
exec("say I must be going now, to rescue my brother!",self);
exec("say Godspeed in all Thee travels, "+pro+".",self);pause;
exec("emote bows and leaves hastily.",self);
unsecure(pc);
destroy(self);

   :gone:
   unsecure(pc);
   goto start;
}
dilend
end

furbone
names {"furbone","filcher","thief","figure"}
title "Furbone the filcher"
descr
"A figure steps forth from the shadows, almost giving you a heart attack."
extra {}
"A low, suspicious-looking figure. What can this guy be doing down here?
Seems like he's offering you something."
race RACE_HUMAN
sex SEX_MALE
level 23
NATURAL_DEF(WPN_FIST,ARM_CLOTHES)
height 168
weight 140
alignment -320
MSET_ABILITY(20,30,10,20,10,5,5,0)
MSET_WEAPON(11,20,11,11,10,10)
MSET_SPELL(2,1,1,1,1,2,4,4,4,4,3)
romflags {CHAR_SNEAK,CHAR_WIMPY}
flags {UNIT_FL_NO_TELEPORT}
dilcopy nodisarm@midsewers(
"$3n counters your move with a faster one of $3s own!",
"$3n counters $1n's move with a faster one of $3s own!",
"say Stupid moron.");

dilcopy shopkeeper@function(
{"sapphire_ring@midsewers 1 2","selen_necklace@midsewers 2 4",
"garnet_circlet@midsewers 1 2"},
{
 "$1n shakes $1s head.",
 "$1n raises $1s eyebrow. What was that thing to sell again?",
 "$1n shakes $1s head.",
 "$1n frowns.",
 "$1n nods and grins.",
 "$1n nods and grins.",
 "$1n peers around, he apparently doesn't have the merchandise.",
 "$1n scratches $1s head. Perhaps you should come by later?"
  },{"1","24"}, "2 3 4 8 10", 100, 50,2*PLATINUM_MULT,"", "" );
end

/* Slimes */

slime_red
names {"red slime","slime"}
title "a red slime"
descr "A red slime oozes along the ground."
extra {}
"A blob of red-coloured slime, slowly oozing along the ground."
BASE_SLIME(23)
exp 120
dilcopy slime_burn@midsewers("red","burns",3,5);
dilcopy slimedeath@midsewers();
end

slime_green
names {"green slime","slime"}
title "a green slime"
descr "A green slime oozes along the ground."
extra {}
"A blob of green-coloured slime, slowly devouring everything in its path."
BASE_SLIME(23)
dilcopy slime_burn@midsewers("green","scorches",5,7);
dilcopy slimedeath@midsewers();
end

slime_black
names {"black slime","slime"}
title "a black slime"
descr "A black slime oozes along the ground."
extra {}
"A blob of stinking, black-coloured slime, slowly devouring everything in
its path."
BASE_SLIME(23)
dilcopy slime_burn@midsewers("black","boils",1,6);
dilcopy slimedeath@midsewers();
end

slime_purple
names {"purple slime","slime"}
title "a purple slime"
descr "A purple slime oozes along the ground."
extra {}
"A blob of sticky, purple-coloured slime slowly oozes forth, leaving a
trail of frozen, cracking mud behind it."
BASE_SLIME(23)
dilcopy slime_burn@midsewers("purple","frosts",1,6);
dilcopy slimedeath@midsewers();
end

gutter_runner
names {"gutter-runner","skaven","runner","gutter"}
title "a skaven gutter-runner"
descr
"Cold terror grips you, you have a feeling that someone is watching you!"
extra {}
"Hidden deeply in the shadows, the gutter-runner is a very young skaven
ratling, seeking his prey in the sewers. He eyes you hungrily."
race RACE_SKAVEN
sex SEX_MALE
level 23
NATURAL_DEF(WPN_CLAW,ARM_LEATHER)
height 170
weight 148
alignment -772
exp 125
money 5 COPPER_PIECE
MSET_ABILITY(15,35,10,20,15,0,5,0)
MSET_WEAPON(15,20,10,10,10,10)
MSET_SPELL(2,0,0,0,0,2,4,4,4,4,5)
romflags {CHAR_SNEAK,CHAR_DETECT_INVISIBLE}
flags {UNIT_FL_NO_TELEPORT}
dilcopy bitedisease@skaven();
dilbegin runner_ambush();
var
        pc      : unitptr;
code
{
heartbeat:=PULSE_SEC*10;
        :start:
wait(SFB_DONE,(activator.type==UNIT_ST_PC) and (visible(self,activator)));
pc:=activator;
secure(pc,start);
if (rnd(1,2)==1)
act("&c+wA whisper comes from the dark 'Aaaah... prey...'&cw",
A_SOMEONE,self,null,null,TO_ALL);
else act("&c+wA whisper comes from the dark 'Mmmmm... homid kill-kill...'&cw"
,A_SOMEONE,self,null,null,TO_ALL);
pause;
if (rnd(1,2)==1)
act("&c+wA whisper comes from the dark 'Tasste my blade, homid creature...'&cw"
,A_SOMEONE,self,null,null,TO_ALL);
else
act("&c+wA whisper comes from the dark 'Homid blood... Yum-yum... "+
"kill-kill...&cw",A_SOMEONE,self,null,null,TO_ALL);
pause;
if ((not(isaff(pc,ID_SANCTUARY)))and(pc.level<200))
exec("backstab "+pc.name,self);
else 
act("&c+wA whisper comes from the dark 'Curssse your magic, homid... "+
"curssssse you!'&cw",A_SOMEONE,self,null,null,TO_ALL);
pause;pause;pause;pause;pause;pause;
goto start;
}
dilend
end

%objects

/* Orc Stuff */

chalk
names {"piece of chalk","piece","chalk"}
title "a piece of chalk"
descr "A piece of chalk lies here, forgotten by all."
extra {}
"A piece of chalk! Perfect for drawing! Use is easy, just hold it and DRAW."
type ITEM_PEN
manipulate {MANIPULATE_TAKE,MANIPULATE_HOLD}
cost 3 IRON_PIECE

dilbegin chalk_draw();
var
        targ    : unitptr;
        flux    : integer;
code
{
        :start:
wait(SFB_CMD,command("draw")and (activator==self.outside) and
(self.equip==WEAR_HOLD));
block;

if (rnd(1,10)==1)
{
sendtext("The chalk breaks in your hand before you can find an outlet "+
"for your creative urges.&n",self.outside);
destroy(self);
}

if (argument) targ:=findunit(self.outside,argument,FIND_UNIT_HERE,null);

if ((targ!=null)and(targ.type!=UNIT_ST_ROOM))
{
        if (targ.type == UNIT_ST_OBJ)
        {
        act("You happily colour $2n white with your chalk.",
        A_SOMEONE,self.outside,targ,self,TO_CHAR);
        act("Smiling happily, $1n colours $2n white with $1s $3N.",
        A_SOMEONE,self.outside,targ,self,TO_REST);
        goto start;
        }
        if ((targ.type==UNIT_ST_PC)or
        ((targ.type==UNIT_ST_NPC)and(targ.race<1000)))
        {
        act("You attempt to paint $3n's face white, but $3e seems to object.",
        A_SOMEONE,self.outside,self,targ,TO_CHAR);
        act("You stop $3n's attempts to paint your face white with $3s $2N.",
        A_SOMEONE,targ,self,self.outside,TO_CHAR);
        act("$3n stops $1n's attempts at painting $3n's face white with $2n.",
        A_SOMEONE,self.outside,self,targ,TO_NOTVICT);
        goto start;
        }
        if (targ==self.outside)
        {
        act("You happily paint your face white.",
        A_SOMEONE,self.outside,self,null,TO_CHAR);
        act("$1n happily paints $1s face white with $2n.",
        A_SOMEONE,self.outside,self,null,TO_REST);
        }
        act("Hmm... you are not sure $3n would like it at all.",
        A_SOMEONE,self.outside,self,targ,TO_CHAR);
        act("$1n gives $3n a meaningful look, twiddling $2n in $1s fingers.",
        A_SOMEONE,self.outside,self,targ,TO_REST);
        goto start;
}
flux:=rnd(1,5);

if (flux==1)
{
act("You draw a happy face on your armour before someone can stop you.",
A_SOMEONE,self.outside,self,null,TO_CHAR);
act("$1n draws a happy face on $1s armour with $2n.",
A_SOMEONE,self.outside,self,null,TO_REST);
}
if (flux==2)
{
act("You colour your face white.",
A_SOMEONE,self.outside,self,null,TO_CHAR);
act("$1n colours $1s face white with $2n.",
A_SOMEONE,self.outside,self,null,TO_REST);
}
if (flux==3)
{
act("You draw a very magical-looking rune on the ground.",
A_SOMEONE,self.outside,self,null,TO_CHAR);
act("$1n draws a mystic-looking rune on the ground.",
A_SOMEONE,self.outside,self,null,TO_REST);
}
if (flux==4)
{
act("You draw your weapon... on the ground.",
A_SOMEONE,self.outside,self,null,TO_CHAR);
act("$1n draws $1s weapon... with $2n.",
A_SOMEONE,self.outside,self,null,TO_REST);
}
if ((flux==5)and(targ.type!=UNIT_ST_NPC))
{
act("The creative urge comes upon you, you locate a nearby chapel and "+
"draw elaborate frescos on the walls, until the local priest kicks you out.",
A_SOMEONE,self.outside,self,null,TO_CHAR);
act("With great haste, $1n speeds off to a nearby temple and manages to "+
"colour half of the walls white before the local priests drags "+
"$1m off.",A_SOMEONE,self.outside,self,null,TO_REST);
}
goto start;
}
dilend
end

tankard
names {"tankard of orc ale","tankard","orc ale","ale","dark ale"}
title "a tankard of orc ale"
descr "A tankard of orc ale stands here."
extra {}
"A heavy tin tankard of dark and foamy orcish ale. This foul stuff has
a strong smell that makes your eyes water."
manipulate {MANIPULATE_TAKE,MANIPULATE_HOLD}
LIQ_DEF(LIQ_DARKALE,2,10,10,0)
cost 7 IRON_PIECE
end

cauldron
names {"cauldron","pot"}
title "a cauldron"
descr "A bubbling cauldron stands over the fire."
extra {}
"A heavy, blackened cauldron with some strange stuff cooking inside. It
looks a lot like a soup and the smell is rather nice... Perhaps you
should eat some."
extra {"soup in the cauldron","soup","stuff"}
"Very gory-looking stuff."
CONTAINER_DEF(100)
weight 50

dilbegin soupeat();
var
        pc : unitptr;
code
{
        :start:
wait(SFB_CMD,((command(CMD_EAT))or(command(CMD_TASTE)))
and("soup" in argument));
block;
pc := activator;
secure(pc,gone);
act("You slurp some of the soup in the $2N... not bad at all."
,A_ALWAYS,pc,self,null,TO_CHAR);
act("You sip some more and remove a rat's tail from in between your teeth."
,A_ALWAYS,pc,self,null,TO_CHAR);
act("$1n slurps some of the soup in the $1N noisily and licks his mouth."
,A_SOMEONE,pc,self,null,TO_REST);
act("$1e takes another sip and removes the rat's tail stuck between $1s "+
"teeth.",A_SOMEONE,pc,self,null,TO_REST);
if (pc.full > 23) goto cheers;
else {pc.full:= pc.full+rnd(0,(24-pc.full));}
        :cheers:
if (pc.thirst > 23) goto maet;
else {pc.thirst:= pc.thirst+rnd(0,(24-pc.thirst));}
goto start;
        :maet:
act("You are full.",A_ALWAYS,pc,self,null,TO_CHAR);
act("$1n burps loudly.",A_SOMEONE,pc,self,null,TO_REST);
        :gone:
unsecure(pc);
goto start;
}
dilend
end

soup
names {"foul bubbling stuff","soup","stuff"}
title "foul bubbling stuff"
descr "Some foul stuff is bubbling here."
extra {}
"Actually not as foul as it appears to be, the soup looks quite nice."
FOOD_DEF(10,0)
end

leather_tool
names {"leatherworking tool", "leather tool", "tool"}
title "a leatherworking tool"
descr "A sharp, leatherworking tool lies here."
extra {}
"A sharp, versatile tool for leatherworking. With this you would be much
better at resizing leathers."
/*extra {"$identify"}
"This item will increase your leatherworking skills by 5%."*/
manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD}
WEAPON_DEF(WPN_DAGGER,-5,0)
/*SKILL_TRANSFER(SKI_RESIZE_LEATHER,+5)*/
weight 1
cost 10 COPPER_PIECE
/*rent 40 IRON_PIECE*/
end

blanket
names {"old blanket","blanket"}
title "an old blanket"
descr "An old blanket lies at your feet, smelling of dust and mould."
extra {}
"An old blanket of dirty-gray colour. The smell is rather overpowering and
makes you want to retch. However, it can still keep you warm."
extra {"$wear_s"}
"You wrap $2n around your body.&nYou feel nice and warm. Hmmm... :)"
extra {"$rem_s"}
"You stop using $2n.&nYou can feel the cold biting at you already! Brrr...
:("
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_ABOUT}
type ITEM_TRASH
MATERIAL_CLOTH("This blanket is made of cotton.")
weight 4
cost 3 IRON_PIECE
end

scabbard
names {"sword scabbard","scabbard"}
title "a sword scabbard (empty)"
descr "A scabbard for your sword lies here."
extra {}
"A long scabbard, fitting for a broadsword, longsword or a greatsword. If
you want to keep your wielded weapon safely away, just 'SHEATH' it
while you wear the scabbard on your back. To remove the weapon from the
sheath, 'DRAW' it with your free weapon hand."
extra {"$wear_s"}
"You sling the scabbard over your back."
extra {"$wear_o"}
"$1n slings the scabbard over $1s back."
extra {"$no_engrave"}
"I cannot engrave this scabbard, it would be a waste of money."
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_BACK}
type ITEM_OTHER
weight 2
cost 3 COPPER_PIECE
CONTAINER_DEF(50)
MATERIAL_LEATHER("This scabbard is made of boiled leather.")

dilbegin scabbardget();
code
{
        :start:
wait(SFB_DONE,(command(CMD_GET))and(medium == self));
self.title :=  "a sword scabbard (empty)";
goto start;
}
dilend

dilbegin scabbarding();
var
        pc : unitptr;
        ting : unitptr;
        imig : unitptr;
code
{
        :start:
wait(SFB_CMD,(command("sheath"))or(command("draw"))
and(self.equip == WEAR_BACK));

pc := self.outside;
ting := equipment(pc,WEAR_WIELD);
imig := self.inside;
block;

if (command("sheath"))
{

if (ting) goto putaway;
else
{
act("You are not wielding a weapon to sheath!"
,A_ALWAYS,pc,null,null,TO_CHAR);
goto start;
}
        :putaway:
if (imig) goto fyldt;

if ((ting.value[0] == 16)or(ting.value[0] == 17)or(ting.value[0] == 11))
{
act("You sheath your $2N in your scabbard.",A_ALWAYS,pc,ting,null,TO_CHAR);
act("$1n sheaths $1s $2N in $1s scabbard.",A_HIDEINV,pc,ting,null,TO_REST);
link(ting,self);
self.title :=  "a sword scabbard ("+ting.name+" sheathed)";
goto start;
}
else
{
act("This weapon doesn't fit in your scabbard!"
,A_ALWAYS,pc,null,null,TO_CHAR);
goto start;
}
        :fyldt:
act("There is a weapon sheathed in your scabbard already."
,A_ALWAYS,pc,ting,null,TO_CHAR);
goto start;
}

if (command("draw"))
{
if (imig)
{
if (ting)
{
act("You are already wielding a weapon!",A_ALWAYS,pc,ting,null,TO_CHAR);
goto start;
}
else
act("You draw $2n from your scabbard.",A_ALWAYS,pc,imig,null,TO_CHAR);
act("$1n draws $2n from $1s scabbard.",A_ALWAYS,pc,imig,null,TO_REST);
link(imig,pc);
addequip(imig,WEAR_WIELD);
self.title :=  "a sword scabbard (empty)";
goto start;
}
else
act("Your scabbard is empty.",A_ALWAYS,pc,ting,null,TO_CHAR);
goto start;
}
goto start;
}
dilend
end

wall_water
names {"pool","cracks","breaks","stones","running water","water"}
title "the small pool"
descr "A small pool of water has accumulated between the stones."
extra {}
"The water seems to be flowing from the cracks in the wall and disappears
again into the breaks in the floor. It feels cold and surprisingly fresh."
LIQ_DEF(LIQ_WATER,0,10000,10000,0)
end

bumkey
names {"large, rusty key","rusty key","key"}
title "a large, rusty key"
descr "A large key rusts here."
extra {}
"Gosh, another large key with lots of rust on it."
manipulate {MANIPULATE_TAKE}
type ITEM_KEY
weight 2
end

/* Orc Armour */

cookapron
names {"cook's apron","apron"}
title "a cook's apron"
descr "A cook's apron with an inscription lies here."
extra {}
"A once-white, now greasy gray-brown cook's apron. A large inscription,
seemingly made with dried blood, says:&l

                        kiLl tHe CoOk
                   ________________________"
ARMOUR_CLOTHES(-5,0)
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_ABOUT}
MATERIAL_CLOTH("This was once linnet, now is mainly organic.")
weight 1
cost 2 IRON_PIECE
end

ironhoop
names {"small iron hoop","hoop","earring","ring"}
title "a small iron hoop"
descr "A small hoop of iron lies here."
extra {}
"A small hoop of iron. You can wear it in your ear like an earring if you
fancy such heavy metal there."
type ITEM_WORN
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_EAR}
weight 0
cost 8 IRON_PIECE
end

chitplate
names {"chitinous breastplate","plate","armour","breastplate"}
title "a chitinous breastplate"
descr "A large breastplate seemingly made from insect carapace lies here."
extra {}
"This plate seems to be made of the chitinous carapace of some sort of
huge insect. It seems hard and damage resistant yet quite light. The
interlocking section of the armour seem to provide excellent protection."
extra {"$identify"}
"Your spell reveals this armour to be quite light and thus almost
unencumbering, while providing a protection equal to a plate mail."
extra {"$improved identify"}
"The chitinous plate has craftsmanship of 0 and no magical enchantments."
ARMOUR_PLATE(0,0)
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_BODY}
MATERIAL_ORGANIC("This is made of chitinous insect carapace.")
weight 5
cost 3 SILVER_PIECE
dilcopy abi_restrict@function(ABIL_DEX,30,0,0,"dex_rest@skaven");
dilcopy abi_restrict@function(ABIL_STR,50,0,0,"str_rest@skaven");
end

qtunic
names {"quilted tunic","tunic"}
title "a quilted tunic"
descr "A thick, quilted tunic lies here."
extra {}
"A strong quilted tunic, able to withstand quite a lot of battering. This
is a good protection for the light-weight fighter."
ARMOUR_LEATHER(0,0)
MATERIAL_CLOTH("This is cloth.")
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_BODY}
weight 5
cost 7 IRON_PIECE
end

qbreeches
names {"quilted breeches","breeches"}
title "quilted breeches"
descr "Some thick, quilted breeches lie here."
extra {}
"Strong, quilted breeches, providing adequate protection to the leg and
groin area for the light-weight fighter."
ARMOUR_LEATHER(0,0)
MATERIAL_CLOTH("This is cloth.")
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_LEGS}
weight 5
cost 6 IRON_PIECE
end

blkbandana
names {"black bandana","bandana"}
title "a black bandana"
descr "A cool, black bandana lies here."
extra {}
"A black bandana, rather worn but still very cool-looking. For maximum
effect you can tie it around your head."
extra {"$wear_s"}
"You tie the $2n around your head.&nYou feel more cool.&nYour nose starts
to tingle."
extra {"$wear_o"}
"$1n ties a $2n around $1s head."
extra {"$rem_s"}
"You untie the $2n and remove it.&nYou feel less cool.&nYour nose stops
tingling."
extra {"$rem_o"}
"$1n unties $1s $2n and removes it."
ARMOUR_CLOTHES(0,0)
MATERIAL_CLOTH("The bandana is made of cotton.")
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_HEAD}
weight 0
cost 4 IRON_PIECE
end

redbandana
names {"red bandana","bandana"}
title "a red bandana"
descr "A hefty, red bandana lies here."
extra {}
"A red bandana, slightly used but still very cool-looking. For maximum
effect you can tie it around your head."
extra {"$wear_s"}
"You tie the $2n around your head.&nYou feel way cool.&nYour head starts to
itch."
extra {"$wear_o"}
"$1n ties a $2n around $1s head."
extra {"$rem_s"}
"You untie the $2n and remove it.&nYou feel less cool.&nYour head stops
itching."
extra {"$rem_o"}
"$1n unties $1s $2n and removes it."
ARMOUR_CLOTHES(0,0)
MATERIAL_CLOTH("The bandana is made of cotton.")
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_HEAD}
weight 0
cost 4 IRON_PIECE
end

pothelm
names {"old pot-helm","pot-helm","helm","pot"}
title "an old pot-helm"
descr "An old and rusty pot-helm lies here."
extra {}
"A rather rusty and old pot-helm. It seems to have survived its share of
battles and is quite worn and holed. If it could speak, it would probably
ask you to leave it alone to rust in peace."
ARMOUR_PLATE(-10,-3)
MATERIAL_METAL("Heavy metal.")
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_HEAD}
weight 4
cost 5 IRON_PIECE
dilcopy abi_restrict@function(ABIL_STR,30,0,0,"str_rest@skaven");
end

hornhelm
names {"horned helmet","helmet","helm"}
title "a horned helmet"
descr "An old, horned helmet lies here."
extra {}
"An old horned helmet of hard leather reinforced with steel strips to
provide maximum protection to the head. It seem worn but still in working
condition. The horns are blackened and sharp."
extra {"horns on your helmet","horns","horn"}
"A pair of large, black horns, rather impressive. It makes you feel like
a minotaur. Mooooooooooooo."
ARMOUR_HRD_LEATHER(0,0)
MATERIAL_LEATHER("This is a reinforced boiled leather helmet.")
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_HEAD}
weight 3
cost 20 IRON_PIECE
/*rent 4 IRON_PIECE
dilcopy abi_restrict@function(ABIL_STR,15,0,0,"");*/
end

plumhelm
names {"plumed helmet","helmet","helm"}
title "a red-plumed helmet"
descr "A red-plumed helmet lies here."
extra {}
"A very impressive plumed helmet, featuring a nose-guard and a pair of
ear-plates to fully cover your face. The red plume on the top of the helmet
seems to be made of horse hair and would give you the look of the leader."
extra {"red plume on your helmet","plume"}
"Red. Very impressive."
/*extra {"$identify"}
"The plumed helmet will increase your leadership among your followers
and slightly improve your authority."
extra {"$improved identify"}
"It will add +3 to Leadership and +1 to Cha. However, the glimmering
steel will make stealth actions more difficult. It provides
protection of a plate armour with craftsmanship 2 and magic bonus 1."*/
ARMOUR_PLATE(0,0)
MATERIAL_METAL("This helmet is made of solid steel.")
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_HEAD}
/*SKILL_TRANSFER(SKI_LEADERSHIP,+3)
SKILL_TRANSFER(SKI_SNEAK,-2)
SKILL_TRANSFER(SKI_HIDE,-2)
CHA_TRANSFER(+1)*/
weight 5
/*rent 50 IRON_PIECE*/
cost 5 SILVER_PIECE
/*dilcopy abi_restrict@function(ABIL_STR,70,0,0,"str_rest@skaven");*/
end

bladeshield
names {"bladed shield","shield"}
title "a bladed shield"
descr "A medium-sized shield with two protruding blades lies here."
extra {}
"A medium-sized wooden shield, the original black and red paint still
shoving vaguely in places. Two short blades have been mounted on the edge
of the shield, providing an excellent slashing weapon and adding the
'cutting edge' to your bashes."
/* extra {"$identify"}
"This medium-sized shield will aid you in shield bashes but the blades
might make any fancy fencing you want to attempt harder."
extra {"$improved identify"}
"The Bash bonus is +5 but your Disarm skill falls by 3.&nThis shield has
craftsmanship of -1 and no magical enchantments." */
MATERIAL_WOOD("This is a wooden shield.")
SHIELD_DEF(SHIELD_MEDIUM,0,0)
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_SHIELD}
/*SKILL_TRANSFER(SKI_BASH,+5)
SKILL_TRANSFER(SKI_DISARM,-3)*/
weight 5
/*rent 40 IRON_PIECE*/
cost 4 COPPER_PIECE
/* dilcopy abi_restrict@function(ABIL_STR,35,0,0,""); */
end

/* Commented out by Eirinn as per Skay's Request
shitkickers
names {"steel-toed boots","boots"}
title "steel-toed boots"
descr "A pair of heavy, steel-toed boots stands here."
extra {}
"A pair of hard-leather boots with solid steel reinforcements at the
tips. You notice several scratches in the metal - surely those boots have
found several crotches to kick in their lifetime!"
extra {"$identify"}
"Those boots improve your kicking ability and the heavy steel toes
improve your kicking damage."
extra {"$improved identify"}
"The Kick bonus is +5%, your fleeing abilities suffer -5% penalty due to
the heavy weight of the boots. Beware, as the heavy weight of the boots
can make you lose balance if you are not careful!&nThose boots are made
of hard leather with craftsmanship 2 and a minor magical bonus of 1."
ARMOUR_HRD_LEATHER(2,1)
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_FEET}
WEAPON_TRANSFER(WPN_KICK,+5)
SKILL_TRANSFER(SKI_FLEE,-5)
MATERIAL_LEATHER("Hard leather!")
weight 6
cost 3 SILVER_PIECE
rent 29 IRON_PIECE
dilcopy abi_restrict@function(ABIL_STR,25,0,0,"str_rest@skaven");
dilcopy ski_restrict@function(SKI_KICK,10,0,0,"");

dilbegin shitkickers();
var
        n : integer;
        pc : unitptr;
        vict : unitptr;
        splash : integer;
        hehe : integer;
code
{
        :init:
on_activation(self.outside.position!=POSITION_FIGHTING,skip);

        :start:
wait(SFB_CMD,(command(CMD_KICK))and(self.equip==WEAR_FEET)
and(activator==self.outside));
pc:=activator;
secure(pc,gone);
vict:=pc.fighting;
splash:=(rnd(0,110));
block;

if (splash<20)
{
act("&c+gYou send your heavy boot swinging at $3n!&cw"
,A_ALWAYS,pc,self,vict,TO_CHAR);
act("&c+g$1n sends $1s heavy boot swinging at $3n!&cw"
,A_SOMEONE,pc,self,vict,TO_NOTVICT);
act("&c+r$1n sends $1s heavy boot swinging at you!&cw"
,A_SOMEONE,pc,self,vict,TO_VICT);
hehe:=25;
goto trashim;
}
if (splash<40)
{
act("&c+gYou swing the tip of your boot at $3n!&cw"
,A_ALWAYS,pc,self,vict,TO_CHAR);
act("&c+g$1n swings the tip of $1s boot at $3n!&cw"
,A_SOMEONE,pc,self,vict,TO_NOTVICT);
act("&c+r$1n swings the tip of $1s boot at you!&cw"
,A_SOMEONE,pc,self,vict,TO_VICT);
hehe:=20;
goto trashim;
}
if (splash<60)
{
act("&c+gYou aim your steel-enhanced kick at $3n!&cw"
,A_ALWAYS,pc,self,vict,TO_CHAR);
act("&c+g$1n aims a steel-enhanced kick at $3n!&cw"
,A_SOMEONE,pc,self,vict,TO_NOTVICT);
act("&c+r$1n aims a steel-enhanced kick at you!&cw"
,A_SOMEONE,pc,self,vict,TO_VICT);
hehe:=30;
goto trashim;
}
if (splash<80)
{
act("&c+gWith a cruel grin, you smash your steel-toed boot into $3n&cw"
,A_ALWAYS,pc,self,vict,TO_CHAR);
act("&c+g$1n grins cruelly and smashes $1s steel-toed boot into $3n!&cw"
,A_SOMEONE,pc,self,vict,TO_NOTVICT);
act("&c+r$1n's cruel grin warns you of $1s boot approaching!&cw"
,A_SOMEONE,pc,self,vict,TO_VICT);
hehe:=25;
goto trashim;
}
if (splash<100)
{
act("&c+gYou plant your steel-toed foot in $3n!&cw"
,A_ALWAYS,pc,self,vict,TO_CHAR);
act("&c+g$1n plants $1s steel-toed foot in $3n!&cw"
,A_SOMEONE,pc,self,vict,TO_NOTVICT);
 act("&c+r$1n plants $1s steel-toed foot in your side!&cw"
,A_SOMEONE,pc,self,vict,TO_VICT);
hehe:=30;
goto trashim;
}
else
{
act("&c+gYour heavy boots cause you to slip and fall!&cw"
,A_ALWAYS,pc,self,vict,TO_CHAR);
act("&c+w$1n's heavy boots cause $1n to slip and fall!&cw"
,A_SOMEONE,pc,self,vict,TO_REST);
pc.position:=POSITION_SITTING;
position_update(pc);
goto start;
}

        :trashim:
pc.endurance:=pc.endurance-(rnd(3,5));
n:=meleeattack(pc,vict,hehe,WPN_KICK);
change_speed(pc,6);
        :gone:
unsecure(pc);
goto start;
}
dilend
end
*/

shackles
names {"prisoner's chain","iron ball","chain","ball","shackles"}
title "a heavy chain with a huge iron ball"
descr "A short, heavy chain with a huge iron ball at the end lies here."
extra {}
"A short and heavy chain with a huge iron ball at one end, the kind used
for keeping prisoners on the spot. A solid shackle at the other end seems to
fit snugly around the ankle."
extra {"$wear_s"}
"You slide the shackle around your ankle and lock it.&nAs you realize
what you have done, you can't help but feel foolish."
extra {"$wear_o"}
"$1n slides the shackle of a prisoner's chain around $1s ankle and locks
it.&nWhat a fool!"
extra {"$rem_s"}
"With a sigh of relief you remove the encumbering chain."
extra {"$rem_o"}
"With a sigh of relief, $1n removes the encumbering prisoner's chain."
type ITEM_OTHER
spell 5
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_ANKLE}
MATERIAL_METAL("Those shackles are made of solid iron.")
DEX_TRANSFER(-20)
DEX_TRANSFER(-20)
DEX_TRANSFER(-20)
weight 20
CURSED_OBJECT
cost 4 IRON_PIECE

dilbegin chaindrag();
code
{
        :start:
wait(SFB_CMD,(command(CMD_NORTH)or command(CMD_SOUTH) or command(CMD_EAST)
or command(CMD_WEST) or command(CMD_UP) or command(CMD_DOWN))
and(activator==self.outside)
and((self.equip==WEAR_ANKLE_L)or(self.equip==WEAR_ANKLE_R)));
act("You drag the heavy iron ball behind you as you walk."
,A_ALWAYS,self.outside,self,null,TO_CHAR);
act("$1n drags $1s heavy iron ball behind $1m as $1e walks."
,A_SOMEONE,self.outside,self,null,TO_REST);
self.outside.endurance:=self.outside.endurance-(rnd(10,15));
goto start;
}
dilend
end

gobcloak
names {"goblinskin cloak","cloak","skin"}
title "a goblinskin cloak"
descr "A long cloak made of what seems like skin lies here."
extra {}
"This greenish cloak is made of goblinskin and it smells terrible."
ARMOUR_LEATHER(-5,0)
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_ABOUT}
weight 4
cost 1 COPPER_PIECE
end

/* Orc Weapons */

battlespoon
names {"battle spoon","spoon"}
title "a huge battle spoon"
descr "A huge wooden spoon lies here, covered with grease."
extra {}
"A huge wooden spoon, perfect for cooking large dinners. It requires
two-handed stirring action, as it is too large to be used in a single
hand. You notice several notches carved into the handle - one for each
casualty of the dinner perhaps?"
WEAPON_DEF(WPN_BATTLE_CLUB,-4,0)
manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD}
weight 5
cost 7 IRON_PIECE
MATERIAL_WOOD("This is solid oak!")
end

ballnchain
names {"spiked ball'n chain","ball","chain","ball'n chain"}
title "a spiked ball'n chain"
descr "A large spiked ball with a length of chain attached lies here."
extra {}
"A nice mutilating weapon, this ball'n chain has been improved by a few
spikes to introduce a few piercing wounds into the overall concussion
damage. Wouldn't like the victim to get bored, would you?"
WEAPON_DEF(WPN_MORNING_STAR,0,0)
manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD}
weight 13
cost 7 IRON_PIECE
MATERIAL_METAL("Heavy Metal!")
end

sercutlass
names {"serrated cutlass","cutlass","sword","blade"}
title "a serrated cutlass"
descr "A huge, serrated cutlass lies here."
extra {}
"A huge cutlass with serrated edge. The blade seems made of nice steel
and the edge makes it more ripping than slashing weapon. This weapon
probably deals quite horrible wounds."
WEAPON_DEF(WPN_SCIMITAR,0,0)
manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD}
weight 5
cost 5 IRON_PIECE
MATERIAL_METAL("Heavy Metal!")
end

spikeclub
names {"spiked club","club"}
title "a heavy, spiked club"
descr "A heavy, spiked club lies here."
extra {}
"A heavy club for two-handed use. Someone drove a couple of nine-inch nails
through the hard wood, creating an intimidating and rather effective
weapon, with a secondary use as a rather primitive fork."
WEAPON_DEF(WPN_BATTLE_CLUB,-3,0)
manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD}
weight 12
cost 3 IRON_PIECE
MATERIAL_WOOD("Hard, solid wood was used for this club.")
end

grandaxe
names {"grand axe","axe"}
title "a grand axe"
descr "A large grand axe looks extremely intimidating on the ground."
extra {}
"A huge, long-bladed twohanded axe, very much like the executioner axes.
It looks very massive and very effective, but quite heavy too."
WEAPON_DEF(WPN_BARDICHE,0,0)
manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD}
weight 26
rent 4 IRON_PIECE
cost 1 COPPER_PIECE
MATERIAL_METAL("Heavy Metal!")
end

bladedmace
names {"bladed mace","mace"}
title "a bladed mace"
descr "A long mace with four sharp blades in the head lies here."
extra {}
"This long mace features four sharp, short blades instead of the usual
blunt head. It looks quite deadly."
WEAPON_DEF(WPN_MACE,1,0)
manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD}
weight 5
rent 4 IRON_PIECE
cost 1 COPPER_PIECE
MATERIAL_METAL("Heavy Metal!")
end

gutslicer
names {"gutslicer","slicer","battle blade","sword","blade"}
title "the GutSlicer"
descr "A serrated, curved battle blade lies here, gleaming sharply."
extra {}
"An impressive weapon, this long, curved blade is heavily serrated,
making it a fearsome sword of pain. A single, orcish rune on the blade
guarantees dread and horror to the enemies of the wielder."
extra {"GutSlicer rune","rune","orcish rune"}
"This is the orcish rune for 'dread'."
extra {"$identify"}
"This weapon is enchanted with a combat spell, that makes it easier to
wield, and slice through the muscle and bones of any humanoid like
butter by using the command 'gut' in combat."
extra {"$improved identify"}
"The Scimitar Skill bonus is +4%. However, you also sense a weak aura of
evil upon it - whoever wields it will have hard time concentrating on any
beneficial actions!&nThe weapon is of craftsmanship 4 and magical bonus 4.
Notice, that only humanoid enemies will be affected by its gutting slash!"
WEAPON_DEF(WPN_SCIMITAR,2,2)
manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD}
WEAPON_TRANSFER(WPN_SCIMITAR,+1)
SKILL_TRANSFER(SKI_FIRST_AID,-5)
weight 9
rent 100 IRON_PIECE
cost 26 COPPER_PIECE
MATERIAL_METAL("This is fine steel.")
spell 25
dilcopy abi_restrict@function(ABIL_STR,30,0,0,"str_rest@skaven");
dilcopy level_restrict@function(10,0,0,"lvl_rest@skaven");
dilcopy ali_restrict@function(349,-1000,0,0,"badsword@midsewers");

dilbegin recall charge_slicer();
code
{
        :start:
heartbeat:=PULSE_SEC*SECS_PER_MUD_DAY/12;
wait (SFB_TICK,(self.equip==WEAR_WIELD));
heartbeat:=PULSE_SEC*5;
act ("Your hand itches for combat... Your $2N calls for blood!",
A_ALWAYS,self.outside,self,null,TO_CHAR);
sendto ("add charge",self);
goto start;
}
dilend

dilbegin recall aware gutslicing();
var
        enemy   : unitptr;
        n       : integer;
        charge  : integer;
        pwr     : integer;
code
{
pwr:=7;
        :init:
heartbeat := PULSE_SEC*3;
charge:=interrupt (SFB_MSG,((self==activator)and
(argument=="add charge")),charge);
        :start:
wait (SFB_CMD,(command("gut"))and(self.equip==WEAR_WIELD));
block;
enemy:=self.outside.fighting;
if (enemy==null) goto no_person;
secure(enemy,start);
if (rnd(0,1)>0)
{
act("With a gutural scream, you slash wildly at $3n!"
,A_ALWAYS,self.outside,self,enemy,TO_CHAR);
act("With a gutural scream, $1n slashes wildly at $3n!"
,A_SOMEONE,self.outside,self,enemy,TO_REST);
goto resolve;
}
else
{
act("Drooling and screaming, you send your $2N swinging at $3n!"
,A_ALWAYS,self.outside,self,enemy,TO_CHAR);
act("Drooling and screaming, $1n sends $1s $2N swinging at $3n!"
,A_SOMEONE,self.outside,self,enemy,TO_REST);
}
        :resolve:
if (pwr<=0) goto fail;
pwr:=pwr-1;
if (enemy.race > 999) goto notman;
if (rnd(1,80) < self.outside.abilities[ABIL_STR])
{
act("You slice through the stomach muscle of $3n, blood spatters on your "+
"armour!",A_ALWAYS,self.outside,self,enemy,TO_CHAR);
act("$1n slices through the stomach muscle of $3n!"
,A_SOMEONE,self.outside,self,enemy,TO_NOTVICT);
act("$1n's slash slices through your stomach, you yelp in agony!",
A_SOMEONE,self.outside,self,enemy,TO_VICT);
n:=cast_spell(SPL_CAUSE_WOUNDS_1,self,self,self.outside.fighting,"");
}
else
{
act ("Your heavy slash fails to connect with $3n's ribs, you spin around "+
"under the force of the swing!",A_ALWAYS,self.outside,self,enemy,TO_CHAR);
act ("$1ns heavy slash misses its mark, $1e spins around under the force "+
"of the swing!",A_SOMEONE,self.outside,self,enemy,TO_REST);
}
goto start;

        :fail:
act("Your swing sends you off-balance, you might want to rest before using "+
"such fancy fighting again!",A_SOMEONE,self.outside,self,enemy,TO_CHAR);
act("$1n's swing sends him off-balance and misses its mark!",
A_SOMEONE,self.outside,enemy,self,TO_REST);
goto start;

        :notman:
act("Your swing misses its target by a mile!",
A_ALWAYS,self.outside,self,enemy,TO_CHAR);
act("$1n's swing misses its target!"
,A_SOMEONE,self.outside,self,enemy,TO_REST);
goto start;

        :charge:
clear (charge);
if (pwr<7)
pwr:=pwr+1;
goto init;
goto start;

        :no_person:
act("You swing your $2N through the air in an impressive display "+
"of combat skill.",A_ALWAYS,self.outside,self,null,TO_CHAR);
act ("$1n swings $1s $2N through the air in an impressive display "+
"of combat skill.",A_SOMEONE,self.outside,self,null,TO_REST);
goto start;
}
dilend

dilbegin gutslay();
code
{
heartbeat := PULSE_SEC*3;
        :start:
wait(SFB_COM,command(CMD_AUTO_COMBAT)and(self.equip == WEAR_WIELD) and
(self.outside.fighting.hp < 10));
act("Your slash cuts $3n in two pieces, twitching on the ground.",
A_ALWAYS,self.outside,self,self.outside.fighting,TO_CHAR);
act("$1n's slash cuts you in half!&nYou feel your life-blood pouring away...",
A_SOMEONE,self.outside,self,self.outside.fighting,TO_VICT);
act("$1n's slash cuts $3n in two pieces, twitching on the ground.",
A_SOMEONE,self.outside,self,self.outside.fighting, TO_NOTVICT);
self.outside.fighting.hp := -9;
position_update(self.outside.fighting);
pause;
goto start;
}
dilend
end

/* Orc Treasure */

keypurse
names {"small purse","purse"}
title "a small purse on a string"
descr "A small purse on a string lies here."
extra {}
"A small purse, able to contain a few small items at most. A thin string
enables you to wear it around your neck, should you desire to do so."
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_NECK,MANIPULATE_ENTER}
CONTAINER_DEF(5)
cost 1 IRON_PIECE
MATERIAL_CLOTH("This is cloth.")
end

orckey
names {"greenish key","key"}
title "a greenish key"
descr "A large iron key, coloured in a happy green colour, lies here."
extra {}
"A large iron key. To break the monotony of the gray colour of the
rusting metal someone took the pains to colour it in a happy green
colour, which unfortunately makes it look as if it was dipped in vomit."
manipulate {MANIPULATE_TAKE}
type ITEM_KEY
weight 1
end

orckey2
names {"gray key","key"}
title "a gray key on a leather string"
descr "A gray key on a leather string lies here, rusting in peace."
extra {}
"A gray key of average size as keys go. It probably opens something but
what is anyone's guess."
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_NECK}
type ITEM_KEY
weight 1
end

jail_key
names {"battered brass key","key"}
title "a battered brass key"
descr "A battered brass key lies here."
extra {}
"A battered brass key. Nothing overly exciting."
manipulate {MANIPULATE_TAKE,MANIPULATE_HOLD}
type ITEM_KEY
weight 1
end

casket
names {"reinforced casket","casket"}
title "a reinforced casket"
descr "A large casket, heavily reinforced with iron, intrigues you here."
extra {}
"A casket of heavy wood, with iron reinforcements and a mean lock. Good
luck with that one, bud."
manipulate {MANIPULATE_TAKE,MANIPULATE_ENTER}
open {EX_OPEN_CLOSE,EX_CLOSED,EX_LOCKED}
key orckey2@midsewers
CONTAINER_DEF(300)
weight 30
cost 3 IRON_PIECE
spell 20
dilcopy locktrap@midsewers(SPL_POISON,50,5);
end

orplate
names {"ornamented plate mail","plate mail","plate","mail"}
title "an ornamented plate mail"
descr "A highly ornamented plate mail sparkles beautifully here."
extra {}
"A plate mail of great beauty and, undoubtedly, value. It seems to be made
of finest steel, ornamented with gold and silver. Images of a griffon and a
sphinx are engraved with gold on the chest plates and scenes of battles
adorn the stomach plate."
extra {"scenes of battles","scenes","battles","stomach plate","stomach"}
"Scenes of heroes contesting adorn the stomach plates."
extra {"chest plates","plates","chest","images","griffon","sphinx"}
"Two mighty creatures of legend adorn the chest plates of this mail."
extra {"$identify"}
"This mighty plate is totally immune to the tooth of time and will not
tarnish with age nor use."
extra {"$improved identify"}
"However, as you attempt to dwell deeper into the history of the armour, a
dark shadow clouds your mind... a chill runs through your body, something
is very wrong with this thing!"
ARMOUR_PLATE(0,-15)
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_BODY}
/*STR_TRANSFER(+4)
DEX_TRANSFER(-10)*/
weight 30
cost 2 GOLD_PIECE
rent 50 IRON_PIECE
spell 5
CURSED_OBJECT

dilbegin armour_curse();
var
        i       : integer;
code
{	
heartbeat:=PULSE_SEC*10;
        :start:
wait(SFB_TICK,self.equip==WEAR_ABOUT);
wait(SFB_TICK,self.equip==WEAR_ABOUT);
if (rnd(1,3)==1)
{
sendtext("Images of some distant battle flash through your head...&n"+
"&c+wYou can see a sword descending, parting your head from your "+
"shoulders!&cw&n"+
"You scream in agony!&n",self.outside);
act("$1n suddenly grabs $1s head and screams in agony!",
A_SOMEONE,self.outside,self,null,TO_REST);
i:=cast_spell(SPL_DISEASE_1,self,self,self.outside,"");
        if (self.outside.position==POSITION_SLEEPING)
                self.outside.position:=POSITION_STANDING;
goto start;
}
if (rnd(1,2)==1)
{
sendtext("A sudden flash of pain causes you to yell out!&n"+
"You notice blood spreading from your throat..!&n",self.outside);
act("$1n suddenly yells in pain, you notice blood spreading from $1s throat!"
,A_SOMEONE,self.outside,self,null,TO_REST);
self.outside.hp:=self.outside.hp-rnd(5,10);
position_update(self.outside);
goto start;
}
else
{
sendtext("A hole suddenly appears in your plate, as if you were struck by "+
"a spear!&n"+
"&c+rYou bleed profusely from a wound in your chest!&cw&n",self.outside);
act("A hole appears suddenly in $1n's plate, as if $1e was struck by an "+
"invisible spear!&n"+
"$1n screams, $1s wound bleed!",A_SOMEONE,self.outside,self,null,TO_REST);
self.outside.hp:=self.outside.hp-rnd(3,15);
position_update(self.outside);
}
goto start;
}
dilend
end

casketcash
title "ip"
type ITEM_MONEY
manipulate {MANIPULATE_TAKE}
value[0] 34
end

/* Battlerager Items */
/* Commented out as per Skay's request - Eirinn

orcmasher
names {"orcmasher","masher","club","warclub","war-club"}
title "the OrcMasher"
descr "A heavy, two-handed dwarf war-club lies here."
extra {}
"An exquisitely carved weapon of dark, heavy wood. Grim visages of
dwarf warriors are carved deep into the club, separated by three strong
dwarf runes. The handle is reinforced with leather, worn smooth by the
countless hands wielding it. A small inscription just beneath the handle
catches your eye."
extra {"inscription on the handle","inscription","handle"}
"The carved inscription reads 'OrcMasher'. Apparently this is the famed
bane of the goblinoid people."
extra {"carved visages","carvings","visages"}
"The carved visages of dwarves must resemble some heroes long forgotten,
or at least you assume so. The carvings are simple but precise."
extra {"three runes","runes","rune"}
"The three carved runes seem to compose an enchantment on the club."
extra {"$identify"}
"A weapon of dwarf battleragers, the OrcMasher is empowered with the
strength to slay Orcs. It will also boost the strength and constitution
of the fighter, although lowering his intelligence slightly..."
extra {"$improved identify"}
"Even though it provides a bonus of +1 to Strength and +1 to
Constitution, the weapon is only worth a true berzerker, as it doesn't
allow its wielder to flee any combat against the orc- and goblinkin.
Those creatures can't even touch the weapon, much less wield it.&nThe
OrcMasher also decreases the fighter's Brain by 2.&nThe OrcMasher is of
dwarf craftsmanship of 7, and its magical bonus amounts to 3."
WEAPON_DEF(WPN_BATTLE_CLUB,4,3)
WEAPON_SLAYER(RACE_ORC)
manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD}
STR_TRANSFER(+1)
CON_TRANSFER(+1)
BRA_TRANSFER(-2)
weight 9
cost 3 GOLD_PIECE
rent 100 IRON_PIECE
MATERIAL_WOOD("Dark and heavy wood composes this weapon.")
dilcopy abi_restrict@function(ABIL_STR,35,0,0,"");
dilcopy abi_restrict@function(ABIL_CON,15,0,0,"");

dilbegin noorcinoflee();
var
        pc      : unitptr;
        enemy   : unitptr;
code
{
        :start:
wait(SFB_CMD,(command(CMD_FLEE))and(self.outside.position==POSITION_FIGHTING)
and(activator==self.outside));
pc:=self.outside;
enemy:=pc.fighting;
if ((enemy.race==RACE_ORC)or(enemy.race==RACE_HALF_ORC))
{
block;
sendtext("&nYou REFUSE to flee from this stinking orc-breath kin!&n",pc);
goto start;
}
if ((enemy.race==RACE_GOBLIN)or(enemy.race==RACE_TROLL)
   or(enemy.race==RACE_GROLL))
{
block;
sendtext("&nFlee? From a STINKING GOBLINOID!? Never!!!&n",pc);
goto start;
}
else goto start;
}
dilend

dilbegin orcprevent();
var
        pc:unitptr;
code
{
        :start:
wait(SFB_DONE,(command(CMD_WIELD))or(command(CMD_WEAR))and(medium==self));
pc:=activator;
if ((pc.race==RACE_ORC)or(pc.race==RACE_HALF_ORC))
{
sendtext("As you wield the OrcMasher the runes flare violently and the "+
"shaft of the weapon burns your hands!&n",pc);
act("$1n yelps as the OrcMasher burns $1s hands!",A_SOMEONE,pc,self,null,
TO_REST);
pc.hp := pc.hp -rnd(1,20);
position_update(pc);
exec("remove orcmasher",pc);
goto start;
}
else goto start;
}
dilend
end

*/

/* Commented out as per Skay's request - Eirinn

dwarfgirdle
names {"dwarf girdle","girdle","belt"}
title "Dwarf Girdle"
descr "A heavy, steel-studded leather girdle lies here."
extra {}
"The girdle is made of thick, heavy leather, studded with large rings of
fine steel. A broad buckle of same kind of steel is heavily ornamented
with silver and gold. An inscription in dwarf runes runs around the
buckle."
extra {"buckle on your girdle","buckle","inscription","runes"}
"The broad and heavily-ornamented buckle seems a very typical example of
dwarf design. The strong runes seem to form some sort of enchantment."
extra {"$identify"}
"Dwarf Girdles are created by the strong folk for their warriors and
its enchantments increase their sturdiness as well as stamina, but
decrease the charisma slightly. The enchantment is such that only dwarves
and their close cousins gnomes can use the girdle without trouble - other
races have a difficult time in wearing it as the enchantment refuses to
work properly. Elven races as well as orc-kin cannot even wear the
girdle, as it shuns their bodies completely."
extra {"$improved identify"}
"The Girdle will raise the Constitution by 1 and Hitpoints Ability by 1 (3
pts) while decreasing your Charisma by 2. The effects on races other
but dwarves and gnomes can be unpredictable and chaotic."
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_WAIST}
type ITEM_WORN
CON_TRANSFER(+1)
HIT_TRANSFER(+1)
CHA_TRANSFER(-2)
rent 75 IRON_PIECE
cost 2 GOLD_PIECE
dilcopy abi_restrict@function(ABIL_STR,35,0,0,"str_rest@skaven");
dilcopy abi_restrict@function(ABIL_CON,30,0,0,"con_rest@skaven");

dilbegin girdlerestricts();
var
        pc : unitptr;
        flex : integer;
code
{
        :start:
wait(SFB_DONE,(command(CMD_WEAR))and(self==medium)
and(self.outside==activator));
pc:=activator;

if ((pc.race==RACE_ORC)or(pc.race==RACE_HALF_ORC)or(pc.race==RACE_GROLL)
or(pc.race==RACE_HALF_OGRE))
{
sendtext("&nA rune flares on the girdle, it burns your body!&n",pc);
sendtext("&nYou hastily snatch it off!&n",pc);
act("A rune flares on $1n's $2n! $1e screams and hastily snatches it off!"
,A_SOMEONE,pc,self,null,TO_REST);
pc.endurance:=pc.endurance-(rnd((pc.endurance/2),(pc.endurance)));
pc.mana:=pc.mana-(rnd((pc.mana/2),(pc.mana)));
pc.hp:=pc.hp-(rnd(5,15));
position_update(pc);
link(self,pc);
goto start;
}

if ((pc.race==RACE_ELF)or(pc.race==RACE_DARK_ELF)or(pc.race==RACE_HALF_ELF))
{
sendtext("&nA rune flares on the girdle, the dwarf magic rejects your "+
"elven blood!&n",pc);
sendtext("&nWith a yelp of pain you snatch it off!&n",pc);
act("$1n yelps and snatches the $2n off as it rejects his fairy blood!"
,A_SOMEONE,pc,self,null,TO_REST);
pc.hp:=pc.hp-(rnd(1,5));
pc.endurance:=pc.endurance-(rnd((pc.endurance/2),(pc.endurance)));
pc.mana:=pc.mana-(rnd((pc.mana/2),(pc.mana)));
position_update(pc);
link(self,pc);
goto start;
}

if ((pc.race==RACE_HUMAN)or(pc.race==RACE_BROWNIE)or(pc.race==RACE_HALFLING))
{
flex := rnd(1,100);

if (flex<20)
{
sendtext("&nA rune flickers on the Girdle, you suddenly feel very "+
"fatigued.&n",pc);
act("A rune flickers briefly on $1n's $2n, $1e suddenly looks very tired."
,A_SOMEONE,pc,self,null,TO_REST);
pc.endurance:=pc.endurance-(rnd((pc.endurance/2),(pc.endurance)));
position_update(pc);
goto start;
}
if (flex<40)
{
sendtext("&nA sudden dizziness assaults you for a second, then it's gone...&n"
,pc);
act("$1n stumbles suddenly, pale as death, seeking support on your shoulder."
,A_SOMEONE,pc,self,null,TO_REST);
pc.mana:=pc.mana-(rnd((pc.mana/2),(pc.mana)));
position_update(pc);
goto start;
}
if (flex<60)
{
sendtext("&nA sudden, sharp pain in your head causes you to cry out!&n",pc);
act("$1n grabs $1s head and yelps in pain, sinking to $1s knees!"
,A_SOMEONE,pc,self,null,TO_REST);
pc.endurance:=pc.endurance-(rnd((pc.endurance/2),(pc.endurance)));
pc.mana:=pc.mana-(rnd((pc.mana/2),(pc.mana)));
pc.hp:=pc.hp-(rnd(1,5));
pc.position:=POSITION_SITTING;
position_update(pc);
goto start;
}
else goto start;
}
else goto start;
}
dilend
end

*/

earnecklace
names {"orc-ear necklace","necklace"}
title "a necklace of orc ears"
descr "A necklace made of bloody trophies lies here."
extra {}
"A simple leather string holds several bloody orc ears, some of them
wrinkled and dried with age, some of them quite fresh. Rather disgusting."
extra {"$wear_s"}
"You wear $2n around your neck.&nYou feel like one mean bast'r."
extra {"$wear_o"}
"$1n wears $2n around $1s neck and a mean look appears on $1s face."
extra {"$rem_s"}
"You remove $2n with a snap.&nYou feel like a nerdy wimp once again."
type ITEM_WORN
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_NECK}
weight 1
cost 5 IRON_PIECE
end

/* Leper stuff - Bum stuff */

bellstaff
names {"leper staff","staff"}
title "a leper's staff"
descr "A staff with a bell on one end lies here."
extra {}
"A long, gnarled staff, with a small, round bell on one end. Such sticks
are usually used by lepers, the bell's voice warning people of their
approach."
extra {"bell on the staff","bell"}
"The small, round bell is basically a tin sphere with a small tin ball
inside."
WEAPON_DEF(WPN_QUARTERSTAFF,-5,0)
manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD}
weight 2
cost 3 IRON_PIECE
MATERIAL_WOOD("This staff is made of wood.")

dilbegin staffring();
var
        flux : integer;
        pc : unitptr;
code
{
        :start:
wait(SFB_DONE,TRUE and (self.equip == WEAR_WIELD));
pc := self.outside;
flux := rnd(1,10);

if (flux==1)
{
act("Your bell on the staff tinkles slightly as you move."
,A_ALWAYS,pc,null,null,TO_CHAR);
act("$1n's bell on staff tinkles slightly as $1e moves."
,A_HIDEINV,pc,null,null,TO_REST);
goto start;
}
if (flux==2)
{
act("Your bell rings loudly as your staff moves."
,A_ALWAYS,pc,null,null,TO_CHAR);
act("$1n's bell rings loudly as $1s staff moves."
,A_HIDEINV,pc,null,null,TO_REST);
goto start;
}
if (flux==3)
{
act("The jiggling of your bell is slowly driving you insane."
,A_ALWAYS,pc,null,null,TO_CHAR);
act("The jiggling of $1n's bell is slowly driving you insane."
,A_HIDEINV,pc,null,null,TO_REST);
goto start;
}
if (flux==4)
{
act("A tinkling sound comes from your bell on the staff."
,A_ALWAYS,pc,null,null,TO_CHAR);
act("A tinkling sound on $1n's staff alarms you to the presence of the "+
"leper.",A_HIDEINV,pc,null,null,TO_REST);
goto start;
}
goto start;
}
dilend
end

dirtypants
names {"dirty pants","pants"}
title "dirty pants"
descr "A pair of dirty pants lies here, moulding."
extra {}
"Once undoubtedly the latest scream of fashion, now only a piece of mouldy
fabric covered in dirt. How ironic and cruel is the passage of time."
ARMOUR_CLOTHES(-10,0)
MATERIAL_CLOTH("This is, unbelievable as it sounds, cloth.")
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_LEGS}
weight 2
cost 1 IRON_PIECE
end

dirtycoat
names {"dirty coat","coat","cotton coat"}
title "dirty coat"
descr "A long coat lies here, dirty and moulding."
extra {}
"A dirty, long cotton coat. Quite ugly and smelly but at least it can
give some warmth."
ARMOUR_CLOTHES(-10,-5)
MATERIAL_CLOTH("This is, unbelievable as it sounds, cloth.")
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_ABOUT}
weight 4
cost 1 IRON_PIECE
end

/* goblin stuff */

ratspear
names {"rat spear","spear","fork"}
title "a rat spear"
descr "A short wooden spear with three sharp points lies here."
extra {}
"A thin and short wooden spear. Three points form a triangle at the end
of the spear, much like fishing spears. The spear is of remarkably bad
craftsmanship."
WEAPON_DEF(WPN_TRIDENT,-5,0)
MATERIAL_WOOD("Old wooden spear.")
manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD}
weight 1
cost 2 IRON_PIECE
end

ratskull
names {"rat skull","skull"}
title "a rat skull"
descr "An small rat skull lies here."
extra {}
"A small, old rat skull. If you happen to collect those, this could have
an immense value. Otherwise probably not."
manipulate {MANIPULATE_TAKE,MANIPULATE_HOLD}
type ITEM_TRASH
MATERIAL_ORGANIC("Bone.")
end

brbottle
names {"broken bottle","bottle"}
title "a broken bottle"
descr "A broken bottle threatens to pierce your feet here."
extra {}
"A broken bottle, much like an usual beer bottle. It is sharp and can
perhaps be used in a brawl."
manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD}
WEAPON_DEF(WPN_DAGGER,-10,-5)
MATERIAL_GLASS("This is glass.")
weight 1
cost 1 IRON_PIECE
end

kettle
names {"rusty kettle","kettle"}
title "a rusty kettle"
descr "An old, rusty kettle somehow found its way here."
extra {}
"An old and rusty kettle. It has been years since it has tasted a good
stew or kept a nice soup inside. Holes in the kettle insure that any
attempts on this now won't be successful either."
extra {"$wear_s"}
"You put the rusty kettle on your head."
extra {"$wear_o"}
"$1n puts the rusty kettle on $1s head with a proud look on $1s face."
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_HEAD}
ARMOUR_PLATE(-10,-10)
weight 2
cost 1 IRON_PIECE
MATERIAL_METAL("Believe it or not, this kettle is made of metal!")
end

deadrat
names {"dead rat","rat"}
title "a dead rat"
descr "A stench of decay assaults your nostrils as you spot a dead rat."
extra {}
"A dead rat in quite advanced state of decay. You can actually see the
ribs and everything. A small family of larvae seem to have made a nice
home inside the late rodent."
extra {"family of larvae","larvae","family"}
"The maggots are white, bloated and, judging from their movements, quite
hungry."
manipulate {MANIPULATE_TAKE,MANIPULATE_HOLD}
weight 2
cost 1 IRON_PIECE
type ITEM_TRASH
MATERIAL_ORGANIC("Decaying flesh... yummy.")
end

mouldbread
names {"mouldy bread","bread","piece"}
title "a mouldy bread"
descr "A piece of mouldy bread lies here, crawling with maggots."
extra {}
"A piece of mouldy bread, now the home of several hungry maggots. Judging
from them it hasn't completely lost its nutritious value. Have a bite."
extra {"maggots on the bread","maggots"}
"Boy, they seem hungry."
manipulate {MANIPULATE_TAKE,MANIPULATE_HOLD}
weight 1
cost 1 IRON_PIECE
FOOD_DEF(2,2)
end

rotsack
names {"rotting sack","sack"}
title "a rotting sack"
descr "A rotting sack lies here, falling apart as you look."
extra {}
"A rotting sack, all holed and smelly. It can hardly hold anything, but
if you like, you can pull it over your head."
/* It would improve your
charisma immensely! Well, anything would, really."
CHA_TRANSFER(+1) */
CHAR_FLAG_TRANSFER(CHAR_BLIND)
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_HEAD}
type ITEM_TRASH
weight 1
cost 1 IRON_PIECE
end

/* South Sewer Stuff */

magekey
names {"copper key","key"}
title "a small, copper key"
descr "Someone lost a small, copper key here."
extra {}
"Small key, seemingly made of copper. Smells rather strange."
manipulate {MANIPULATE_TAKE,MANIPULATE_HOLD}
type ITEM_KEY
weight 1
cost 1 IRON_PIECE
end

casket_key
names {"solid iron key","key"}
title "a solid iron key"
descr "Someone lost an iron key here."
extra {}
"A solid-looking key of iron."
manipulate {MANIPULATE_TAKE,MANIPULATE_HOLD}
type ITEM_KEY
weight 1
cost 1 IRON_PIECE
end

iron_casket
names {"iron casket","casket"}
title "an iron casket"
descr "A solid, iron casket stands here."
extra {}
"A solid casket of sturdy iron. Heavy too. The lock on the casket seems a
reliable one and a tricky thing too."
open {EX_OPEN_CLOSE,EX_CLOSED,EX_LOCKED}
key casket_key
CONTAINER_DEF(200)
weight 100
manipulate {MANIPULATE_TAKE,MANIPULATE_ENTER}
spell 20
dilcopy locktrap@midsewers(SPL_DISEASE_1,50,5);
end

/* Balluston's stuff */

notebook
names {"black notebook","notebook","book","notes"}
title "a black notebook"
descr "A nondescript, black notebook lies here."
extra {}
"A black notebook. The pages are covered in thin, chaotic writing.
Skimming through it, you realize that the notes are missing something to
be useful... You need another book from an alchemist to &c+wverify
notes&cw with. Didn't that old fume-sniffer from Urland have one?"
manipulate {MANIPULATE_TAKE,MANIPULATE_HOLD}
type ITEM_BOOK
weight 1

dilbegin recall compare_books();
var
        u       : unitptr;
        pc      : unitptr;
code
{
heartbeat:=PULSE_SEC*10;

        :start:
wait(SFB_CMD,command("verify")and("notes" in argument)and
(HAVE_BOOK in activator.quests));
pc:=activator;
secure(pc,start);
block;
u:=findunit(pc,"book of knowledge",FIND_UNIT_IN_ME,null);
if (u==null)
{
sendtext("You got nothing, you can use for verification of your alchemical "+
"notes.&n" ,pc);
goto start;
}
sendtext("You start verifying your notes with the book of knowledge...&n",pc);
act("$1n starts reading in a notebook and comparing it with information "+
"from the Book of Knowledge.",A_HIDEINV,pc,null,null,TO_REST);
pause;
if (rnd(1,50)>pc.abilities[ABIL_BRA])
{
sendtext("You don't grasp the complicated alchemical formulas!&n"+
"Perhaps you should try later, when you got less things on your mind.&n",pc);
act("$1n frowns and slams the book shut in anger. No success.",
A_HIDEINV,pc,null,null,TO_REST);
goto start;
}

sendtext("You successfully verify the notes and correct Balluston's "+
"formulas!&nYou record the corrected notes at the back of the notebook.&n"+
"&n&c+wYou can now use Balluston's vat!&cw&n",pc);
act("$1n grins like a maniac and slams the book shut! Success!",
A_SOMEONE,pc,null,null,TO_REST);
        subextra(pc.quests,HAVE_BOOK);
        addextra(pc.quests,{BOOK_DONE},"");
        experience(300,pc);
link(load("notesbook2@midsewers"),pc);
destroy(self);
}
dilend
end

notesbook2
names {"black notebook","notebook","book"}
title "a black notebook"
descr "A nondescript, black notebook lies here."
extra {}
"A black notebook. The pages are covered in thin, chaotic writing. Most
of it is pretty technical alchemical stuff, but you manage to find some
understandable, if somewhat enigmatic, notes at the very end of the book
(you can read it by 'read notes')."
extra {"enigmatic notes","notes","writing"}
"&lMany alchemical effects can be reproduced by using the inherent magic
of the slimes and the ingenuous design of my slime vat. Simply place the
mashed blob of slime in the vat and utter the words of power, and the
cauldron will do it's work.
Beware: many of the potions seem to have occasional slight side-effects.

   - The Potion of Potence - grants the strength of ten men;
     red slime of the hottest type, the words 'tharrak rooh'
     must be uttered.

   - The Potion Of Wisdom - grants the mental power of the gods;
     black slime of monstrous origin, the power word 'sla'thsa'
     is the key to success.

   - The Potion Of Celerity - grants the speed of a hawk in flight;
     mix purple slime into the vat, uttering the words 'su thaa awa'.

   - The Potion Of Detoxication - purges your body of poisons;
     a corpse of a green slime, the words 'sistah frrr' are the key.

After you have placed the right ingredients in the cauldron and uttered
the power word, remember to command it to BOIL!"
manipulate {MANIPULATE_TAKE,MANIPULATE_HOLD}
type ITEM_BOOK
weight 1
end

alchemy_book
names {"alchemical tome","tome","book"}
title "a tome entitled '&c+cBases && Acids In Modern Alchemy&cw'"
descr "A thick tome lies here, you yawn just by looking at it."
extra {}
"The tome is entitled 'Bases && Acids in Modern Alchemy' and is filled
with thousands of formulas of alchemical nature. Frankly, you
understand NOTHING that is written in there. Also, it looks exceedingly
boring."
manipulate {MANIPULATE_TAKE,MANIPULATE_HOLD}
DEX_TRANSFER(-2)
/*SPELL_TRANSFER(SPL_INTERNAL,+2)*/
type ITEM_BOOK
weight 10
cost 5 GOLD_PIECE
rent 50 IRON_PIECE
end

vial
names {"glass vial","vial"}
title "a glass vial"
descr "A glass vial stands here."
extra {}
"A small vial made of glass."
type ITEM_DRINKCON
weight 1
capacity 1
value[0] 1
value[1] 0
value[2] 0
value[3] 0
manipulate {MANIPULATE_TAKE,MANIPULATE_HOLD}
end

slime_vat
names {"large vat","slime vat","vat"}
title "a large, alchemical vat"
descr "A large alchemical vat stands here, covered in odd signs."
extra {}
"A large vat, blackened in places, covered in odd signs and insignia. It
seems rather intimidating. A small fire burns slowly under the vat. This
is truly an alchemical vessel. If you just knew how to use it..."
extra {"$identify"}
"This vat can turn the remains of living slime into alchemical potions.
If a knowledgeable person was to place such Materia inside the vat and
then utter the right words, an alchemical transformation would take place."
extra {"$improved identify"}
"Balluston was the inventor of the vat and his notes would provide the
right formulae for vat use."
weight 60
CONTAINER_DEF(200)
manipulate {MANIPULATE_ENTER}
open {EX_OPEN_CLOSE}

/* damn thing doesn't work

dilbegin vat_bubble();
var
        u       : unitptr;
        i       : integer;
        pc      : unitptr;
        check   : integer;
        txt     : string;
code
{
        heartbeat:=PULSE_SEC*5;

        :start:
wait(SFB_CMD,command(CMD_SAY) and activator.type==UNIT_ST_PC);
check:=0;
pc := activator;
txt := argument;
secure(pc,start);

if ("tharrak rooh" in txt)      check := 1;
if ("sla'thsa" in txt)          check := 2;
if ("su thaa awa" in txt)       check := 3;
if ("sistah frrr" in txt)       check := 4;
if (check==0) goto start;

if (not(BOOK_DONE in pc.quests))
{
act("You don't know the next thing about Alchemy!"
,A_SOMEONE,pc,null,null,TO_CHAR);
act("Nothing exciting happens.",A_SOMEONE,pc,null,null,TO_ALL);
goto start;
}
u:=findunit(self,"slime blob",FIND_UNIT_IN_ME,null);

if (u==null)
{
sendtext("The vat needs Materia to operate!&n",pc);
act("The vat bubbles weakly but nothing happens.",
A_SOMEONE,pc,null,null,TO_ALL);
goto start;
}

if (pc.mana<50)
{
sendtext("You do not have enough mana to power the vat!&n",pc);
act("Nothing happens.",A_SOMEONE,pc,null,null,TO_ALL);
goto start;
}

act("Unit found in the vat: '"+u.title+"'.",A_ALWAYS,self,null,null,TO_ALL);

if ((check==1)and(u.nameidx=="red_blob"))
                u:=load("str_potion@midsewers");
if ((check==2)and(u.nameidx=="black_blob"))
                u:=load("wis_potion@midsewers");
if ((check==3)and(u.nameidx=="purple_blob"))
                u:=load("spd_potion@midsewers");
if ((check==4)and(u.nameidx=="green_blob"))
                u:=load("tox_potion@midsewers");

act("You feed magic into the vat!",A_SOMEONE,pc,null,null,TO_CHAR);
pc.mana:=pc.mana-rnd(40,60);
act("The vat shakes and the sigla glow!",A_SOMEONE,pc,null,null,TO_ALL);
destroy(self.inside);
pause;
act("The vat begins to bubble!",A_SOMEONE,pc,null,null,TO_ALL);
pause;

if(pc.abilities[ABIL_BRA]<openroll(50,5))
{
act("Something goes wrong, the slime in the vat explodes!&n"+
"&c+rYou are showered in hot mixture!!!&c+r",A_SOMEONE,pc,null,null,TO_ALL);
foreach(UNIT_ST_PC|UNIT_ST_NPC,u)
        {
        u.hp:=u.hp-rnd(5,25);
        position_update(u);
        }
goto start;
}
act("The vat settles down, steaming... You can see something at the bottom "+
"of the cauldron.",A_SOMEONE,pc,null,null,TO_ALL);
link(u,self.inside);
goto start;
}
dilend
*/
end

acid_staff
names {"acid-eaten staff","acid staff","iron staff","staff"}
title "an acid-eaten staff"
descr "An iron staff lies here, strongly eaten by acid."
extra {}
"Once a regular iron-reinforced staff, but now a severely twisted stick of
dubious look and use."
WEAPON_DEF(WPN_QUARTERSTAFF,-2,0)
manipulate{MANIPULATE_TAKE,MANIPULATE_WIELD}
weight 10
cost 3 SILVER_PIECE
rent 12 IRON_PIECE
end

acid_scroll
names {"dusty scroll","acid scroll","scroll"}
title "a dusty scroll"
descr "A dusty scroll lies here, forgotten."
extra {}
"A dusty scroll, the spell almost unreadable with age."
SCROLL_DEF(30,SPL_ACID_RESI,SPL_POISON_RESI,SPL_NONE)
weight 1
end

/* Slime Potions */

str_potion
names {"red pill","pill","potion"}
title "a red pill"
descr "A large, red pill lies here."
extra {}
"A large, red pill. It looks very much like an alchemical potion in its
dehydrated form."
POTION_DEF(30,SPL_RAISE_STR,SPL_DISEASE_1,SPL_NONE)
weight 1
end

wis_potion
names {"black pill","pill","potion"}
title "a black pill"
descr "A large, black pill lies here."
extra {}
"A large, black pill. It looks very much like an alchemical potion in its
dehydrated form."
POTION_DEF(30,SPL_RAISE_BRA,SPL_DISEASE_1,SPL_NONE)
weight 1
end

spd_potion
names {"purple pill","pill","potion"}
title "a purple pill"
descr "A large, purple pill lies here."
extra {}
"A large, purple pill. It looks very much like an alchemical potion in its
dehydrated form."
POTION_DEF(30,SPL_RAISE_DEX,SPL_HASTE,SPL_BLIND)
weight 1
end

tox_potion
names {"green pill","pill","potion"}
title "a green pill"
descr "A large, green pill lies here."
extra {}
"A large, green pill. It looks very much like an alchemical potion in its
dehydrated form."
POTION_DEF(30,SPL_REMOVE_POISON,SPL_REMOVE_POISON,SPL_DISEASE_1)
weight 1
end

/* Slime corpses */

red_blob
names {"red slime blob","slime","blob"}
title "a huge blob of red slime"
descr "A huge blob of red slime quivers here."
extra {}
"A huge blob of red slime, rather disgusting and with a strange,
sulphurous smell."
extra {"$get_s"}
"You collect $2n, it starts to seep through your arms."
manipulate {MANIPULATE_TAKE}
type ITEM_TRASH
weight 3
dilcopy blowaway@function(300,"The red slime seeps into the ground.");
end

green_blob
names {"green slime blob","slime","blob"}
title "a huge blob of green slime"
descr "A huge blob of green slime quivers here."
extra {}
"A huge blob of green slime, rather disgusting and with a strange,
acidic smell."
extra {"$get_s"}
"You collect $2n, it starts to seep through your arms."
manipulate {MANIPULATE_TAKE}
type ITEM_TRASH
weight 3
dilcopy blowaway@function(300,"The red slime seeps into the ground.");
end

black_blob
names {"black slime blob","slime","blob"}
title "a huge blob of black slime"
descr "A huge blob of black slime quivers here."
extra {}
"A huge blob of black slime, rather disgusting and with a choking smell of
excrements."
extra {"$get_s"}
"You collect $2n, it starts to seep through your arms."
manipulate {MANIPULATE_TAKE}
type ITEM_TRASH
weight 3
dilcopy blowaway@function(300,"The red slime seeps into the ground.");
end

purple_blob
names {"purple slime blob","slime","blob"}
title "a huge blob of purple slime"
descr "A huge blob of purple slime quivers here."
extra {}
"A huge blob of purple slime, rather disgusting and feeling very cold to
the touch."
extra {"$get_s"}
"You collect $2n, it starts to seep through your arms."
manipulate {MANIPULATE_TAKE}
type ITEM_TRASH
weight 3
dilcopy blowaway@function(300,"The red slime seeps into the ground.");
end

/* Branneth Items */
/* Quest weapons, rapier and misericorde */

elven_rapier
names {"elven rapier","rapier","blade","sword"}
title "an elven rapier"
descr "A slender fencing blade lies here, gleaming sharply."
extra {}
"This beautiful rapier is very light and beautifully crafted. The blade
is slender, yet strong, the handguard elaborately decorated to resemble a
tangle of leaves, the handle covered in dark, soft leather. A weapon of a
true fencer, this blade cannot be used by every common fighter."
extra {"$identify"}
"Your spell reveals the elven magic of the blade - this weapon will
increase your agility.&nA fencer with elven blood in his veins or who got 
granted this weapon as an elven gift will be able to control the enchantment 
of this blade, channeling his or her own magic into the rapier (by exclaiming
'en garde!'). The enchantment will be boosted with 1-3 pts for a short
period of time."
extra {"$improved identify"}
"The Dex bonus is +2. Your Mag will drop by 1."
extra {"$wear_s"}
"You wield the $2N and give it a few experimental swishes. En garde!"
extra {"$wear_o"}
"$1n wields $2n and gives it a few experimental swishes. En garde!"
manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD}
WEAPON_DEF(WPN_RAPIER,0,0)
DEX_TRANSFER(+2)
MAG_TRANSFER(-1)
/*WEAPON_TRANSFER(WPN_RAPIER,+2)
SKILL_TRANSFER(SKI_DISARM,+2)*/
weight 1
cost 10 GOLD_PIECE
rent 100 IRON_PIECE
MATERIAL_METAL("This is fine steel.")
dilcopy abi_restrict@function(ABIL_DEX,40,0,0,"dex_rest@skaven");
dilcopy weap_restrict@function(WPN_RAPIER,20,0,0,"rapier_rest@midsewers");
/* Quest restricted by Eirinn to match quest rules */
dilcopy quest_restrict@function(BROTHER_DONE,0,0,"");

dilbegin recall aware disenchant();
code
{
        :init:
heartbeat:=PULSE_SEC*120;
        :start:
wait(SFB_MSG,(self==activator)and(argument=="enchanted"));
wait(SFB_TICK,TRUE);
wait(SFB_TICK,TRUE);
act("The pale flame of your $2N fades out.",
A_ALWAYS,self.outside,self,null,TO_CHAR);
act("The pale flame of $1n's $2N fades out.",
A_HIDEINV,self.outside,self,null,TO_CHAR);
self.value[2]:=5;
self.extra.descr :=
"This beautiful rapier is very light and beautifully crafted. The blade
is slender, yet strong, the handguard elaborately decorated to resemble a
tangle of leaves, the handle covered in dark, soft leather. A weapon of a
true fencer, this blade cannot be used by every common fighter.";
goto start;
}
dilend

dilbegin recall aware enchantblade();
var
        n       : integer;
        pc      : unitptr;
code
{
        :init:
heartbeat := PULSE_SEC*3;

        :start:
wait(SFB_CMD,command(CMD_SAY)and("en garde!" in argument)
and(self.equip==WEAR_WIELD)and(activator==self.outside));
block;
pc := activator;
secure(pc,gone);
act("You make a fancy salute with your $2N. En garde!",
A_ALWAYS,pc,self,null,TO_CHAR);
act("$1n makes a fancy salute with $1s $2N. En garde!",
A_HIDEINV,pc,self,null,TO_REST);
if ((pc.race!=RACE_ELF)and(pc.race!=RACE_HALF_ELF)and(pc.race!=RACE_DARK_ELF)
and(not(BROTHER_DONE in pc.quests)))
{
act("You fail to awake the spirit of the blade.&n"+
"You got no elven blood in your veins, fool!",
A_ALWAYS,pc,self,null,TO_CHAR);
goto start;
}
if ((pc.abilities[ABIL_DIV]<4)or(pc.abilities[ABIL_MAG]<4))
{
act("You fail to awaken the spirit of the blade.&n"+
"Your mystic power is too weak for the blade!",
A_ALWAYS,pc,self,null,TO_CHAR);
goto start;
}
if (self.value[2]>5)
{
act("You realize that your $2N is already awakened!",
A_ALWAYS,pc,self,null,TO_CHAR);
goto start;
}
if (pc.mana < 25)
{
act("You fail to awake the spirit of the blade.&n"+
"Your mana is too low right now!"
,A_ALWAYS,pc,self,null, TO_CHAR);
goto start;
}
else
{
act("A pale flame flickers along the $2N...",
A_ALWAYS,pc,self,null, TO_CHAR);
act("A pale flame flickers along $1n's $2N...",
A_HIDEINV,pc,self,null, TO_REST);
pc.mana := pc.mana - 25;
self.value[2]:=5+(rnd(1,3));
self.extra.descr :=
"This beautiful rapier is very light and beautifully crafted. The blade
is slender, yet strong, the handguard elaborately decorated to resemble a
tangle of leaves, the handle covered in dark, soft leather. A weapon of a
true fencer, this blade cannot be used by every common fighter.&n
The elven rapier glows in a pale light.";
sendto("enchanted",self);
goto start;
}
        :gone:
unsecure(pc);
goto start;
}
dilend
end

elven_small
names {"elven misericord","misericord","sword","blade"}
title "an elven misericord"
descr "A beautiful, slender misericord lies here."
extra {}
"This beautiful misericord is very light and beautifully crafted. The blade
is slender, yet strong, the handguard elaborately decorated to resemble a
tangle of leaves, the handle covered in dark, soft leather. The short
blade seems a perfect partner to a longer fencing weapon, like a rapier."
extra {"$identify"}
"This beautiful weapon is made by elves and only elves will reach the
true power of it. While used, it improves fencing skills of the user as
well as his paired weapons skills. If worn by a person of elven blood,
this weapon will prove a bane of all half-ogres!&nHowever, you need a
certain fencing skill just to use this weapon properly."
extra {"$improved identify"}
"The Dex bonus is +2, the shortsword bonus +3% and dual wield bonus +2%.
Your Mag will fall by 1.&nThis weapon is of craftsmanship 6 and magical
bonus 5.&nIf wielded by a person of elfin blood or someone who received
this weapon as an elven gift, this weapon will slay half-ogres."
extra {"$wear_s"}
"You wield the $2N and swing it a few times."
extra {"$wear_o"}
"$1n wields $2n and swings it a few times."
manipulate {MANIPULATE_TAKE,MANIPULATE_WIELD}
WEAPON_DEF(WPN_SHORT_SWORD,6,5)
DEX_TRANSFER(+2)
MAG_TRANSFER(-1)
WEAPON_TRANSFER(WPN_SHORT_SWORD,+3)
SKILL_TRANSFER(SKI_DUAL_WIELD,+2)
weight 1
cost 15 GOLD_PIECE
rent 150 IRON_PIECE
dilcopy abi_restrict@function(ABIL_DEX,40,0,0,"dex_rest@skaven");
dilcopy weap_restrict@function(WPN_RAPIER,20,0,0,"rapier_rest@midsewers");
/* Quest restricted by Eirinn to match quest rules */
dilcopy quest_restrict@function(BROTHER_DONE,0,0,"");

dilbegin elfuseslayer();
code
{
        :start:
wait(SFB_DONE,(command(CMD_WEAR)or command(CMD_WIELD) or command(CMD_HOLD))
and (self==medium));
if ((self.outside.race==1)or(self.outside.race==7)or(self.outside.race==10)
or(BROTHER_ON in self.outside.quests))
{
act("&c+wYour $2N shimmers slightly as you wield it!&cw",
A_ALWAYS,self.outside,self,null,TO_CHAR);
act("$1n's $2N shimmers slightly as $1e wields it!",
A_HIDEINV,self.outside,self,null,TO_REST);
self.value[3] := 6;
goto start;
}
else
{
self.value[3] := 15000;
}
goto start;
}
dilend
end

fencer_wrist
names {"fencing wristguard","wristguard","guard","wristlet"}
title "a fencing wristguard"
descr "A slender, hard wristguard lies here."
extra {}
"A slender wristguard of hardened leather, fencers use those to support
their wrists and as help in fencing."
extra {"$identify"}
"Those wristguards will add to your disarming, dual wielding and fencing
skills."
extra {"$improved identify"}
"Each of those skills will be boosted by 1%."
type ITEM_WORN
SKILL_TRANSFER(SKI_DUAL_WIELD,+1)
SKILL_TRANSFER(SKI_DISARM,+1)
WEAPON_TRANSFER(WPN_RAPIER,+1)
weight 1
cost 1 GOLD_PIECE
rent 24 IRON_PIECE
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_WRIST}
dilcopy weap_restrict@function(WPN_RAPIER,15,0,0,"rapier_rest@midsewers");
dilcopy abi_restrict@function(ABIL_DEX,30,0,0,"dex_rest@skaven");
end

black_shirt
names {"black silk shirt","silk shirt","shirt"}
title "silver-embroidered black shirt"
descr "A beautifully embroidered shirt of black silk lies here."
extra {}
"A beautiful shirt of black silk, wide-sleeved and embroidered with silver
threads. The workmanship looks very elven."
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_BODY}
ARMOUR_CLOTHES(0,0)
/*CHA_TRANSFER(+1)*/
weight 0
cost 1 GOLD_PIECE
rent 4 IRON_PIECE
/*dilcopy abi_restrict@function(ABIL_CHA,15,0,0,"cha_rest@skaven");*/
end

black_pants
names {"embroidered black pants","black pants","pants"}
title "silver-embroidered black pants"
descr "A pair of black, quilted pants lies here."
extra {}
"These quilted pants seem to be made of black silk, reinforced with
sewn-in black leather straps. They are embroidered with silver threads
and look very elegant."
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_LEGS}
ARMOUR_CLOTHES(0,0)
weight 1
cost 3 SILVER_PIECE
rent 4 IRON_PIECE
dilcopy abi_restrict@function(ABIL_CHA,15,0,0,"cha_rest@skaven");
end

black_boots
names {"embroidered black boots","black boots","boots"}
title "silver-embroidered black boots"
descr "A pair of black boots shine their leather here."
extra {}
"These soft boots of black leather are embroidered with threads of silver
in the elven fashion. They look very comfortable and, what's more
important, stylish."
/*extra {"$improved identify"}
"Those boots will improve your charisma by one and your sneaking
abilities by 1%. However, they are very soft and your padded kicks would
be laughable at best."*/
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_FEET}
ARMOUR_LEATHER(0,0)
/*CHA_TRANSFER(+1)
SKILL_TRANSFER(SKI_SNEAK,+1)
WEAPON_TRANSFER(WPN_KICK,-4)*/
weight 2
cost 12 SILVER_PIECE
rent 37 IRON_PIECE
/*dilcopy abi_restrict@function(ABIL_CHA,15,0,0,"cha_rest@skaven");
dilcopy abi_restrict@function(ABIL_DEX,15,0,0,"dex_rest@skaven");*/
end

black_cape
names {"embroidered black cape","black cape","cape"}
title "silver-embroidered black cape"
descr "A long, silver-embroidered black cape lies here in a heap."
extra {}
"This beautiful cape of the finest black silk has been embroidered in
silver in the elven fashion. It looks extremely stylish and very soft."
/*extra {"$improved identify"}
"This cape will improve your charisma by one and your hide abilities by
2%. However, it might hinder your freedom in water."*/
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_ABOUT}
type ITEM_WORN
/*CHA_TRANSFER(+1)
SKILL_TRANSFER(SKI_HIDE,+2)
SKILL_TRANSFER(SKI_SWIMMING,-3)*/
weight 2
cost 1 GOLD_PIECE
rent 10 IRON_PIECE
/*dilcopy abi_restrict@function(ABIL_CHA,15,0,0,"cha_rest@skaven");*/
end

handkerchief
names {"silken handkerchief","handkerchief","silk","rectangle"}
title "a silken handkerchief"
descr "A small, embroidered rectangle of silk lies here."
extra {}
"A beautiful silken handkerchief. An elaborate 'B' has been monogrammed
on it."
extra {"$wear_s"}
"You hold $2n in your hand and strut your little finger.&nYou wave it
delicately at your audience."
extra {"$wear_o"}
"$1n holds $2n in $1s hand and struts with $1s little finger.&n$1e waves
the handkerchief delicately at you."
extra {"$rem_s"}
"You blow your nose in the $2N and stuff it back in your pocket."
extra {"$rem_o"}
"$1n blows $1s nose in $2n and stuffs it back in $1s pocket."
manipulate {MANIPULATE_TAKE,MANIPULATE_HOLD}
type ITEM_WORN
cost 1 SILVER_PIECE
end

/* Furbone Stuff */

sharp_sabre
names {"sharp sabre","sabre","blade","sword"}
title "a sharp sabre"
descr "A sharp sabre gleams dangerously here."
extra {}
"A sabre of a sharp blade and a well-crafted handle. It seems a dangerous
weapon indeed!"
WEAPON_DEF(WPN_SCIMITAR,0,0)
/*WEAPON_TRANSFER(WPN_SCIMITAR,+4)*/
weight 3
cost 4 SILVER_PIECE
/*rent 32 IRON_PIECE
dilcopy abi_restrict@function(ABIL_DEX,25,0,0,"dex_rest@skaven");*/
end

sapphire_ring
names {"sapphire ring","ring"}
title "a sapphire ring"
descr "A silver ring with a sapphire lies here."
extra {}
"A beautiful silver ring with a small sapphire. The ring itself is formed
in the shape of three silver threads entwined into each other."
/*extra {"$identify"}
"This ring will improve your Mind Sphere knowledge by 1%."*/
type ITEM_WORN
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_FINGER}
/*SPELL_TRANSFER(SPL_MIND,+1)*/
cost 3 GOLD_PIECE
/*rent 8 IRON_PIECE*/
/*dilcopy abi_restrict@function(ABIL_BRA,15,0,0,"bra_rest@skaven");
dilcopy abi_restrict@function(ABIL_MAG,10,0,0,"mag_rest@skaven");*/
end

selen_necklace
names {"selenite necklace","necklace"}
title "a selenite necklace"
descr "A silvery necklace inlaid with selenite lies here."
extra {}
"A beautiful silver necklace, inlaid with opalescent pale blue
moonstones, also called selenite. The necklace throws a pale blue light
over the surroundings."
extra {"$identify"}
"This necklace will provide light forever but only a magically-inclined
person can use it."
bright 2
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_NECK}
weight 1
cost 1 GOLD_PIECE
rent 10 IRON_PIECE
type ITEM_WORN
dilcopy abi_restrict@function(ABIL_MAG,20,0,0,"mag_rest@skaven");
end

garnet_circlet
names {"garnet-studded circlet","circlet"}
title "a garnet-studded circlet"
descr "A garnet-studded circlet lies here."
extra {}
"A circlet of pure silver, studded with golden-red cinnamon stone
garnets. The circlet looks too large to be worn on a wrist and more of a
suitable adornment for an ankle."
/*extra {"$identify"}
"This weakly-magical circlet will aid your fleeing skills by 2%.&nMagic of
10 and Dexterity of 20 is needed to wear it."*/
manipulate {MANIPULATE_TAKE,MANIPULATE_WEAR_ANKLE}
/*SKILL_TRANSFER(SKI_FLEE,+2)*/
weight 0
cost 2 GOLD_PIECE
/*rent 16 IRON_PIECE*/
type ITEM_WORN
/*dilcopy abi_restrict@function(ABIL_MAG,10,0,0,"mag_rest@skaven");
dilcopy abi_restrict@function(ABIL_DEX,20,0,0,"dex_rest@skaven");*/
end

%reset

/* Balluston area */
/* MS2020 put it in sth10, not sure that's right */
load iron_casket into sth10 max 1 
{
        load vial max 3
        load acid_scroll max 1
}
load slime_vat into sth10 max 1
load balluston into sth10 max 1
{
        load vial max 1
        load magekey max 1
        equip acid_staff                WEAR_WIELD
        equip sorcerer/blackrobe        WEAR_BODY
        equip midgaard/lth_boots        WEAR_FEET
        equip sorcerer/sorc_pendant     WEAR_NECK_1
}

/* South Sewer resets */

load furbone into sth24 max 1
{
        load alchemy_book local 1
        equip sharp_sabre               WEAR_WIELD
        equip midgaard/lth_boots        WEAR_FEET
        equip midgaard/lth_pants        WEAR_LEGS
        equip midgaard/lth_jerkin       WEAR_BODY
        equip udgaard/facemask          WEAR_HEAD
        equip udgaard/blk_hood_cloak    WEAR_ABOUT
}

load branneth into sth16 max 1
{
        equip elven_rapier              WEAR_WIELD
        equip elven_small               WEAR_HOLD
        equip fencer_wrist              WEAR_WRIST_L
        equip black_shirt               WEAR_BODY
        equip black_pants               WEAR_LEGS
        equip black_boots               WEAR_FEET
        equip black_cape                WEAR_ABOUT
        load handkerchief local 1
}

load gutter_runner into sth26 max 1
{
        equip skaven/katar              WEAR_WIELD
        equip skaven/cleaver            WEAR_HOLD
        equip skaven/brigantine         WEAR_BODY
        equip skaven/st_bracers         WEAR_ARMS
        equip skaven/st_greaves         WEAR_LEGS
        equip skaven/earhoop            WEAR_EAR_L
}

/* Slimes */

load slime_red into sth5 max 3
load slime_red into sth21 max 3
load slime_red into sth12 max 3

load slime_green into sth15 max 3
load slime_green into sth25 max 3
load slime_green into sth13 max 3

load slime_black into sth3 max 3
load slime_black into sth19 max 3
load slime_black into sth9 max 3

load slime_purple into sth10 max 2
load slime_purple into sth2 max 2

/* Dwarf reset */

/*
load battlerager into sew9 max 1
{
        equip orcmasher         WEAR_WIELD
        equip dwarfgirdle       WEAR_WAIST
        equip earnecklace       WEAR_NECK_1
        equip midgaard/iron_boots WEAR_FEET
        equip midgaard/lth_pants WEAR_LEGS
        equip midgaard/iron_plate WEAR_BODY
        equip midgaard/iron_bracers WEAR_ARMS
        equip skaven/rucksack   WEAR_BACK
}
*/

/* Orc Resets */

load warlorc into orc17 max 1
{
        equip qtunic position WEAR_BODY
        equip qbreeches position WEAR_LEGS
        equip blkbandana position WEAR_HEAD
        equip spikeclub position WEAR_WIELD
        equip chalk position WEAR_HOLD
}

load prisoner into orc22 max 1
{
        equip shackles position WEAR_ANKLE_L
        equip dirtypants position WEAR_LEGS
}

load cauldron into orc9 max 1
{
        load soup max 1
}

load gobcook into orc9 max 1
{
        equip battlespoon position WEAR_WIELD
        equip cookapron position WEAR_ABOUT
        equip midgaard/lth_pants position WEAR_LEGS
}

load midgaard/lth_boots into orc4 local 1
load orcsleeper into orc4 max 1
{
        equip qtunic position WEAR_BODY
        equip qbreeches position WEAR_LEGS
        equip blkbandana position WEAR_HEAD
        equip blanket position WEAR_ABOUT
        load spikeclub
}

load orcguard1 into orc1 local 1
{
        equip qtunic position WEAR_BODY
        equip midgaard/slth_pants position WEAR_LEGS
        equip pothelm position WEAR_HEAD
        equip midgaard/hlth_boots position WEAR_FEET
        equip sercutlass position WEAR_WIELD
}

load casket into orc13 max 1
{
        load casketcash max 1
        load plumhelm max 1
        load orplate max 1
        load handkerchief max 1
}

load orcboss into orc12 max 1
{
        equip chitplate position WEAR_BODY
        equip skaven/st_greaves position WEAR_LEGS
        equip hornhelm position WEAR_HEAD
        equip midgaard/iron_boots position WEAR_FEET
        equip gutslicer position WEAR_WIELD
        equip midgaard/goldring position WEAR_FINGER_R
        equip keypurse position WEAR_NECK_1
        {
        load orckey max 1
        }
}

load orcamazon into orc12 max 1
{
        equip qtunic position WEAR_BODY
        equip qbreeches position WEAR_LEGS
        equip redbandana position WEAR_HEAD
/*     equip shitkickers position WEAR_FEET */
        equip bladedmace position WEAR_WIELD
        equip orckey2 position WEAR_NECK_2
}

load sewingorc into orc21 max 1
{
        equip qtunic position WEAR_HOLD
        equip qbreeches position WEAR_LEGS
        equip midgaard/hlth_boots position WEAR_FEET
        equip leather_tool position WEAR_WIELD
        equip ironhoop position WEAR_EAR_R
        equip gobcloak position WEAR_ABOUT
        load jail_key max 1
}

load wall_water into orc26 max 1
load orcguard2 into orc26 max 1
{
        equip qtunic position WEAR_BODY
        equip qbreeches position WEAR_LEGS
        equip hornhelm position WEAR_HEAD
        equip midgaard/hlth_gloves position WEAR_HANDS
        equip ballnchain position WEAR_WIELD
        equip bladeshield position WEAR_SHIELD
        equip ww2/bracelet position WEAR_WRIST_L
}

load wanderorc1 into orc18 max 1
{
        equip qtunic position WEAR_BODY
        equip qbreeches position WEAR_LEGS
        equip midgaard/lth_boots position WEAR_FEET
        equip skaven/katar position WEAR_WIELD
        equip skaven/earstud position WEAR_EAR_R
        equip tankard position WEAR_HOLD
}

load wanderorc2 into orc2 max 1
{
        equip midgaard/lth_jerkin position WEAR_BODY
        equip qbreeches position WEAR_LEGS
        equip blkbandana position WEAR_HEAD
        equip spikeclub position WEAR_WIELD
        equip midgaard/beer_bottle position WEAR_HOLD
        equip ironhoop position WEAR_EAR_L
}

/* Others */

load bridge into underbridge max 1
{
        equip brbottle position WEAR_WIELD
        equip midgaard/firebreather position WEAR_HOLD
        equip dirtypants position WEAR_LEGS
        equip dirtycoat position WEAR_ABOUT
}

/* The leper (temporarily removed)
load leper into sew2 zonemax 1
{
        equip bellstaff position WEAR_WIELD
        equip dirtypants position WEAR_LEGS
}
*/

load snothunt into sew13a zonemax 1
{
        equip ratspear position WEAR_WIELD
        equip midgaard/lth_pants position WEAR_LEGS
        load deadrat
}

load sicksnot into goblin3 max 1

load droolsnot into goblin1 max 1
{
        equip brbottle                  WEAR_WIELD
}

load slegoblin into goblin2 max 1
{
        equip brbottle                  WEAR_WIELD
        equip udgaard/wd_pants          WEAR_LEGS
        load deadrat
}

load serpent into below7 zonemax 4
load serpent into sew3 zonemax 4
load serpent into sew16 zonemax 4
load blackout into blind zonemax 5
load blackout into sew7 zonemax 5
load blackout into sew21 zonemax 5
load rat into below9 zonemax 7
load rat into below4 zonemax 7
load rat into sew5 zonemax 7
load rat into sew11 zonemax 7
load rat into sew25a zonemax 7
load rat into sew22 zonemax 7
load rat into sew18 zonemax 7
load worm into sew12 zonemax 2
load worm into sew25 zonemax 2
load millipede into sew28 zonemax 2
load millipede into sew19 zonemax 2
load brbottle into sew2 local 1
load deadrat into sew6 local 1

%end
